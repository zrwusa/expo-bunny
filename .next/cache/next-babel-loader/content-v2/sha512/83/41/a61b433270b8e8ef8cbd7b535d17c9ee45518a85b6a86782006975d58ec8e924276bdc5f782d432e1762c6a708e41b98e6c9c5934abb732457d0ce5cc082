{"ast":null,"code":"\"use strict\";var _interopRequireDefault2=require(\"@babel/runtime/helpers/interopRequireDefault\");var _classCallCheck2=_interopRequireDefault2(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault2(require(\"@babel/runtime/helpers/createClass\"));var _interopRequireWildcard=require(\"@babel/runtime/helpers/interopRequireWildcard\");var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");exports.__esModule=true;exports.default=void 0;var _router=require(\"../next-server/lib/router/router\");var _getAssetPathFromRoute=_interopRequireDefault(require(\"../next-server/lib/router/utils/get-asset-path-from-route\"));var _isDynamic=require(\"../next-server/lib/router/utils/is-dynamic\");var _parseRelativeUrl=require(\"../next-server/lib/router/utils/parse-relative-url\");var _normalizeTrailingSlash=require(\"./normalize-trailing-slash\");var _routeLoader=_interopRequireWildcard(require(\"./route-loader\"));function normalizeRoute(route){if(route[0]!=='/'){throw new Error(\"Route name should start with a \\\"/\\\", got \\\"\"+route+\"\\\"\");}if(route==='/')return route;return route.replace(/\\/$/,'');}var PageLoader=function(){function PageLoader(buildId,assetPrefix){(0,_classCallCheck2.default)(this,PageLoader);this.buildId=void 0;this.assetPrefix=void 0;this.promisedSsgManifest=void 0;this.promisedDevPagesManifest=void 0;this.routeLoader=void 0;this.routeLoader=(0,_routeLoader.default)(assetPrefix);this.buildId=buildId;this.assetPrefix=assetPrefix;this.promisedSsgManifest=new Promise(function(resolve){if(window.__SSG_MANIFEST){resolve(window.__SSG_MANIFEST);}else{;window.__SSG_MANIFEST_CB=function(){resolve(window.__SSG_MANIFEST);};}});}(0,_createClass2.default)(PageLoader,[{key:\"getPageList\",value:function getPageList(){if(true){return(0,_routeLoader.getClientBuildManifest)().then(function(manifest){return manifest.sortedPages;});}else{if(window.__DEV_PAGES_MANIFEST){return window.__DEV_PAGES_MANIFEST.pages;}else{if(!this.promisedDevPagesManifest){this.promisedDevPagesManifest=fetch(this.assetPrefix+\"/_next/static/development/_devPagesManifest.json\").then(function(res){return res.json();}).then(function(manifest){;window.__DEV_PAGES_MANIFEST=manifest;return manifest.pages;}).catch(function(err){console.log(\"Failed to fetch devPagesManifest\",err);});}return this.promisedDevPagesManifest;}}}},{key:\"getDataHref\",value:function getDataHref(href,asPath,ssg,locale){var _this=this;var _ref=(0,_parseRelativeUrl.parseRelativeUrl)(href),hrefPathname=_ref.pathname,query=_ref.query,search=_ref.search;var _ref2=(0,_parseRelativeUrl.parseRelativeUrl)(asPath),asPathname=_ref2.pathname;var route=normalizeRoute(hrefPathname);var getHrefForSlug=function getHrefForSlug(path){var dataRoute=(0,_getAssetPathFromRoute.default)((0,_normalizeTrailingSlash.removePathTrailingSlash)((0,_router.addLocale)(path,locale)),'.json');return(0,_router.addBasePath)(\"/_next/data/\"+_this.buildId+dataRoute+(ssg?'':search));};var isDynamic=(0,_isDynamic.isDynamicRoute)(route);var interpolatedRoute=isDynamic?(0,_router.interpolateAs)(hrefPathname,asPathname,query).result:'';return isDynamic?interpolatedRoute&&getHrefForSlug(interpolatedRoute):getHrefForSlug(route);}},{key:\"_isSsg\",value:function _isSsg(route){return this.promisedSsgManifest.then(function(s){return s.has(route);});}},{key:\"loadPage\",value:function loadPage(route){return this.routeLoader.loadRoute(route).then(function(res){if('component'in res){return{page:res.component,mod:res.exports,styleSheets:res.styles.map(function(o){return{href:o.href,text:o.content};})};}throw res.error;});}},{key:\"prefetch\",value:function prefetch(route){return this.routeLoader.prefetch(route);}}]);return PageLoader;}();exports.default=PageLoader;","map":null,"metadata":{},"sourceType":"script"}