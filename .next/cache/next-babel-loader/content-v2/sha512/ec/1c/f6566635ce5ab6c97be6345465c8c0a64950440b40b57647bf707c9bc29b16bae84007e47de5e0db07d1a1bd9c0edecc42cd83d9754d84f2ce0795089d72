{"ast":null,"code":"import _extends from\"@babel/runtime/helpers/extends\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";var _jsxFileName=\"/Users/revone/projects/expo-react-bunny/src/components/ImageUploader/ImageUploader.tsx\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import _regeneratorRuntime from\"@babel/runtime/regenerator\";import React,{useEffect,useState}from'react';import{IcoMoon,Text,TextButton}from\"../UI\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import Image from\"react-native-web/dist/exports/Image\";import Platform from\"react-native-web/dist/exports/Platform\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import Share from\"react-native-web/dist/exports/Share\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import View from\"react-native-web/dist/exports/View\";import{makeStyles}from\"./styles\";import*as ImagePicker from'expo-image-picker';import{Permissions,removeFileFromFirebaseByURL,uploadFileToFirebase}from\"../../helpers\";import Modal from'react-native-modal';import{Divider}from\"../Divider\";import{CopyableText}from\"../CopyableText\";import{useBunnyKit}from\"../../hooks/bunny-kit\";export function ImageUploader(props){var _this=this;var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,wp=_useBunnyKit.wp;var colors=themeLabor.theme.colors;var _props$width=props.width,width=_props$width===void 0?wp(200):_props$width,_props$height=props.height,height=_props$height===void 0?wp(200):_props$height,source=props.source,path=props.path,_props$isFullFill=props.isFullFill,isFullFill=_props$isFullFill===void 0?false:_props$isFullFill,_props$isShowUri=props.isShowUri,isShowUri=_props$isShowUri===void 0?false:_props$isShowUri,_props$isDeleteFromSe=props.isDeleteFromServerWhenRemove,isDeleteFromServerWhenRemove=_props$isDeleteFromSe===void 0?true:_props$isDeleteFromSe,_props$isDeleteFromSe2=props.isDeleteFromServerWhenUpload,isDeleteFromServerWhenUpload=_props$isDeleteFromSe2===void 0?true:_props$isDeleteFromSe2,style=props.style,placeholderContainerStyle=props.placeholderContainerStyle,imageContainerStyle=props.imageContainerStyle,loadingOverlayStyle=props.loadingOverlayStyle,modalPanelContainerStyle=props.modalPanelContainerStyle,modalPanelStyle=props.modalPanelStyle,modalPanel2Style=props.modalPanel2Style,imageStyle=props.imageStyle,buttonStyle=props.buttonStyle,buttonTextStyle=props.buttonTextStyle,_props$placeholderIco=props.placeholderIconName,placeholderIconName=_props$placeholderIco===void 0?'plus':_props$placeholderIco,modalProps=props.modalProps,_props$imagePickerOpt=props.imagePickerOptions,imagePickerOptions=_props$imagePickerOpt===void 0?{mediaTypes:ImagePicker.MediaTypeOptions.All,allowsEditing:true,aspect:[4,3],quality:0.2}:_props$imagePickerOpt,_props$cameraPickerOp=props.cameraPickerOptions,cameraPickerOptions=_props$cameraPickerOp===void 0?{mediaTypes:ImagePicker.MediaTypeOptions.All,allowsEditing:true,aspect:[4,3],quality:0.2}:_props$cameraPickerOp,_props$loadingIndicat=props.loadingIndicatorProps,loadingIndicatorProps=_props$loadingIndicat===void 0?{color:colors.text,animating:true,size:'large'}:_props$loadingIndicat,renderPreview=props.renderPreview,onError=props.onError,onSelected=props.onSelected,onUploaded=props.onUploaded,onValueChanged=props.onValueChanged,onRemovePhoto=props.onRemovePhoto;var sizeStyle={width:isFullFill?'100%':width,height:isFullFill?'100%':height};var styles=makeStyles(sizeLabor,themeLabor);var _useState=useState(source||{uri:''}),_useState2=_slicedToArray(_useState,2),image=_useState2[0],setImage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isModalVisible=_useState4[0],setModalVisible=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isUploading=_useState6[0],setIsUploading=_useState6[1];useEffect(function(){setImage(source||{uri:''});},[source]);var _takePhoto=function _takePhoto(){var isAllowed,pickerResult;return _regeneratorRuntime.async(function _takePhoto$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(Permissions.camera.get());case 2:isAllowed=_context.sent;if(isAllowed){_context.next=5;break;}return _context.abrupt(\"return\");case 5:_context.next=7;return _regeneratorRuntime.awrap(ImagePicker.launchCameraAsync(cameraPickerOptions));case 7:pickerResult=_context.sent;_context.next=10;return _regeneratorRuntime.awrap(_handleImagePicked(pickerResult));case 10:case\"end\":return _context.stop();}}},null,null,null,Promise);};var _pickImage=function _pickImage(){var isAllowed,pickerResult,uri,mimeType,matched,_type;return _regeneratorRuntime.async(function _pickImage$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(Permissions.mediaLibrary.get());case 2:isAllowed=_context2.sent;if(isAllowed){_context2.next=5;break;}return _context2.abrupt(\"return\");case 5:_context2.next=7;return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync(imagePickerOptions));case 7:pickerResult=_context2.sent;if(pickerResult.cancelled){_context2.next=18;break;}_context2.t0=Platform.OS;_context2.next=_context2.t0==='web'?12:17;break;case 12:uri=pickerResult.uri;mimeType='';if(uri){matched=uri.match(/[^:]\\w+\\/[\\w-+\\d.]+(?=;|,)/);if(matched){mimeType=matched[0];}}if(mimeType){_type=mimeType.split('/')[0];pickerResult.type=_type;}return _context2.abrupt(\"break\",18);case 17:return _context2.abrupt(\"break\",18);case 18:_context2.next=20;return _regeneratorRuntime.awrap(_handleImagePicked(pickerResult));case 20:case\"end\":return _context2.stop();}}},null,null,null,Promise);};var _errorHandle=function _errorHandle(e){onError&&onError(e);};var _imageError=function _imageError(e){e.nativeEvent.error;onError&&onError(e.nativeEvent.error);};var _handleImagePicked=function _handleImagePicked(pickerResult){var uploadUrl;return _regeneratorRuntime.async(function _handleImagePicked$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:onSelected&&onSelected(pickerResult);setIsUploading(true);setModalVisible(false);_context3.prev=3;if(pickerResult.cancelled){_context3.next=14;break;}if(!(image.uri&&isDeleteFromServerWhenUpload)){_context3.next=8;break;}_context3.next=8;return _regeneratorRuntime.awrap(removeFileFromFirebaseByURL(image.uri));case 8:_context3.next=10;return _regeneratorRuntime.awrap(uploadFileToFirebase(pickerResult.uri,path));case 10:uploadUrl=_context3.sent;onUploaded&&onUploaded({uri:uploadUrl},pickerResult.type);setImage({uri:uploadUrl});onValueChanged&&onValueChanged({uri:uploadUrl});case 14:_context3.next=19;break;case 16:_context3.prev=16;_context3.t0=_context3[\"catch\"](3);_errorHandle(_context3.t0);case 19:_context3.prev=19;setIsUploading(false);return _context3.finish(19);case 22:case\"end\":return _context3.stop();}}},null,null,[[3,16,19,22]],Promise);};var _toggleModal=function _toggleModal(){setModalVisible(!isModalVisible);};var _removePhoto=function _removePhoto(){var removeResult,needRemovePhoto;return _regeneratorRuntime.async(function _removePhoto$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!image.uri){_context4.next=11;break;}if(!isDeleteFromServerWhenRemove){_context4.next=5;break;}_context4.next=4;return _regeneratorRuntime.awrap(removeFileFromFirebaseByURL(image.uri));case 4:removeResult=_context4.sent;case 5:needRemovePhoto=_objectSpread({},image);setImage({uri:''});setModalVisible(false);onRemovePhoto&&onRemovePhoto(needRemovePhoto);_context4.next=12;break;case 11:onRemovePhoto&&onRemovePhoto();case 12:case\"end\":return _context4.stop();}}},null,null,null,Promise);};var _share=function _share(){return _regeneratorRuntime.async(function _share$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _regeneratorRuntime.awrap(Share.share({message:image.uri,title:'Check out this photo',url:image.uri||''}));case 2:case\"end\":return _context5.stop();}}},null,null,null,Promise);};var _maybeRenderUploadingOverlay=function _maybeRenderUploadingOverlay(){if(isUploading){return React.createElement(View,{style:[styles.loadingOverlay,loadingOverlayStyle],__self:_this,__source:{fileName:_jsxFileName,lineNumber:273,columnNumber:17}},React.createElement(ActivityIndicator,_extends({},loadingIndicatorProps,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:275,columnNumber:21}})));}};var _renderImage=function _renderImage(){return React.createElement(View,{style:[styles.imageContainer,sizeStyle,imageContainerStyle],__self:_this,__source:{fileName:_jsxFileName,lineNumber:283,columnNumber:13}},React.createElement(Image,{source:image,style:[styles.image,sizeStyle,imageStyle],onError:_imageError,__self:_this,__source:{fileName:_jsxFileName,lineNumber:285,columnNumber:17}}),isShowUri?React.createElement(CopyableText,{numberOfLines:1,__self:_this,__source:{fileName:_jsxFileName,lineNumber:288,columnNumber:27}},image.uri):null);};var _renderPlaceholder=function _renderPlaceholder(){return React.createElement(View,{style:[styles.placeholderContainer,sizeStyle,placeholderContainerStyle],__self:_this,__source:{fileName:_jsxFileName,lineNumber:297,columnNumber:13}},React.createElement(IcoMoon,{name:placeholderIconName,color:colors.text3,__self:_this,__source:{fileName:_jsxFileName,lineNumber:298,columnNumber:17}}));};var styleJudge=renderPreview?undefined:[styles.container,sizeStyle,style];return React.createElement(SafeAreaView,{style:styleJudge,__self:this,__source:{fileName:_jsxFileName,lineNumber:305,columnNumber:9}},renderPreview?renderPreview({imageSource:image,toggleModal:_toggleModal}):React.createElement(TouchableOpacity,{style:[sizeStyle],onPress:_toggleModal,__self:this,__source:{fileName:_jsxFileName,lineNumber:311,columnNumber:23}},image.uri?_renderImage():_renderPlaceholder(),_maybeRenderUploadingOverlay()),React.createElement(Modal,_extends({isVisible:isModalVisible,onSwipeComplete:function onSwipeComplete(){return setModalVisible(false);},swipeDirection:\"down\",style:styles.modal,onBackdropPress:function onBackdropPress(){return setModalVisible(false);}},modalProps,{__self:this,__source:{fileName:_jsxFileName,lineNumber:317,columnNumber:13}}),React.createElement(View,{style:[styles.modalPanelContainer,modalPanelContainerStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:323,columnNumber:17}},React.createElement(View,{style:[styles.modalPanel,modalPanelStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:324,columnNumber:21}},React.createElement(TextButton,{style:[styles.button,buttonStyle],onPress:_pickImage,__self:this,__source:{fileName:_jsxFileName,lineNumber:325,columnNumber:25}},React.createElement(Text,{style:[styles.buttonText,buttonTextStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:325,columnNumber:95}},\"Open Gallery\")),React.createElement(Divider,{__self:this,__source:{fileName:_jsxFileName,lineNumber:328,columnNumber:25}}),React.createElement(TextButton,{style:[styles.button,buttonStyle],onPress:_takePhoto,__self:this,__source:{fileName:_jsxFileName,lineNumber:329,columnNumber:25}},React.createElement(Text,{style:[styles.buttonText,buttonTextStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:329,columnNumber:95}},\"Take A Photo\")),image.uri?React.createElement(React.Fragment,null,React.createElement(Divider,{__self:this,__source:{fileName:_jsxFileName,lineNumber:337,columnNumber:37}}),React.createElement(TextButton,{onPress:_removePhoto,style:[styles.button,buttonStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:338,columnNumber:37}},React.createElement(Text,{style:[styles.buttonText,buttonTextStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:338,columnNumber:109}},\"Remove Photo\"))):null),React.createElement(View,{style:[styles.modalPanel2,modalPanel2Style],__self:this,__source:{fileName:_jsxFileName,lineNumber:345,columnNumber:21}},React.createElement(TextButton,{style:[styles.button,buttonStyle],onPress:_toggleModal,__self:this,__source:{fileName:_jsxFileName,lineNumber:346,columnNumber:25}},React.createElement(Text,{style:[styles.buttonText,buttonTextStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:346,columnNumber:97}},\"Cancel\"))))));}","map":{"version":3,"sources":["/Users/revone/projects/expo-react-bunny/src/components/ImageUploader/ImageUploader.tsx"],"names":["sizeLabor","themeLabor","wp","useBunnyKit","colors","width","height","source","path","isFullFill","isShowUri","isDeleteFromServerWhenRemove","isDeleteFromServerWhenUpload","style","placeholderContainerStyle","imageContainerStyle","loadingOverlayStyle","modalPanelContainerStyle","modalPanelStyle","modalPanel2Style","imageStyle","buttonStyle","buttonTextStyle","placeholderIconName","modalProps","imagePickerOptions","mediaTypes","ImagePicker","allowsEditing","aspect","quality","cameraPickerOptions","loadingIndicatorProps","color","animating","size","renderPreview","onError","onSelected","onUploaded","onValueChanged","onRemovePhoto","props","sizeStyle","styles","makeStyles","image","setImage","useState","uri","isModalVisible","setModalVisible","isUploading","setIsUploading","useEffect","_takePhoto","isAllowed","Permissions","pickerResult","_handleImagePicked","_pickImage","Platform","mimeType","matched","type","_errorHandle","_imageError","e","removeFileFromFirebaseByURL","uploadUrl","uploadFileToFirebase","_toggleModal","_removePhoto","removeResult","needRemovePhoto","_share","message","title","url","_maybeRenderUploadingOverlay","_renderImage","_renderPlaceholder","styleJudge","imageSource","toggleModal"],"mappings":"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","sourcesContent":["// TODO support ImageSourcePropType\nimport React, {useEffect, useState} from 'react';\nimport {IcoMoon, Text, TextButton} from '../UI';\nimport {\n    ActivityIndicator,\n    ActivityIndicatorProps,\n    Image,\n    ImageErrorEventData,\n    ImageStyle,\n    ImageURISource,\n    NativeSyntheticEvent,\n    Platform,\n    SafeAreaView,\n    Share,\n    StyleProp,\n    TextStyle,\n    TouchableOpacity,\n    View,\n    ViewStyle\n} from 'react-native';\n// import * as CameraRoll from \"@react-native-community/cameraroll\";\nimport {makeStyles} from './styles';\nimport * as ImagePicker from 'expo-image-picker';\nimport {ImagePickerOptions} from 'expo-image-picker';\nimport {Permissions, removeFileFromFirebaseByURL, uploadFileToFirebase} from '../../helpers';\nimport Modal, {ModalProps} from 'react-native-modal';\nimport {Divider} from '../Divider';\nimport {CopyableText} from '../CopyableText';\nimport {IcoMoonKeys} from '../../types';\nimport {useBunnyKit} from '../../hooks/bunny-kit';\n// import ViewShot,{captureRef} from \"react-native-view-shot\";\nexport type UploadedResult = { uri: string }\nexport type RenderPreview = (props: { imageSource: ImageURISource, toggleModal: () => void }) => React.ReactElement | null;\nexport type PickResultType = 'image' | 'video' | undefined;\n\nexport interface ImageUploaderProps {\n    width?: number,\n    height?: number,\n    isFullFill?: boolean,\n    source?: ImageURISource,\n    path?: string,\n    isShowUri?: boolean,\n    isDeleteFromServerWhenRemove?: boolean,\n    isDeleteFromServerWhenUpload?: boolean,\n\n    style?: StyleProp<ViewStyle>,\n    imageContainerStyle?: StyleProp<ViewStyle>,\n    placeholderContainerStyle?: StyleProp<ViewStyle>,\n    modalPanelContainerStyle?: StyleProp<ViewStyle>,\n    modalPanelStyle?: StyleProp<ViewStyle>,\n    modalPanel2Style?: StyleProp<ViewStyle>,\n    imageStyle?: StyleProp<ImageStyle>,\n    loadingOverlayStyle?: StyleProp<ViewStyle>,\n    buttonStyle?: StyleProp<ViewStyle>,\n    buttonTextStyle?: StyleProp<TextStyle>,\n\n    placeholderIconName?: IcoMoonKeys,\n    imagePickerOptions?: ImagePickerOptions,\n    cameraPickerOptions?: ImagePickerOptions,\n    modalProps?: ModalProps,\n    loadingIndicatorProps?: ActivityIndicatorProps,\n\n    renderPreview?: RenderPreview,\n\n    onError?: (error: Error) => void,\n    onSelected?: (pickResult: ImagePicker.ImagePickerResult) => void,\n    onUploaded?: (uploadedResult: UploadedResult, type?: PickResultType) => void,\n    onValueChanged?: (imageSource: ImageURISource) => void,\n    onRemovePhoto?: (imageSource?: ImageURISource) => void,\n}\n\nexport function ImageUploader(props: ImageUploaderProps) {\n    const {sizeLabor, themeLabor, wp} = useBunnyKit();\n    const {colors} = themeLabor.theme;\n    const {\n        width = wp(200),\n        height = wp(200),\n        source,\n        path,\n        isFullFill = false,\n        isShowUri = false,\n        isDeleteFromServerWhenRemove = true,\n        isDeleteFromServerWhenUpload = true,\n\n        style,\n        placeholderContainerStyle,\n        imageContainerStyle,\n        loadingOverlayStyle,\n        modalPanelContainerStyle,\n        modalPanelStyle,\n        modalPanel2Style,\n        imageStyle,\n        buttonStyle,\n        buttonTextStyle,\n\n        placeholderIconName = 'plus',\n        modalProps,\n        imagePickerOptions = {\n            mediaTypes: ImagePicker.MediaTypeOptions.All,\n            allowsEditing: true,\n            aspect: [4, 3],\n            quality: 0.2,\n        } as ImagePickerOptions,\n        cameraPickerOptions = {\n            mediaTypes: ImagePicker.MediaTypeOptions.All,\n            allowsEditing: true,\n            aspect: [4, 3],\n            quality: 0.2,\n        } as ImagePickerOptions,\n        loadingIndicatorProps = {\n            color: colors.text,\n            animating: true,\n            size: 'large'\n        },\n\n        renderPreview,\n\n        onError,\n        onSelected,\n        onUploaded,\n        onValueChanged,\n        onRemovePhoto,\n    } = props;\n    const sizeStyle = {width: isFullFill ? '100%' : width, height: isFullFill ? '100%' : height};\n    const styles = makeStyles(sizeLabor, themeLabor);\n    const [image, setImage] = useState<ImageURISource>(source || {uri: ''});\n    const [isModalVisible, setModalVisible] = useState(false);\n    const [isUploading, setIsUploading] = useState(false);\n    // const screenshotIt = useRef<ViewShot>(null)\n\n    useEffect(() => {\n        setImage(source || {uri: ''});\n    }, [source]);\n\n    const _takePhoto = async () => {\n        const isAllowed = await Permissions.camera.get();\n        if (!isAllowed) {\n            return;\n        }\n        let pickerResult = await ImagePicker.launchCameraAsync(cameraPickerOptions);\n        await _handleImagePicked(pickerResult);\n    };\n\n    const _pickImage = async () => {\n        const isAllowed = await Permissions.mediaLibrary.get();\n        if (!isAllowed) {\n            return;\n        }\n        let pickerResult = await ImagePicker.launchImageLibraryAsync(imagePickerOptions);\n        // const iOS = {\n        //     \"cancelled\": false,\n        //     \"duration\": 19181.66796875,\n        //     \"height\": 1792,\n        //     \"type\": \"video\",\n        //     \"uri\": \"file:///var/mobile/Containers/Data/Application/A2D459FE-B246-4823-92C0-023BCB216EC3/Library/Caches/ExponentExperienceData/%2540zrwusa%252Fexpo-react-bunny/ImagePicker/EE48EAD8-6717-488D-94D6-2C834E561553.mov\",\n        //     \"width\": 828,\n        // }\n        // const web = {\n        //     cancelled: false,\n        //     height: 0,\n        //     uri: \"data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21\",\n        //     width: 0\n        // }\n        if (!pickerResult.cancelled) {\n            // fixed expo-image-picker did not give a type on web platform\n            switch (Platform.OS) {\n                case 'web':\n                    const {uri} = pickerResult;\n                    let mimeType = '';\n                    if (uri) {\n                        const matched = uri.match(/[^:]\\w+\\/[\\w-+\\d.]+(?=;|,)/);\n                        if (matched) {\n                            mimeType = matched[0];\n                        }\n                    }\n                    if (mimeType) {\n                        const type = mimeType.split('/')[0];\n                        pickerResult.type = type as 'image' | 'video' | undefined;\n                    }\n                    break;\n                default:\n                    break;\n            }\n        }\n\n        await _handleImagePicked(pickerResult);\n    };\n\n    const _errorHandle = (e: Error) => {\n        onError && onError(e);\n    };\n\n    const _imageError = (e: NativeSyntheticEvent<ImageErrorEventData>) => {\n        e.nativeEvent.error;\n        onError && onError(e.nativeEvent.error);\n    };\n\n    const _handleImagePicked = async (pickerResult: ImagePicker.ImagePickerResult) => {\n        onSelected && onSelected(pickerResult);\n        setIsUploading(true);\n        setModalVisible(false);\n        try {\n            if (!pickerResult.cancelled) {\n                if (image.uri && isDeleteFromServerWhenUpload) {\n                    await removeFileFromFirebaseByURL(image.uri);\n                }\n                const uploadUrl = await uploadFileToFirebase(pickerResult.uri, path);\n                onUploaded && onUploaded({uri: uploadUrl}, pickerResult.type);\n                setImage({uri: uploadUrl});\n                onValueChanged && onValueChanged({uri: uploadUrl});\n            }\n        } catch (e: any) {\n            _errorHandle(e);\n        } finally {\n            setIsUploading(false);\n        }\n    };\n\n    const _toggleModal = () => {\n        setModalVisible(!isModalVisible);\n    };\n\n    const _removePhoto = async () => {\n        if (image.uri) {\n            if (isDeleteFromServerWhenRemove) {\n                const removeResult = await removeFileFromFirebaseByURL(image.uri);\n            }\n            const needRemovePhoto = {...image};\n            setImage({uri: ''});\n            setModalVisible(false);\n            onRemovePhoto && onRemovePhoto(needRemovePhoto);\n        } else {\n            onRemovePhoto && onRemovePhoto();\n        }\n    };\n    const _share = async () => {\n        await Share.share({\n            message: image.uri,\n            title: 'Check out this photo',\n            url: image.uri || '',\n        });\n    };\n\n    // const _takeScreenshot = async () => {\n    //     console.log(\"pre..\");\n    //     // console.log(screenshotIt);\n    //     console.log(\"pre.2\");\n    //     let ss = await captureRef(screenshotIt, {\n    //         format: 'png',\n    //         quality: 0.6,\n    //         // width: Dimensions.get('screen').width,\n    //         // height: Dimensions.get('screen').height,\n    //         // snapshotContentContainer: true,\n    //     })\n    //     // let ss = await screenshotIt.current.capture()\n    //     // let ss = await Expo.takeSnapshotAsync(screenshotIt, {\n    //     //     format: 'png',\n    //     //     quality: 0.6,\n    //     //     result: 'file',\n    //     //     // width: Dimensions.get('screen').width,\n    //     //     // height: Dimensions.get('screen').height,\n    //     //     // snapshotContentContainer: true,\n    //     // });\n    //     console.log(\"taking a snap\");\n    //     console.log('---ss',ss)\n    //     // await CameraRoll.save(ss);\n    //     await _handleImagePicked(ss);\n    // };\n\n    const _maybeRenderUploadingOverlay = () => {\n        if (isUploading) {\n            return (\n                <View\n                    style={[styles.loadingOverlay, loadingOverlayStyle]}>\n                    <ActivityIndicator {...loadingIndicatorProps}/>\n                </View>\n            );\n        }\n    };\n\n    const _renderImage = () => {\n        return (\n            <View\n                style={[styles.imageContainer, sizeStyle, imageContainerStyle]}>\n                <Image source={image} style={[styles.image, sizeStyle, imageStyle]} onError={_imageError}/>\n                {\n                    isShowUri\n                        ? <CopyableText numberOfLines={1}>{image.uri}</CopyableText>\n                        : null\n                }\n            </View>\n        );\n    };\n\n    const _renderPlaceholder = () => {\n        return (\n            <View style={[styles.placeholderContainer, sizeStyle, placeholderContainerStyle]}>\n                <IcoMoon name={placeholderIconName} color={colors.text3}/>\n            </View>\n        );\n    };\n\n    const styleJudge: StyleProp<ViewStyle> = renderPreview ? undefined : [styles.container, sizeStyle, style];\n    return (\n        <SafeAreaView\n            // ref={screenshotIt}\n            style={styleJudge}>\n            {\n                renderPreview\n                    ? renderPreview({imageSource: image, toggleModal: _toggleModal})\n                    : <TouchableOpacity style={[sizeStyle]} onPress={_toggleModal}>\n                        {image.uri ? _renderImage() : _renderPlaceholder()}\n                        {_maybeRenderUploadingOverlay()}\n                    </TouchableOpacity>\n            }\n\n            <Modal isVisible={isModalVisible}\n                   onSwipeComplete={() => setModalVisible(false)}\n                   swipeDirection=\"down\"\n                   style={styles.modal}\n                   onBackdropPress={() => setModalVisible(false)}\n                   {...modalProps}>\n                <View style={[styles.modalPanelContainer, modalPanelContainerStyle]}>\n                    <View style={[styles.modalPanel, modalPanelStyle]}>\n                        <TextButton style={[styles.button, buttonStyle]} onPress={_pickImage}><Text\n                            style={[styles.buttonText, buttonTextStyle]}>Open\n                            Gallery</Text></TextButton>\n                        <Divider/>\n                        <TextButton style={[styles.button, buttonStyle]} onPress={_takePhoto}><Text\n                            style={[styles.buttonText, buttonTextStyle]}>Take\n                            A Photo</Text></TextButton>\n                        {/*<Divider/>*/}\n                        {/*<TextButton onPress={_takeScreenshot}><Text>Take a screenshot</Text></TextButton>*/}\n                        {\n                            image.uri\n                                ? <>\n                                    <Divider/>\n                                    <TextButton onPress={_removePhoto} style={[styles.button, buttonStyle]}><Text\n                                        style={[styles.buttonText, buttonTextStyle]}>Remove\n                                        Photo</Text></TextButton>\n                                </>\n                                : null\n                        }\n                    </View>\n                    <View style={[styles.modalPanel2, modalPanel2Style]}>\n                        <TextButton style={[styles.button, buttonStyle]} onPress={_toggleModal}><Text\n                            style={[styles.buttonText, buttonTextStyle]}>Cancel</Text></TextButton>\n                    </View>\n                </View>\n            </Modal>\n        </SafeAreaView>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}