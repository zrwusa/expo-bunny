{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import React from'react';import{apiAuth}from\"../../helpers/auth-api\";import BunnyConstants,{EBizLogicMsg}from\"../../constants/constants\";import AsyncStorage from'@react-native-async-storage/async-storage';import*as Google from'expo-google-app-auth';import _,{identity,pickBy}from'lodash';import{bizLogicError,bizLogicSuccess}from\"../../helpers/helpers\";import{EventRegister}from'react-native-event-listeners';import{firebase}from\"../../firebase/firebase\";import*as Facebook from'expo-facebook';var config={loginAPIMethod:'PUT',loginAPIPath:'/api/auth/login',signUpAPIMethod:'POST',signUpAPIPath:'/api/auth/register',refreshAPIMethod:'PUT',refreshAPIPath:'/api/auth/refresh',accessTokenValuePath:'access_token',accessTokenExpValuePath:'access_token_exp',refreshTokenValuePath:'refresh_token',refreshTokenExpValuePath:'refresh_token_exp',userValuePath:'user',accessTokenPersistenceKey:BunnyConstants.ACCESS_TOKEN_PERSISTENCE_KEY,accessTokenExpPersistenceKey:BunnyConstants.ACCESS_TOKEN_EXP_PERSISTENCE_KEY,refreshTokenPersistenceKey:BunnyConstants.REFRESH_TOKEN_PERSISTENCE_KEY,refreshTokenExpPersistenceKey:BunnyConstants.REFRESH_TOKEN_EXP_PERSISTENCE_KEY,userPersistenceKey:BunnyConstants.USER_PERSISTENCE_KEY,storageType:'LOCAL_STORAGE'};var accessTokenPersistenceKey=config.accessTokenPersistenceKey,accessTokenExpValuePath=config.accessTokenExpValuePath,accessTokenExpPersistenceKey=config.accessTokenExpPersistenceKey,refreshTokenPersistenceKey=config.refreshTokenPersistenceKey,refreshTokenExpValuePath=config.refreshTokenExpValuePath,refreshTokenExpPersistenceKey=config.refreshTokenExpPersistenceKey,userPersistenceKey=config.userPersistenceKey,loginAPIPath=config.loginAPIPath,signUpAPIPath=config.signUpAPIPath,accessTokenValuePath=config.accessTokenValuePath,refreshAPIMethod=config.refreshAPIMethod,loginAPIMethod=config.loginAPIMethod,signUpAPIMethod=config.signUpAPIMethod,refreshAPIPath=config.refreshAPIPath,refreshTokenValuePath=config.refreshTokenValuePath,userValuePath=config.userValuePath;var persistenceAuth=function persistenceAuth(_ref){var accessToken,refreshToken,user,accessTokenExp,refreshTokenExp;return _regeneratorRuntime.async(function persistenceAuth$(_context){while(1){switch(_context.prev=_context.next){case 0:accessToken=_ref.accessToken,refreshToken=_ref.refreshToken,user=_ref.user,accessTokenExp=_ref.accessTokenExp,refreshTokenExp=_ref.refreshTokenExp;_context.prev=1;_context.t0=accessToken;if(!_context.t0){_context.next=6;break;}_context.next=6;return _regeneratorRuntime.awrap(AsyncStorage.setItem(accessTokenPersistenceKey,accessToken));case 6:_context.t1=accessTokenExp;if(!_context.t1){_context.next=10;break;}_context.next=10;return _regeneratorRuntime.awrap(AsyncStorage.setItem(accessTokenExpPersistenceKey,accessTokenExp.toString()));case 10:_context.t2=refreshTokenExp;if(!_context.t2){_context.next=14;break;}_context.next=14;return _regeneratorRuntime.awrap(AsyncStorage.setItem(refreshTokenExpPersistenceKey,refreshTokenExp.toString()));case 14:_context.t3=refreshToken;if(!_context.t3){_context.next=18;break;}_context.next=18;return _regeneratorRuntime.awrap(AsyncStorage.setItem(refreshTokenPersistenceKey,refreshToken));case 18:_context.t4=user;if(!_context.t4){_context.next=22;break;}_context.next=22;return _regeneratorRuntime.awrap(AsyncStorage.setItem(userPersistenceKey,JSON.stringify(user)));case 22:_context.next=27;break;case 24:_context.prev=24;_context.t5=_context[\"catch\"](1);console.error(_context.t5);case 27:case\"end\":return _context.stop();}}},null,null,[[1,24]],Promise);};var triggerLogin=function triggerLogin(result){var success,data;return _regeneratorRuntime.async(function triggerLogin$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:success=result.success,data=result.data;if(!success){_context2.next=4;break;}_context2.next=4;return _regeneratorRuntime.awrap(persistenceAuth(data));case 4:EventRegister.emit('login',result);_context2.next=7;return _regeneratorRuntime.awrap(checkIsLogin());case 7:case\"end\":return _context2.stop();}}},null,null,null,Promise);};var loginOrSignUp=function loginOrSignUp(res){var result,data,accessToken,refreshToken,accessTokenExp,refreshTokenExp,user;return _regeneratorRuntime.async(function loginOrSignUp$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(res){_context3.next=5;break;}result=bizLogicError(EBizLogicMsg.NO_AUTH_API_RESPONDED);_context3.next=4;return _regeneratorRuntime.awrap(triggerLogin(result));case 4:return _context3.abrupt(\"return\",result);case 5:data=res.data.data;if(data){_context3.next=11;break;}result=bizLogicError(EBizLogicMsg.NO_DATA_RESPONDED);_context3.next=10;return _regeneratorRuntime.awrap(triggerLogin(result));case 10:return _context3.abrupt(\"return\",result);case 11:accessToken=_.get(data,accessTokenValuePath);refreshToken=_.get(data,refreshTokenValuePath);accessTokenExp=_.get(data,accessTokenExpValuePath);refreshTokenExp=_.get(data,refreshTokenExpValuePath);user=_.get(data,userValuePath);if(accessToken&&refreshToken){_context3.next=21;break;}result=bizLogicError(EBizLogicMsg.NO_ACCESS_TOKEN_OR_REFRESH_TOKEN_RESPONDED);_context3.next=20;return _regeneratorRuntime.awrap(triggerLogin(result));case 20:return _context3.abrupt(\"return\",result);case 21:if(user){_context3.next=26;break;}result=bizLogicError(EBizLogicMsg.NO_USER_INFO_RESPONDED);_context3.next=25;return _regeneratorRuntime.awrap(triggerLogin(result));case 25:return _context3.abrupt(\"return\",result);case 26:result=bizLogicSuccess({accessToken:accessToken,accessTokenExp:accessTokenExp,refreshToken:refreshToken,refreshTokenExp:refreshTokenExp,user:{bunnyUser:user}});_context3.next=29;return _regeneratorRuntime.awrap(triggerLogin(result));case 29:return _context3.abrupt(\"return\",result);case 30:case\"end\":return _context3.stop();}}},null,null,null,Promise);};var bunnyLogin=function bunnyLogin(params){var res;return _regeneratorRuntime.async(function bunnyLogin$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(apiAuth.request({method:loginAPIMethod,url:loginAPIPath,data:params}));case 2:res=_context4.sent;_context4.next=5;return _regeneratorRuntime.awrap(loginOrSignUp(res));case 5:return _context4.abrupt(\"return\",_context4.sent);case 6:case\"end\":return _context4.stop();}}},null,null,null,Promise);};var bunnySignUp=function bunnySignUp(params){var res;return _regeneratorRuntime.async(function bunnySignUp$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _regeneratorRuntime.awrap(apiAuth.request({method:signUpAPIMethod,url:signUpAPIPath,data:params}));case 2:res=_context5.sent;_context5.next=5;return _regeneratorRuntime.awrap(loginOrSignUp(res));case 5:return _context5.abrupt(\"return\",_context5.sent);case 6:case\"end\":return _context5.stop();}}},null,null,null,Promise);};var bunnyRefreshAuth=function bunnyRefreshAuth(){var refreshToken,res,result,data,accessToken,accessTokenExp;return _regeneratorRuntime.async(function bunnyRefreshAuth$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return _regeneratorRuntime.awrap(AsyncStorage.getItem(refreshTokenPersistenceKey));case 2:refreshToken=_context6.sent;apiAuth.defaults.headers.common['Authorization']=\"Bearer \"+refreshToken;_context6.next=6;return _regeneratorRuntime.awrap(apiAuth.request({method:refreshAPIMethod,url:refreshAPIPath}));case 6:res=_context6.sent;if(res){_context6.next=11;break;}result=bizLogicError(EBizLogicMsg.NO_AUTH_API_RESPONDED);EventRegister.emit('bunnyRefreshAuth',result);return _context6.abrupt(\"return\",result);case 11:data=res.data.data;if(data){_context6.next=16;break;}result=bizLogicError(EBizLogicMsg.NO_DATA_RESPONDED);EventRegister.emit('bunnyRefreshAuth',result);return _context6.abrupt(\"return\",result);case 16:accessToken=_.get(data,accessTokenValuePath);accessTokenExp=_.get(data,accessTokenExpValuePath);if(accessToken){_context6.next=22;break;}result=bizLogicError(EBizLogicMsg.NO_ACCESS_TOKEN_RESPONDED);EventRegister.emit('bunnyRefreshAuth',result);return _context6.abrupt(\"return\",result);case 22:_context6.next=24;return _regeneratorRuntime.awrap(persistenceAuth({accessToken:accessToken,accessTokenExp:accessTokenExp}));case 24:result=bizLogicSuccess(accessToken);EventRegister.emit('bunnyRefreshAuth',result);return _context6.abrupt(\"return\",result);case 27:case\"end\":return _context6.stop();}}},null,null,null,Promise);};var logOut=function logOut(triggerType){var res,_await$removePersiste,success,message,result;return _regeneratorRuntime.async(function logOut$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return _regeneratorRuntime.awrap(firebase.auth().signOut());case 2:res=_context7.sent;_context7.next=5;return _regeneratorRuntime.awrap(removePersistenceAuth());case 5:_await$removePersiste=_context7.sent;success=_await$removePersiste.success;message=_await$removePersiste.message;if(!success){_context7.next=19;break;}result=bizLogicSuccess(true);EventRegister.emit('LogOut',result);_context7.next=13;return _regeneratorRuntime.awrap(checkIsLogin());case 13:if(!triggerType){_context7.next=16;break;}_context7.next=16;return _regeneratorRuntime.awrap(authTrigger(triggerType));case 16:return _context7.abrupt(\"return\",result);case 19:result=bizLogicError(message);EventRegister.emit('LogOut',result);_context7.next=23;return _regeneratorRuntime.awrap(checkIsLogin());case 23:return _context7.abrupt(\"return\",result);case 24:case\"end\":return _context7.stop();}}},null,null,null,Promise);};var dummyLogin=function dummyLogin(){var accessToken,refreshToken,user,accessTokenExp,refreshTokenExp,result;return _regeneratorRuntime.async(function dummyLogin$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:accessToken='access_token_dummy';refreshToken='refresh_token_dummy';user={email:'dummy@dummy.com',nickname:'dummy nickname'};accessTokenExp='3043008000000';refreshTokenExp='3043008000000';result=bizLogicSuccess({accessToken:accessToken,accessTokenExp:accessTokenExp,refreshToken:refreshToken,refreshTokenExp:refreshTokenExp,user:user});_context8.next=8;return _regeneratorRuntime.awrap(triggerLogin(result));case 8:return _context8.abrupt(\"return\",result);case 9:case\"end\":return _context8.stop();}}},null,null,null,Promise);};var googleLogin=function googleLogin(isFirebase){var isStoreUser,googleResponse,result,idToken,accessToken,refreshToken,user,credential,userCredential,_args9=arguments;return _regeneratorRuntime.async(function googleLogin$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:isStoreUser=_args9.length>1&&_args9[1]!==undefined?_args9[1]:true;_context9.next=3;return _regeneratorRuntime.awrap(Google.logInAsync({iosClientId:\"885187778268-sa6e0rubaqe1idh6323trqfdi6giqcsq.apps.googleusercontent.com\",androidClientId:\"885187778268-nfajf46vtpsk8uro4o8m42tgdosbr638.apps.googleusercontent.com\",iosStandaloneAppClientId:\"885187778268-gpa16i4lra9rjllqeblif6rq33dut3av.apps.googleusercontent.com\",androidStandaloneAppClientId:\"885187778268-fp953l5m38bh81ibesd0ld4lboqaal9f.apps.googleusercontent.com\"}));case 3:googleResponse=_context9.sent;if(!googleResponse){result=bizLogicError(EBizLogicMsg.NO_GOOGLE_LOGIN_RESULT);}_context9.t0=googleResponse.type;_context9.next=_context9.t0==='cancel'?8:_context9.t0==='success'?10:26;break;case 8:result=bizLogicError(EBizLogicMsg.GOOGLE_LOGIN_CANCELED);return _context9.abrupt(\"break\",28);case 10:idToken=googleResponse.idToken,accessToken=googleResponse.accessToken,refreshToken=googleResponse.refreshToken,user=googleResponse.user;if(!accessToken||!refreshToken){result=bizLogicError(EBizLogicMsg.GOOGLE_ACCESS_TOKEN_OR_REFRESH_TOKEN_NOT_EXISTS);}if(!isFirebase){_context9.next=24;break;}_context9.next=15;return _regeneratorRuntime.awrap(firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL));case 15:credential=firebase.auth.GoogleAuthProvider.credential(idToken,accessToken);_context9.next=18;return _regeneratorRuntime.awrap(firebase.auth().signInWithCredential(credential));case 18:userCredential=_context9.sent;_context9.next=21;return _regeneratorRuntime.awrap(firebaseLoginResult(userCredential,isStoreUser));case 21:result=_context9.sent;_context9.next=25;break;case 24:result=bizLogicSuccess({accessToken:accessToken,refreshToken:refreshToken,user:{googleUser:user}});case 25:return _context9.abrupt(\"break\",28);case 26:result=bizLogicError(EBizLogicMsg.GOOGLE_LOGIN_RESULT_TYPE_INVALID);return _context9.abrupt(\"break\",28);case 28:_context9.next=30;return _regeneratorRuntime.awrap(triggerLogin(result));case 30:return _context9.abrupt(\"return\",result);case 31:case\"end\":return _context9.stop();}}},null,null,null,Promise);};var firebaseLoginResult=function firebaseLoginResult(userCredential){var isStoreUser,idToken,user,currentUser,storedUser,_args10=arguments;return _regeneratorRuntime.async(function firebaseLoginResult$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:isStoreUser=_args10.length>1&&_args10[1]!==undefined?_args10[1]:true;if(!(!userCredential||!userCredential.user)){_context10.next=3;break;}return _context10.abrupt(\"return\",bizLogicError(EBizLogicMsg.FIREBASE_INVALID_USER_CREDENTIAL));case 3:currentUser=firebase.auth().currentUser;if(!currentUser){_context10.next=16;break;}_context10.next=7;return _regeneratorRuntime.awrap(currentUser.getIdToken());case 7:idToken=_context10.sent;user=currentUser.toJSON();if(!isStoreUser){_context10.next=13;break;}_context10.next=12;return _regeneratorRuntime.awrap(storeUserInfo(userCredential));case 12:storedUser=_context10.sent;case 13:return _context10.abrupt(\"return\",bizLogicSuccess({accessToken:idToken,refreshToken:user.refreshToken,user:{firebaseUser:user,storedUser:storedUser}}));case 16:return _context10.abrupt(\"return\",bizLogicError(EBizLogicMsg.FIREBASE_INVALID_CURRENT_USER));case 17:case\"end\":return _context10.stop();}}},null,null,null,Promise);};var facebookLogin=function facebookLogin(isFirebase){var isStoreUser,result,facebookResponse,type,token,credential,userCredential,facebookGetMeResponse,user,_args11=arguments;return _regeneratorRuntime.async(function facebookLogin$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:isStoreUser=_args11.length>1&&_args11[1]!==undefined?_args11[1]:true;_context11.next=3;return _regeneratorRuntime.awrap(Facebook.initializeAsync({appId:\"1077883556032942\"}));case 3:_context11.next=5;return _regeneratorRuntime.awrap(Facebook.logInWithReadPermissionsAsync({permissions:['public_profile','email']}));case 5:facebookResponse=_context11.sent;type=facebookResponse.type;_context11.t0=type;_context11.next=_context11.t0==='cancel'?10:_context11.t0==='success'?12:31;break;case 10:result=bizLogicError(EBizLogicMsg.FACEBOOK_LOGIN_CANCELED);return _context11.abrupt(\"break\",33);case 12:token=facebookResponse.token;if(!isFirebase){_context11.next=23;break;}credential=firebase.auth.FacebookAuthProvider.credential(token);_context11.next=17;return _regeneratorRuntime.awrap(firebase.auth().signInWithCredential(credential));case 17:userCredential=_context11.sent;_context11.next=20;return _regeneratorRuntime.awrap(firebaseLoginResult(userCredential,isStoreUser));case 20:result=_context11.sent;_context11.next=30;break;case 23:_context11.next=25;return _regeneratorRuntime.awrap(fetch(\"https://graph.facebook.com/me?access_token=\"+token));case 25:facebookGetMeResponse=_context11.sent;_context11.next=28;return _regeneratorRuntime.awrap(facebookGetMeResponse.json());case 28:user=_context11.sent;result=bizLogicSuccess({accessToken:token,user:{facebookUser:user}});case 30:return _context11.abrupt(\"break\",33);case 31:result=bizLogicError(EBizLogicMsg.FACEBOOK_LOGIN_RESULT_TYPE_INVALID);return _context11.abrupt(\"break\",33);case 33:_context11.next=35;return _regeneratorRuntime.awrap(triggerLogin(result));case 35:return _context11.abrupt(\"return\",result);case 36:case\"end\":return _context11.stop();}}},null,null,null,Promise);};var firebaseEmailLogin=function firebaseEmailLogin(email,password){var isStoreUser,userCredential,result,_args12=arguments;return _regeneratorRuntime.async(function firebaseEmailLogin$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:isStoreUser=_args12.length>2&&_args12[2]!==undefined?_args12[2]:true;_context12.next=3;return _regeneratorRuntime.awrap(firebase.auth().signInWithEmailAndPassword(email,password));case 3:userCredential=_context12.sent;_context12.next=6;return _regeneratorRuntime.awrap(firebaseLoginResult(userCredential,isStoreUser));case 6:result=_context12.sent;_context12.next=9;return _regeneratorRuntime.awrap(triggerLogin(result));case 9:return _context12.abrupt(\"return\",result);case 10:case\"end\":return _context12.stop();}}},null,null,null,Promise);};var storeUserInfo=function storeUserInfo(userCredential){var _userCredential$user;var user,displayName,email,phoneNumber,photoURL,providerId,uid,extractedUser,cleanedExtractedUser,usersRef,userInfoSnapshot;return _regeneratorRuntime.async(function storeUserInfo$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:user=(_userCredential$user=userCredential.user)==null?void 0:_userCredential$user.toJSON();if(!user){_context13.next=14;break;}displayName=user.displayName,email=user.email,phoneNumber=user.phoneNumber,photoURL=user.photoURL,providerId=user.providerId,uid=user.uid;extractedUser={displayName:displayName,email:email,phoneNumber:phoneNumber,photoURL:photoURL,providerId:providerId,uid:uid};cleanedExtractedUser=pickBy(extractedUser,identity);usersRef=firebase.firestore().collection('users');_context13.next=8;return _regeneratorRuntime.awrap(usersRef.doc(uid).set(cleanedExtractedUser,{merge:true}));case 8:_context13.next=10;return _regeneratorRuntime.awrap(usersRef.doc(uid).get({source:'server'}));case 10:userInfoSnapshot=_context13.sent;return _context13.abrupt(\"return\",userInfoSnapshot.data());case 14:return _context13.abrupt(\"return\");case 15:case\"end\":return _context13.stop();}}},null,null,null,Promise);};var firebaseEmailSignUp=function firebaseEmailSignUp(email,password){var isStoreUser,userCredential,result,_args14=arguments;return _regeneratorRuntime.async(function firebaseEmailSignUp$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:isStoreUser=_args14.length>2&&_args14[2]!==undefined?_args14[2]:true;_context14.next=3;return _regeneratorRuntime.awrap(firebase.auth().createUserWithEmailAndPassword(email,password));case 3:userCredential=_context14.sent;_context14.next=6;return _regeneratorRuntime.awrap(firebaseLoginResult(userCredential,isStoreUser));case 6:result=_context14.sent;_context14.next=9;return _regeneratorRuntime.awrap(triggerLogin(result));case 9:return _context14.abrupt(\"return\",result);case 10:case\"end\":return _context14.stop();}}},null,null,null,Promise);};var firebaseSendOTP=function firebaseSendOTP(phoneInfoOptions,applicationVerifier){var phoneProvider,verificationId;return _regeneratorRuntime.async(function firebaseSendOTP$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:phoneProvider=new firebase.auth.PhoneAuthProvider();_context15.next=3;return _regeneratorRuntime.awrap(phoneProvider.verifyPhoneNumber(phoneInfoOptions,applicationVerifier));case 3:verificationId=_context15.sent;return _context15.abrupt(\"return\",bizLogicSuccess({verificationId:verificationId}));case 5:case\"end\":return _context15.stop();}}},null,null,null,Promise);};var firebaseConfirmOTP=function firebaseConfirmOTP(verificationId,verificationCode){var isStoreUser,credential,userCredential,result,_args16=arguments;return _regeneratorRuntime.async(function firebaseConfirmOTP$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:isStoreUser=_args16.length>2&&_args16[2]!==undefined?_args16[2]:true;credential=firebase.auth.PhoneAuthProvider.credential(verificationId,verificationCode);_context16.next=4;return _regeneratorRuntime.awrap(firebase.auth().signInWithCredential(credential));case 4:userCredential=_context16.sent;_context16.next=7;return _regeneratorRuntime.awrap(firebaseLoginResult(userCredential,isStoreUser));case 7:result=_context16.sent;_context16.next=10;return _regeneratorRuntime.awrap(triggerLogin(result));case 10:return _context16.abrupt(\"return\",result);case 11:case\"end\":return _context16.stop();}}},null,null,null,Promise);};var firebaseResetPassword=function firebaseResetPassword(email){return _regeneratorRuntime.async(function firebaseResetPassword$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:_context17.next=2;return _regeneratorRuntime.awrap(firebase.auth().sendPasswordResetEmail(email));case 2:return _context17.abrupt(\"return\",bizLogicSuccess(true));case 3:case\"end\":return _context17.stop();}}},null,null,null,Promise);};var removePersistenceAuth=function removePersistenceAuth(authParam){return _regeneratorRuntime.async(function removePersistenceAuth$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:if(!(authParam&&authParam.length>0)){_context18.next=22;break;}_context18.t0=authParam.includes('accessToken');if(!_context18.t0){_context18.next=5;break;}_context18.next=5;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(accessTokenPersistenceKey));case 5:_context18.t1=authParam.includes('accessTokenExp');if(!_context18.t1){_context18.next=9;break;}_context18.next=9;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(accessTokenExpPersistenceKey));case 9:_context18.t2=authParam.includes('refreshToken');if(!_context18.t2){_context18.next=13;break;}_context18.next=13;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(refreshTokenPersistenceKey));case 13:_context18.t3=authParam.includes('refreshTokenExp');if(!_context18.t3){_context18.next=17;break;}_context18.next=17;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(refreshTokenExpPersistenceKey));case 17:_context18.t4=authParam.includes('user');if(!_context18.t4){_context18.next=21;break;}_context18.next=21;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(userPersistenceKey));case 21:return _context18.abrupt(\"return\",bizLogicSuccess(true));case 22:_context18.next=24;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(accessTokenPersistenceKey));case 24:_context18.next=26;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(accessTokenExpPersistenceKey));case 26:_context18.next=28;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(refreshTokenExpPersistenceKey));case 28:_context18.next=30;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(refreshTokenPersistenceKey));case 30:_context18.next=32;return _regeneratorRuntime.awrap(AsyncStorage.removeItem(userPersistenceKey));case 32:return _context18.abrupt(\"return\",bizLogicSuccess(true));case 33:case\"end\":return _context18.stop();}}},null,null,null,Promise);};var getPersistenceAuth=function getPersistenceAuth(){var accessToken,refreshToken,user,accessTokenExp,refreshTokenExp;return _regeneratorRuntime.async(function getPersistenceAuth$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:_context19.next=2;return _regeneratorRuntime.awrap(AsyncStorage.getItem(accessTokenPersistenceKey));case 2:accessToken=_context19.sent;_context19.next=5;return _regeneratorRuntime.awrap(AsyncStorage.getItem(refreshTokenPersistenceKey));case 5:refreshToken=_context19.sent;_context19.next=8;return _regeneratorRuntime.awrap(AsyncStorage.getItem(userPersistenceKey));case 8:user=_context19.sent;_context19.next=11;return _regeneratorRuntime.awrap(AsyncStorage.getItem(accessTokenExpPersistenceKey));case 11:accessTokenExp=_context19.sent;_context19.next=14;return _regeneratorRuntime.awrap(AsyncStorage.getItem(refreshTokenExpPersistenceKey));case 14:refreshTokenExp=_context19.sent;return _context19.abrupt(\"return\",{accessToken:accessToken,accessTokenExp:accessTokenExp,refreshToken:refreshToken,refreshTokenExp:refreshTokenExp,user:user?JSON.parse(user):undefined});case 16:case\"end\":return _context19.stop();}}},null,null,null,Promise);};var authTrigger=function authTrigger(triggerType){EventRegister.emit('authTrigger',triggerType);};var checkTokenExp=function checkTokenExp(){var itvID=setInterval(function _callee(){var refreshTokenExp,now,exp;return _regeneratorRuntime.async(function _callee$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:_context20.next=2;return _regeneratorRuntime.awrap(AsyncStorage.getItem(refreshTokenExpPersistenceKey));case 2:refreshTokenExp=_context20.sent;now=new Date();exp=new Date(0);if(!refreshTokenExp){_context20.next=10;break;}exp.setUTCSeconds(parseInt(refreshTokenExp));if(!(now>exp)){_context20.next=10;break;}_context20.next=10;return _regeneratorRuntime.awrap(logOut('AUTO'));case 10:case\"end\":return _context20.stop();}}},null,null,null,Promise);},1000);};var checkIsLogin=function checkIsLogin(){var _await$getPersistence,accessToken,isLogin;return _regeneratorRuntime.async(function checkIsLogin$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:_context21.next=2;return _regeneratorRuntime.awrap(getPersistenceAuth());case 2:_await$getPersistence=_context21.sent;accessToken=_await$getPersistence.accessToken;isLogin=!!accessToken;EventRegister.emit('checkIsLogin',bizLogicSuccess(isLogin));return _context21.abrupt(\"return\",isLogin);case 7:case\"end\":return _context21.stop();}}},null,null,null,Promise);};export var authLaborContext={authFunctions:{bunnyLogin:bunnyLogin,googleLogin:googleLogin,facebookLogin:facebookLogin,firebaseSendOTP:firebaseSendOTP,firebaseConfirmOTP:firebaseConfirmOTP,firebaseEmailLogin:firebaseEmailLogin,firebaseEmailSignUp:firebaseEmailSignUp,firebaseResetPassword:firebaseResetPassword,dummyLogin:dummyLogin,logOut:logOut,bunnySignUp:bunnySignUp,bunnyRefreshAuth:bunnyRefreshAuth,getPersistenceAuth:getPersistenceAuth,authTrigger:authTrigger},authResult:{isLogin:false,accessToken:'',refreshToken:'',user:{},triggerUUID:'',triggerType:undefined,triggerReference:''}};export var AuthLaborContext=React.createContext(authLaborContext);","map":null,"metadata":{},"sourceType":"module"}