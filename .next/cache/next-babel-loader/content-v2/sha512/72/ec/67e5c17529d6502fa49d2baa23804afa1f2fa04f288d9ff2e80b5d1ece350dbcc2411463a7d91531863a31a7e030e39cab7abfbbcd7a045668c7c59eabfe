{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _objectDestructuringEmpty from\"@babel/runtime/helpers/objectDestructuringEmpty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import*as React from'react';import{useEffect,useState}from'react';import{Text,View}from\"../../../components/UI\";import{shortenTFunctionKey}from\"../../../providers/i18n-labor\";import{makeContainerStyles}from\"../../../containers\";import{VictoryAxis,VictoryChart,VictoryLine,VictoryTooltip,VictoryVoronoiContainer}from\"../../../components/Victory/Victory\";import nomicsAPI from\"../../../helpers/nomics-api\";import{makeStyles}from\"./styles\";import{addDays}from\"../../../utils\";import{useDispatch,useSelector}from'react-redux';import axios from'axios';import{collectBizLogicResult,collectSysError,getCurrentPrice}from\"../../../store/actions\";import{bizLogicError,getSharedStyles}from\"../../../helpers\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import{Tab}from\"../../../components\";import{useBunnyKit}from\"../../../hooks/bunny-kit\";var source;function CryptoCurrencyHomeScreen(){var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,wp=_useBunnyKit.wp,t=_useBunnyKit.t,ms=_useBunnyKit.ms;var types=['BTC','ETH'];var dateRanges=['1d','1w','1m','1y'];var st=shortenTFunctionKey(t,'screens.CryptoCurrencyHome');var dispatch=useDispatch();var victory=themeLabor.theme.victory;var _makeContainerStyles=makeContainerStyles(sizeLabor,themeLabor),Screen=_makeContainerStyles.Screen,Box=_makeContainerStyles.Box;var _getSharedStyles=getSharedStyles(sizeLabor,themeLabor),sharedStyles=_getSharedStyles.sharedStyles;_objectDestructuringEmpty(sharedStyles);var styles=makeStyles(sizeLabor,themeLabor);var _useState=useState([{x:new Date('1990-01-01'),y:5}]),_useState2=_slicedToArray(_useState,2),btcData=_useState2[0],setBtcData=_useState2[1];var _useSelector=useSelector(function(rootState){return rootState.demoCryptoCurrencyState;}),currentPrice=_useSelector.currentPrice;var _useState3=useState('BTC'),_useState4=_slicedToArray(_useState3,2),type=_useState4[0],setType=_useState4[1];var _useState5=useState('1d'),_useState6=_slicedToArray(_useState5,2),dateRange=_useState6[0],setDateRange=_useState6[1];var getHistoricalPrices=function getHistoricalPrices(type,dateRange){var start,end,_await$nomicsAPI$get,data,_data$,timestamps,prices,btcDataMapped;return _regeneratorRuntime.async(function getHistoricalPrices$(_context){while(1){switch(_context.prev=_context.next){case 0:start='';end=new Date().toISOString();_context.t0=dateRange;_context.next=_context.t0==='1d'?5:_context.t0==='1w'?7:_context.t0==='1m'?9:_context.t0==='1y'?11:13;break;case 5:start=addDays(new Date(),-1).toISOString();return _context.abrupt(\"break\",15);case 7:start=addDays(new Date(),-7).toISOString();return _context.abrupt(\"break\",15);case 9:start=addDays(new Date(),-30).toISOString();return _context.abrupt(\"break\",15);case 11:start=addDays(new Date(),-365).toISOString();return _context.abrupt(\"break\",15);case 13:start=addDays(new Date(),-1).toISOString();return _context.abrupt(\"break\",15);case 15:source=axios.CancelToken.source();_context.prev=16;_context.next=19;return _regeneratorRuntime.awrap(nomicsAPI.get('v1/currencies/sparkline',{cancelToken:source.token,params:{ids:type,start:start,end:end}}));case 19:_await$nomicsAPI$get=_context.sent;data=_await$nomicsAPI$get.data.data;_data$=data[0],timestamps=_data$.timestamps,prices=_data$.prices;btcDataMapped=timestamps.map(function(item,index){return{x:new Date(item),y:parseFloat(parseFloat(prices[index]).toFixed(2))};});setBtcData(btcDataMapped);_context.next=29;break;case 26:_context.prev=26;_context.t1=_context[\"catch\"](16);dispatch(collectBizLogicResult(bizLogicError(_context.t1.message,false)));case 29:case\"end\":return _context.stop();}}},null,null,[[16,26]],Promise);};useEffect(function(){try{dispatch(getCurrentPrice());}catch(e){dispatch(collectSysError(e));}getHistoricalPrices(type,dateRange).then();return function(){source.cancel(t('sys.canceledRequest'));};},[]);return React.createElement(ScrollView,null,React.createElement(View,{style:[Screen,Box]},React.createElement(Text,null,currentPrice),React.createElement(Tab,{items:types,value:type,onChange:function _callee(item){return _regeneratorRuntime.async(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setType(item);_context2.next=3;return _regeneratorRuntime.awrap(getHistoricalPrices(item,dateRange));case 3:case\"end\":return _context2.stop();}}},null,null,null,Promise);}}),React.createElement(Tab,{items:dateRanges,value:dateRange,onChange:function _callee2(item){return _regeneratorRuntime.async(function _callee2$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setDateRange(item);_context3.next=3;return _regeneratorRuntime.awrap(getHistoricalPrices(type,item));case 3:case\"end\":return _context3.stop();}}},null,null,null,Promise);}}),React.createElement(VictoryChart,{theme:victory,padding:{top:wp(40),left:wp(4),bottom:wp(30),right:wp(20)},domainPadding:{y:wp(15)},containerComponent:React.createElement(VictoryVoronoiContainer,{voronoiDimension:\"x\",labels:function labels(_ref){var datum=_ref.datum;return\"x:\"+datum.x.toLocaleDateString()+\" \\n y: \"+datum.y;},labelComponent:React.createElement(VictoryTooltip,{constrainToVisibleArea:true,cornerRadius:ms.br.s})}),scale:{x:'time'}},React.createElement(VictoryAxis,{crossAxis:true,style:{grid:{stroke:'none'}}}),React.createElement(VictoryAxis,{dependentAxis:true,tickFormat:function tickFormat(){return\"\";},style:{grid:{stroke:'none'}}}),React.createElement(VictoryLine,{interpolation:\"natural\",style:{},data:btcData}))));}export default CryptoCurrencyHomeScreen;","map":null,"metadata":{},"sourceType":"module"}