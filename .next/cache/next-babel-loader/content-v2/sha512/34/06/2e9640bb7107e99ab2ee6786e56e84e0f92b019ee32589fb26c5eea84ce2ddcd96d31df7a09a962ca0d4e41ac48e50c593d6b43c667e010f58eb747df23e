{"ast":null,"code":"\"use strict\";var _interopRequireDefault2=require(\"@babel/runtime/helpers/interopRequireDefault\");var _slicedToArray2=_interopRequireDefault2(require(\"@babel/runtime/helpers/slicedToArray\"));var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");exports.__esModule=true;exports.initScriptLoader=initScriptLoader;exports.default=void 0;var _extends2=_interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));var _objectWithoutPropertiesLoose2=_interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutPropertiesLoose\"));var _react=require(\"react\");var _headManagerContext=require(\"../next-server/lib/head-manager-context\");var _headManager=require(\"./head-manager\");var _requestIdleCallback=require(\"./request-idle-callback\");var ScriptCache=new Map();var LoadCache=new Set();var ignoreProps=['onLoad','dangerouslySetInnerHTML','children','onError','strategy'];var loadScript=function loadScript(props){var src=props.src,id=props.id,_props$onLoad=props.onLoad,onLoad=_props$onLoad===void 0?function(){}:_props$onLoad,dangerouslySetInnerHTML=props.dangerouslySetInnerHTML,_props$children=props.children,children=_props$children===void 0?'':_props$children,onError=props.onError;var cacheKey=id||src;if(ScriptCache.has(src)){if(!LoadCache.has(cacheKey)){LoadCache.add(cacheKey);ScriptCache.get(src).then(onLoad,onError);}return;}var el=document.createElement('script');var loadPromise=new Promise(function(resolve,reject){el.addEventListener('load',function(){resolve();if(onLoad){onLoad.call(this);}});el.addEventListener('error',function(){reject();if(onError){onError();}});});if(src){ScriptCache.set(src,loadPromise);LoadCache.add(cacheKey);}if(dangerouslySetInnerHTML){el.innerHTML=dangerouslySetInnerHTML.__html||'';}else if(children){el.textContent=typeof children==='string'?children:Array.isArray(children)?children.join(''):'';}else if(src){el.src=src;}for(var _i=0,_Object$entries=Object.entries(props);_i<_Object$entries.length;_i++){var _ref=_Object$entries[_i];var _ref2=(0,_slicedToArray2.default)(_ref,2);var k=_ref2[0];var value=_ref2[1];if(value===undefined||ignoreProps.includes(k)){continue;}var attr=_headManager.DOMAttributeNames[k]||k.toLowerCase();el.setAttribute(attr,value);}document.body.appendChild(el);};function handleClientScriptLoad(props){var _props$strategy=props.strategy,strategy=_props$strategy===void 0?'afterInteractive':_props$strategy;if(strategy==='afterInteractive'){loadScript(props);}else if(strategy==='lazyOnload'){window.addEventListener('load',function(){(0,_requestIdleCallback.requestIdleCallback)(function(){return loadScript(props);});});}}function loadLazyScript(props){if(document.readyState==='complete'){(0,_requestIdleCallback.requestIdleCallback)(function(){return loadScript(props);});}else{window.addEventListener('load',function(){(0,_requestIdleCallback.requestIdleCallback)(function(){return loadScript(props);});});}}function initScriptLoader(scriptLoaderItems){scriptLoaderItems.forEach(handleClientScriptLoad);}function Script(props){var _props$src=props.src,src=_props$src===void 0?'':_props$src,_props$onLoad2=props.onLoad,onLoad=_props$onLoad2===void 0?function(){}:_props$onLoad2,_props$strategy2=props.strategy,strategy=_props$strategy2===void 0?'afterInteractive':_props$strategy2,onError=props.onError,restProps=(0,_objectWithoutPropertiesLoose2.default)(props,[\"src\",\"onLoad\",\"dangerouslySetInnerHTML\",\"strategy\",\"onError\"]);var _ref3=(0,_react.useContext)(_headManagerContext.HeadManagerContext),updateScripts=_ref3.updateScripts,scripts=_ref3.scripts;(0,_react.useEffect)(function(){if(strategy==='afterInteractive'){loadScript(props);}else if(strategy==='lazyOnload'){loadLazyScript(props);}},[props,strategy]);if(!process.env.__NEXT_SCRIPT_LOADER){return null;}if(strategy==='beforeInteractive'){if(updateScripts){scripts.beforeInteractive=(scripts.beforeInteractive||[]).concat([(0,_extends2.default)({src:src,onLoad:onLoad,onError:onError},restProps)]);updateScripts(scripts);}}return null;}var _default=Script;exports.default=_default;","map":null,"metadata":{},"sourceType":"script"}