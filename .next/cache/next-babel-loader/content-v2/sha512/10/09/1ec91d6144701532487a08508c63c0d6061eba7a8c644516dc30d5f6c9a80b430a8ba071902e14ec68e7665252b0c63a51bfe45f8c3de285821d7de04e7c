{"ast":null,"code":"import _extends from\"@babel/runtime/helpers/extends\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import _regeneratorRuntime from\"@babel/runtime/regenerator\";import React,{useEffect,useState}from'react';import{IcoMoon,Text,TextButton}from\"../UI\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import Image from\"react-native-web/dist/exports/Image\";import Platform from\"react-native-web/dist/exports/Platform\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import Share from\"react-native-web/dist/exports/Share\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import View from\"react-native-web/dist/exports/View\";import{makeStyles}from\"./styles\";import*as ImagePicker from'expo-image-picker';import{Permissions,removeFileFromFirebaseByURL,uploadFileToFirebase}from\"../../helpers\";import Modal from'react-native-modal';import{Divider}from\"../Divider\";import{CopyableText}from\"../CopyableText\";import{useBunnyKit}from\"../../hooks/bunny-kit\";export function ImageUploader(props){var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,wp=_useBunnyKit.wp;var colors=themeLabor.theme.colors;var _props$width=props.width,width=_props$width===void 0?wp(200):_props$width,_props$height=props.height,height=_props$height===void 0?wp(200):_props$height,source=props.source,path=props.path,_props$isFullFill=props.isFullFill,isFullFill=_props$isFullFill===void 0?false:_props$isFullFill,_props$isShowUri=props.isShowUri,isShowUri=_props$isShowUri===void 0?false:_props$isShowUri,_props$isDeleteFromSe=props.isDeleteFromServerWhenRemove,isDeleteFromServerWhenRemove=_props$isDeleteFromSe===void 0?true:_props$isDeleteFromSe,_props$isDeleteFromSe2=props.isDeleteFromServerWhenUpload,isDeleteFromServerWhenUpload=_props$isDeleteFromSe2===void 0?true:_props$isDeleteFromSe2,style=props.style,placeholderContainerStyle=props.placeholderContainerStyle,imageContainerStyle=props.imageContainerStyle,loadingOverlayStyle=props.loadingOverlayStyle,modalPanelContainerStyle=props.modalPanelContainerStyle,modalPanelStyle=props.modalPanelStyle,modalPanel2Style=props.modalPanel2Style,imageStyle=props.imageStyle,buttonStyle=props.buttonStyle,buttonTextStyle=props.buttonTextStyle,_props$placeholderIco=props.placeholderIconName,placeholderIconName=_props$placeholderIco===void 0?'plus':_props$placeholderIco,modalProps=props.modalProps,_props$imagePickerOpt=props.imagePickerOptions,imagePickerOptions=_props$imagePickerOpt===void 0?{mediaTypes:ImagePicker.MediaTypeOptions.All,allowsEditing:true,aspect:[4,3],quality:0.2}:_props$imagePickerOpt,_props$cameraPickerOp=props.cameraPickerOptions,cameraPickerOptions=_props$cameraPickerOp===void 0?{mediaTypes:ImagePicker.MediaTypeOptions.All,allowsEditing:true,aspect:[4,3],quality:0.2}:_props$cameraPickerOp,_props$loadingIndicat=props.loadingIndicatorProps,loadingIndicatorProps=_props$loadingIndicat===void 0?{color:colors.text,animating:true,size:'large'}:_props$loadingIndicat,renderPreview=props.renderPreview,onError=props.onError,onSelected=props.onSelected,onUploaded=props.onUploaded,onValueChanged=props.onValueChanged,onRemovePhoto=props.onRemovePhoto;var sizeStyle={width:isFullFill?'100%':width,height:isFullFill?'100%':height};var styles=makeStyles(sizeLabor,themeLabor);var _useState=useState(source||{uri:''}),_useState2=_slicedToArray(_useState,2),image=_useState2[0],setImage=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isModalVisible=_useState4[0],setModalVisible=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isUploading=_useState6[0],setIsUploading=_useState6[1];useEffect(function(){setImage(source||{uri:''});},[source]);var _takePhoto=function _takePhoto(){var isAllowed,pickerResult;return _regeneratorRuntime.async(function _takePhoto$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(Permissions.camera.get());case 2:isAllowed=_context.sent;if(isAllowed){_context.next=5;break;}return _context.abrupt(\"return\");case 5:_context.next=7;return _regeneratorRuntime.awrap(ImagePicker.launchCameraAsync(cameraPickerOptions));case 7:pickerResult=_context.sent;_context.next=10;return _regeneratorRuntime.awrap(_handleImagePicked(pickerResult));case 10:case\"end\":return _context.stop();}}},null,null,null,Promise);};var _pickImage=function _pickImage(){var isAllowed,pickerResult,uri,mimeType,matched,_type;return _regeneratorRuntime.async(function _pickImage$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(Permissions.mediaLibrary.get());case 2:isAllowed=_context2.sent;if(isAllowed){_context2.next=5;break;}return _context2.abrupt(\"return\");case 5:_context2.next=7;return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync(imagePickerOptions));case 7:pickerResult=_context2.sent;if(pickerResult.cancelled){_context2.next=18;break;}_context2.t0=Platform.OS;_context2.next=_context2.t0==='web'?12:17;break;case 12:uri=pickerResult.uri;mimeType='';if(uri){matched=uri.match(/[^:]\\w+\\/[\\w-+\\d.]+(?=;|,)/);if(matched){mimeType=matched[0];}}if(mimeType){_type=mimeType.split('/')[0];pickerResult.type=_type;}return _context2.abrupt(\"break\",18);case 17:return _context2.abrupt(\"break\",18);case 18:_context2.next=20;return _regeneratorRuntime.awrap(_handleImagePicked(pickerResult));case 20:case\"end\":return _context2.stop();}}},null,null,null,Promise);};var _errorHandle=function _errorHandle(e){onError&&onError(e);};var _imageError=function _imageError(e){e.nativeEvent.error;onError&&onError(e.nativeEvent.error);};var _handleImagePicked=function _handleImagePicked(pickerResult){var uploadUrl;return _regeneratorRuntime.async(function _handleImagePicked$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:onSelected&&onSelected(pickerResult);setIsUploading(true);setModalVisible(false);_context3.prev=3;if(pickerResult.cancelled){_context3.next=14;break;}if(!(image.uri&&isDeleteFromServerWhenUpload)){_context3.next=8;break;}_context3.next=8;return _regeneratorRuntime.awrap(removeFileFromFirebaseByURL(image.uri));case 8:_context3.next=10;return _regeneratorRuntime.awrap(uploadFileToFirebase(pickerResult.uri,path));case 10:uploadUrl=_context3.sent;onUploaded&&onUploaded({uri:uploadUrl},pickerResult.type);setImage({uri:uploadUrl});onValueChanged&&onValueChanged({uri:uploadUrl});case 14:_context3.next=19;break;case 16:_context3.prev=16;_context3.t0=_context3[\"catch\"](3);_errorHandle(_context3.t0);case 19:_context3.prev=19;setIsUploading(false);return _context3.finish(19);case 22:case\"end\":return _context3.stop();}}},null,null,[[3,16,19,22]],Promise);};var _toggleModal=function _toggleModal(){setModalVisible(!isModalVisible);};var _removePhoto=function _removePhoto(){var removeResult,needRemovePhoto;return _regeneratorRuntime.async(function _removePhoto$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!image.uri){_context4.next=11;break;}if(!isDeleteFromServerWhenRemove){_context4.next=5;break;}_context4.next=4;return _regeneratorRuntime.awrap(removeFileFromFirebaseByURL(image.uri));case 4:removeResult=_context4.sent;case 5:needRemovePhoto=_objectSpread({},image);setImage({uri:''});setModalVisible(false);onRemovePhoto&&onRemovePhoto(needRemovePhoto);_context4.next=12;break;case 11:onRemovePhoto&&onRemovePhoto();case 12:case\"end\":return _context4.stop();}}},null,null,null,Promise);};var _share=function _share(){return _regeneratorRuntime.async(function _share$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _regeneratorRuntime.awrap(Share.share({message:image.uri,title:'Check out this photo',url:image.uri||''}));case 2:case\"end\":return _context5.stop();}}},null,null,null,Promise);};var _maybeRenderUploadingOverlay=function _maybeRenderUploadingOverlay(){if(isUploading){return React.createElement(View,{style:[styles.loadingOverlay,loadingOverlayStyle]},React.createElement(ActivityIndicator,loadingIndicatorProps));}};var _renderImage=function _renderImage(){return React.createElement(View,{style:[styles.imageContainer,sizeStyle,imageContainerStyle]},React.createElement(Image,{source:image,style:[styles.image,sizeStyle,imageStyle],onError:_imageError}),isShowUri?React.createElement(CopyableText,{numberOfLines:1},image.uri):null);};var _renderPlaceholder=function _renderPlaceholder(){return React.createElement(View,{style:[styles.placeholderContainer,sizeStyle,placeholderContainerStyle]},React.createElement(IcoMoon,{name:placeholderIconName,color:colors.text3}));};var styleJudge=renderPreview?undefined:[styles.container,sizeStyle,style];return React.createElement(SafeAreaView,{style:styleJudge},renderPreview?renderPreview({imageSource:image,toggleModal:_toggleModal}):React.createElement(TouchableOpacity,{style:[sizeStyle],onPress:_toggleModal},image.uri?_renderImage():_renderPlaceholder(),_maybeRenderUploadingOverlay()),React.createElement(Modal,_extends({isVisible:isModalVisible,onSwipeComplete:function onSwipeComplete(){return setModalVisible(false);},swipeDirection:\"down\",style:styles.modal,onBackdropPress:function onBackdropPress(){return setModalVisible(false);}},modalProps),React.createElement(View,{style:[styles.modalPanelContainer,modalPanelContainerStyle]},React.createElement(View,{style:[styles.modalPanel,modalPanelStyle]},React.createElement(TextButton,{style:[styles.button,buttonStyle],onPress:_pickImage},React.createElement(Text,{style:[styles.buttonText,buttonTextStyle]},\"Open Gallery\")),React.createElement(Divider,null),React.createElement(TextButton,{style:[styles.button,buttonStyle],onPress:_takePhoto},React.createElement(Text,{style:[styles.buttonText,buttonTextStyle]},\"Take A Photo\")),image.uri?React.createElement(React.Fragment,null,React.createElement(Divider,null),React.createElement(TextButton,{onPress:_removePhoto,style:[styles.button,buttonStyle]},React.createElement(Text,{style:[styles.buttonText,buttonTextStyle]},\"Remove Photo\"))):null),React.createElement(View,{style:[styles.modalPanel2,modalPanel2Style]},React.createElement(TextButton,{style:[styles.button,buttonStyle],onPress:_toggleModal},React.createElement(Text,{style:[styles.buttonText,buttonTextStyle]},\"Cancel\"))))));}","map":null,"metadata":{},"sourceType":"module"}