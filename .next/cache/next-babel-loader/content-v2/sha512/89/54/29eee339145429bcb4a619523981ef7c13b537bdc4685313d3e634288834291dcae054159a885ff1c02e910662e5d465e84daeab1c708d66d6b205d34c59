{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import View from\"react-native-web/dist/exports/View\";import*as React from'react';import{InputCard,Row}from\"../../containers\";import{InButtonText,LinearGradientButton,Text,TextInputIcon}from\"../UI\";import{LinearGradientIcon}from\"../LinearGradientIcon\";import*as FirebaseRecaptcha from'expo-firebase-recaptcha';import{FIREBASE_CONFIG}from\"../../firebase\";import{shortenTFunctionKey}from\"../../providers/i18n-labor\";import{makeStyles}from\"./styles\";import{useAuthLabor}from\"../../providers/auth-labor\";import{useDispatch}from'react-redux';import{collectBizLogicResult}from\"../../store/actions\";import{navToReference}from\"../../helpers\";import{useBunnyKit}from\"../../hooks/bunny-kit\";export var FirebasePhoneLogin=function FirebasePhoneLogin(_ref){var route=_ref.route,navigation=_ref.navigation;var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,t=_useBunnyKit.t,wp=_useBunnyKit.wp;var st=shortenTFunctionKey(t,'screens.Auth');var styles=makeStyles(sizeLabor,themeLabor);var _useAuthLabor=useAuthLabor(),authFunctions=_useAuthLabor.authFunctions;var dispatch=useDispatch();var recaptchaVerifier=React.useRef(null);var verificationCodeTextInput=React.useRef(null);var _React$useState=React.useState(''),_React$useState2=_slicedToArray(_React$useState,2),phoneNumber=_React$useState2[0],setPhoneNumber=_React$useState2[1];var _React$useState3=React.useState(''),_React$useState4=_slicedToArray(_React$useState3,2),verificationId=_React$useState4[0],setVerificationId=_React$useState4[1];var _React$useState5=React.useState(''),_React$useState6=_slicedToArray(_React$useState5,2),verifyError=_React$useState6[0],setVerifyError=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),verifyInProgress=_React$useState8[0],setVerifyInProgress=_React$useState8[1];var _React$useState9=React.useState(''),_React$useState10=_slicedToArray(_React$useState9,2),verificationCode=_React$useState10[0],setVerificationCode=_React$useState10[1];var _React$useState11=React.useState(''),_React$useState12=_slicedToArray(_React$useState11,2),confirmError=_React$useState12[0],setConfirmError=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),confirmInProgress=_React$useState14[0],setConfirmInProgress=_React$useState14[1];var isConfigValid=!!FIREBASE_CONFIG.apiKey;var firebaseSendOTP=function firebaseSendOTP(){var result,_verificationCodeText,_verificationId;return _regeneratorRuntime.async(function firebaseSendOTP$(_context){while(1){switch(_context.prev=_context.next){case 0:setVerifyError('');setVerifyInProgress(true);setVerificationId('');_context.prev=3;_context.next=6;return _regeneratorRuntime.awrap(authFunctions.firebaseSendOTP(phoneNumber,recaptchaVerifier.current));case 6:result=_context.sent;if(result.success){_verificationId=result.data.verificationId;setVerifyInProgress(false);setVerificationId(_verificationId);(_verificationCodeText=verificationCodeTextInput.current)==null?void 0:_verificationCodeText.focus();}else{dispatch(collectBizLogicResult(result));}_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](3);setVerifyError(_context.t0.message);setVerifyInProgress(false);case 14:case\"end\":return _context.stop();}}},null,null,[[3,10]],Promise);};var firebaseConfirmOTP=function firebaseConfirmOTP(){var result,_verificationCodeText2;return _regeneratorRuntime.async(function firebaseConfirmOTP$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setConfirmError('');setConfirmInProgress(true);_context2.prev=2;_context2.next=5;return _regeneratorRuntime.awrap(authFunctions.firebaseConfirmOTP(verificationId,verificationCode,true));case 5:result=_context2.sent;if(result.success){setConfirmInProgress(false);setVerificationId('');setVerificationCode('');(_verificationCodeText2=verificationCodeTextInput.current)==null?void 0:_verificationCodeText2.clear();navToReference(route,navigation);}else{dispatch(collectBizLogicResult(result));}_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);setConfirmError(_context2.t0.message);setConfirmInProgress(false);case 13:case\"end\":return _context2.stop();}}},null,null,[[2,9]],Promise);};return React.createElement(View,null,React.createElement(View,{style:styles.contentPhone},React.createElement(InputCard,{title:st(\"enterPhoneNumber\")},React.createElement(TextInputIcon,{autoCompleteType:\"tel\",keyboardType:\"phone-pad\",textContentType:\"telephoneNumber\",placeholder:t(\"placeholders.phone\"),editable:!verificationId,onChangeText:function onChangeText(phoneNumber){return setPhoneNumber(phoneNumber);},renderIcon:function renderIcon(){return React.createElement(LinearGradientIcon,{name:\"phone\",size:wp(20)});}})),React.createElement(Row,{paddingVertical:\"xxl\"},React.createElement(LinearGradientButton,{disabled:!phoneNumber,onPress:firebaseSendOTP},React.createElement(InButtonText,null,(verificationId?st('resend'):st('send'))+\" \"+st('verificationCode')))),React.createElement(Row,{style:styles.recaptchaVerifierModal},React.createElement(FirebaseRecaptcha.FirebaseRecaptchaVerifierModal,{ref:recaptchaVerifier,firebaseConfig:FIREBASE_CONFIG})),verifyError?React.createElement(Text,{style:styles.error},\"Error: \"+verifyError):null,verifyInProgress&&React.createElement(ActivityIndicator,{style:styles.loader}),verificationId?React.createElement(Text,{style:styles.success},st(\"otpSentSuccess\")):null,React.createElement(InputCard,{title:st(\"enterVerificationCode\")},React.createElement(TextInputIcon,{ref:verificationCodeTextInput,editable:!!verificationId,placeholder:t(\"placeholders.otp\"),onChangeText:function onChangeText(verificationCode){return setVerificationCode(verificationCode);},renderIcon:function renderIcon(){return React.createElement(LinearGradientIcon,{name:\"sort-numerically-outline\",size:wp(20)});}})),React.createElement(Row,{paddingVertical:\"xxl\"},React.createElement(LinearGradientButton,{disabled:!verificationCode,onPress:firebaseConfirmOTP},React.createElement(InButtonText,null,st('firebaseConfirmOTP')))),confirmError?React.createElement(Text,{style:styles.error},\"Error: \"+confirmError):null,confirmInProgress?React.createElement(ActivityIndicator,{style:styles.loader}):null),!isConfigValid&&React.createElement(View,{style:styles.overlay,pointerEvents:\"none\"},React.createElement(Text,{style:styles.overlayText},\"To get started, set a valid FIREBASE_CONFIG in App.tsx.\")));};","map":null,"metadata":{},"sourceType":"module"}