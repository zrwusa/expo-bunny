{"ast":null,"code":"\"use strict\";var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");var _defineProperty2=_interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));var _slicedToArray2=_interopRequireDefault(require(\"@babel/runtime/helpers/slicedToArray\"));var _extends2=_interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createForOfIteratorHelperLoose(o,allowArrayLike){var it;if(typeof Symbol===\"undefined\"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length===\"number\"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");}it=o[Symbol.iterator]();return it.next.bind(it);}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o===\"string\")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n===\"Object\"&&o.constructor)n=o.constructor.name;if(n===\"Map\"||n===\"Set\")return Array.from(o);if(n===\"Arguments\"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}exports.__esModule=true;exports.matchHas=matchHas;exports.compileNonPath=compileNonPath;exports.default=prepareDestination;exports.getSafeParamName=void 0;var _querystring=require(\"./querystring\");var _parseRelativeUrl=require(\"./parse-relative-url\");var pathToRegexp=_interopRequireWildcard(require(\"next/dist/compiled/path-to-regexp\"));function _getRequireWildcardCache(){if(typeof WeakMap!==\"function\")return null;var cache=new WeakMap();_getRequireWildcardCache=function _getRequireWildcardCache(){return cache;};return cache;}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!==\"object\"&&typeof obj!==\"function\"){return{default:obj};}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}var getSafeParamName=function getSafeParamName(paramName){var newParamName='';for(var i=0;i<paramName.length;i++){var charCode=paramName.charCodeAt(i);if(charCode>64&&charCode<91||charCode>96&&charCode<123){newParamName+=paramName[i];}}return newParamName;};exports.getSafeParamName=getSafeParamName;function matchHas(req,has,query){var params={};var allMatch=has.every(function(hasItem){var value;var key=hasItem.key;switch(hasItem.type){case'header':{key=key.toLowerCase();value=req.headers[key];break;}case'cookie':{value=req.cookies[hasItem.key];break;}case'query':{value=query[key];break;}case'host':{var _ref=(req==null?void 0:req.headers)||{},host=_ref.host;var hostname=host==null?void 0:host.split(':')[0].toLowerCase();value=hostname;break;}default:{break;}}if(!hasItem.value&&value){params[getSafeParamName(key)]=value;return true;}else if(value){var matcher=new RegExp(\"^\"+hasItem.value+\"$\");var matches=value.match(matcher);if(matches){if(matches.groups){Object.keys(matches.groups).forEach(function(groupKey){params[groupKey]=matches.groups[groupKey];});}else if(hasItem.type==='host'&&matches[0]){params.host=matches[0];}return true;}}return false;});if(allMatch){return params;}return false;}function compileNonPath(value,params){if(!value.includes(':')){return value;}for(var _i=0,_Object$keys=Object.keys(params);_i<_Object$keys.length;_i++){var key=_Object$keys[_i];if(value.includes(\":\"+key)){value=value.replace(new RegExp(\":\"+key+\"\\\\*\",'g'),\":\"+key+\"--ESCAPED_PARAM_ASTERISKS\").replace(new RegExp(\":\"+key+\"\\\\?\",'g'),\":\"+key+\"--ESCAPED_PARAM_QUESTION\").replace(new RegExp(\":\"+key+\"\\\\+\",'g'),\":\"+key+\"--ESCAPED_PARAM_PLUS\").replace(new RegExp(\":\"+key+\"(?!\\\\w)\",'g'),\"--ESCAPED_PARAM_COLON\"+key);}}value=value.replace(/(:|\\*|\\?|\\+|\\(|\\)|\\{|\\})/g,'\\\\$1').replace(/--ESCAPED_PARAM_PLUS/g,'+').replace(/--ESCAPED_PARAM_COLON/g,':').replace(/--ESCAPED_PARAM_QUESTION/g,'?').replace(/--ESCAPED_PARAM_ASTERISKS/g,'*');return pathToRegexp.compile(\"/\"+value,{validate:false})(params).substr(1);}function prepareDestination(destination,params,query,appendParamsToQuery){var parsedDestination={};query=(0,_extends2.default)({},query);var hadLocale=query.__nextLocale;delete query.__nextLocale;delete query.__nextDefaultLocale;if(destination.startsWith('/')){parsedDestination=(0,_parseRelativeUrl.parseRelativeUrl)(destination);}else{var _URL=new URL(destination),pathname=_URL.pathname,searchParams=_URL.searchParams,hash=_URL.hash,hostname=_URL.hostname,port=_URL.port,protocol=_URL.protocol,search=_URL.search,href=_URL.href;parsedDestination={pathname:pathname,query:(0,_querystring.searchParamsToUrlQuery)(searchParams),hash:hash,protocol:protocol,hostname:hostname,port:port,search:search,href:href};}var destQuery=parsedDestination.query;var destPath=\"\"+parsedDestination.pathname+(parsedDestination.hash||'');var destPathParamKeys=[];pathToRegexp.pathToRegexp(destPath,destPathParamKeys);var destPathParams=destPathParamKeys.map(function(key){return key.name;});var destinationCompiler=pathToRegexp.compile(destPath,{validate:false});var newUrl;for(var _i2=0,_Object$entries=Object.entries(destQuery);_i2<_Object$entries.length;_i2++){var _ref2=_Object$entries[_i2];var _ref3=(0,_slicedToArray2.default)(_ref2,2);var key=_ref3[0];var strOrArray=_ref3[1];var value=Array.isArray(strOrArray)?strOrArray[0]:strOrArray;if(value){value=compileNonPath(value,params);}destQuery[key]=value;}var paramKeys=Object.keys(params);if(hadLocale){paramKeys=paramKeys.filter(function(name){return name!=='nextInternalLocale';});}if(appendParamsToQuery&&!paramKeys.some(function(key){return destPathParams.includes(key);})){for(var _iterator=_createForOfIteratorHelperLoose(paramKeys),_step;!(_step=_iterator()).done;){var _key=_step.value;if(!(_key in destQuery)){destQuery[_key]=params[_key];}}}try{newUrl=destinationCompiler(params);var _newUrl$split=newUrl.split('#'),_newUrl$split2=(0,_slicedToArray2.default)(_newUrl$split,2),_pathname=_newUrl$split2[0],_hash=_newUrl$split2[1];parsedDestination.pathname=_pathname;parsedDestination.hash=\"\"+(_hash?'#':'')+(_hash||'');delete parsedDestination.search;}catch(err){if(err.message.match(/Expected .*? to not repeat, but got an array/)){throw new Error(\"To use a multi-match in the destination you must add `*` at the end of the param name to signify it should repeat. https://nextjs.org/docs/messages/invalid-multi-match\");}throw err;}parsedDestination.query=_objectSpread(_objectSpread({},query),parsedDestination.query);return{newUrl:newUrl,parsedDestination:parsedDestination};}","map":null,"metadata":{},"sourceType":"script"}