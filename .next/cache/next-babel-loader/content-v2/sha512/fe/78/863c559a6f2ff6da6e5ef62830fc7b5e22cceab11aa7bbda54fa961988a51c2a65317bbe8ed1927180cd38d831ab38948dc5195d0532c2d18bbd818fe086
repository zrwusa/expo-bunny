{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";var _this=this,_jsxFileName=\"/Users/revone/projects/expo-react-bunny/src/providers/auth-labor/AuthLaborProvider.tsx\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import*as React from'react';import{useCallback,useEffect,useMemo,useState}from'react';import{AuthLaborContext,authLaborContext}from\"./AuthLaborContext\";import{Preparing}from\"../../components/Preparing\";import{useTranslation}from'react-i18next';import{shortenTFunctionKey}from\"../i18n-labor\";import{EventRegister}from'react-native-event-listeners';import{uuidV4}from\"../../utils\";export var AuthLaborProvider=function AuthLaborProvider(props){var children=props.children;var _useTranslation=useTranslation(),t=_useTranslation.t;var st=shortenTFunctionKey(t,'sys');var authFunctions=authLaborContext.authFunctions,authResult=authLaborContext.authResult;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isReady=_useState2[0],setIsReady=_useState2[1];var _useState3=useState(authResult),_useState4=_slicedToArray(_useState3,2),authResultState=_useState4[0],setAuthResultState=_useState4[1];var memoizedAuthResultState=useMemo(function(){return authResultState;},[JSON.stringify(authResultState)]);var handleLogin=useCallback(function(bizLogicResult){var success=bizLogicResult.success,data=bizLogicResult.data;if(success){var accessToken=data.accessToken,refreshToken=data.refreshToken,user=data.user;setAuthResultState({accessToken:accessToken,refreshToken:refreshToken,user:user,isLogin:true});}else{setAuthResultState({accessToken:'',refreshToken:'',user:undefined,isLogin:false});}},[]);var handleCheckIsLogin=useCallback(function(_ref){var data=_ref.data;setAuthResultState(function(preState){return _objectSpread(_objectSpread({},preState),{},{isLogin:data});});},[]);var handleAuthTrigger=useCallback(function(triggerType){setAuthResultState(function(preState){return _objectSpread(_objectSpread({},preState),{},{triggerType:triggerType,triggerUUID:uuidV4()});});},[]);var handleLogOut=useCallback(function(_ref2){var success=_ref2.success,message=_ref2.message;if(success){setAuthResultState({accessToken:'',refreshToken:'',user:undefined,isLogin:false});}else{}},[]);var handleBunnyRefreshAuth=useCallback(function(_ref3){var success=_ref3.success,data=_ref3.data,message=_ref3.message;if(success){var accessToken=data.accessToken;setAuthResultState(function(preState){return _objectSpread(_objectSpread({},preState),{},{accessToken:accessToken});});}else{setAuthResultState(function(preState){return _objectSpread(_objectSpread({},preState),{},{accessToken:''});});}},[]);useEffect(function(){var bootstrapAsync=function bootstrapAsync(){var _await$authFunctions$,accessToken,refreshToken,user;return _regeneratorRuntime.async(function bootstrapAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(authFunctions.getPersistenceAuth());case 2:_await$authFunctions$=_context.sent;accessToken=_await$authFunctions$.accessToken;refreshToken=_await$authFunctions$.refreshToken;user=_await$authFunctions$.user;if(accessToken){setAuthResultState({accessToken:accessToken,refreshToken:refreshToken,user:user,isLogin:true});}else{setAuthResultState({accessToken:'',refreshToken:'',user:undefined,isLogin:false});}case 7:case\"end\":return _context.stop();}}},null,null,null,Promise);};bootstrapAsync().then(function(){setIsReady(true);});},[]);useEffect(function(){var loginID=EventRegister.on('login',handleLogin);var LogOutID=EventRegister.on('LogOut',handleLogOut);var bunnyRefreshAuthID=EventRegister.on('bunnyRefreshAuth',handleBunnyRefreshAuth);var authTriggerID=EventRegister.on('authTrigger',handleAuthTrigger);var checkAuthID=EventRegister.on('checkIsLogin',handleCheckIsLogin);return function(){if(typeof loginID==='string'){EventRegister.rm(loginID);}if(typeof LogOutID==='string'){EventRegister.rm(LogOutID);}if(typeof bunnyRefreshAuthID==='string'){EventRegister.rm(bunnyRefreshAuthID);}if(typeof authTriggerID==='string'){EventRegister.rm(authTriggerID);}if(typeof checkAuthID==='string'){EventRegister.rm(checkAuthID);}};},[]);return isReady?React.createElement(AuthLaborContext.Provider,{value:{authResult:memoizedAuthResultState,authFunctions:authFunctions},__self:_this,__source:{fileName:_jsxFileName,lineNumber:134,columnNumber:15}},children):React.createElement(Preparing,{text:st(\"AuthLaborProviderLoading\"),__self:_this,__source:{fileName:_jsxFileName,lineNumber:141,columnNumber:15}});};","map":{"version":3,"sources":["/Users/revone/projects/expo-react-bunny/src/providers/auth-labor/AuthLaborProvider.tsx"],"names":["AuthLaborProvider","children","props","t","useTranslation","st","shortenTFunctionKey","authFunctions","authResult","authLaborContext","isReady","setIsReady","useState","authResultState","setAuthResultState","memoizedAuthResultState","useMemo","JSON","handleLogin","useCallback","success","data","bizLogicResult","accessToken","refreshToken","user","isLogin","handleCheckIsLogin","handleAuthTrigger","triggerType","triggerUUID","uuidV4","handleLogOut","message","handleBunnyRefreshAuth","useEffect","bootstrapAsync","loginID","EventRegister","LogOutID","bunnyRefreshAuthID","authTriggerID","checkAuthID"],"mappings":"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","sourcesContent":["// todo description this provider\nimport * as React from 'react';\nimport {useCallback, useEffect, useMemo, useState} from 'react';\nimport {AuthLaborProviderProps, AuthResult, BizLogicResult} from '../../types';\nimport {AuthLaborContext, authLaborContext} from './AuthLaborContext';\nimport {Preparing} from '../../components/Preparing';\nimport {useTranslation} from 'react-i18next';\nimport {shortenTFunctionKey} from '../i18n-labor';\nimport {EventRegister} from 'react-native-event-listeners';\nimport {uuidV4} from '../../utils';\n\nexport const AuthLaborProvider = (props: AuthLaborProviderProps): JSX.Element => {\n    const {children} = props;\n    const {t} = useTranslation();\n    const st = shortenTFunctionKey(t, 'sys');\n    const {authFunctions, authResult} = authLaborContext;\n    const [isReady, setIsReady] = useState(false);\n    const [authResultState, setAuthResultState] = useState<AuthResult>(authResult);\n\n    const memoizedAuthResultState = useMemo(() => {\n        return authResultState;\n    }, [JSON.stringify(authResultState)]);\n\n    const handleLogin = useCallback((bizLogicResult: BizLogicResult) => {\n            const {success, data} = bizLogicResult;\n            if (success) {\n                const {accessToken, refreshToken, user} = data;\n                setAuthResultState({\n                    accessToken,\n                    refreshToken,\n                    user,\n                    isLogin: true,\n                });\n            } else {\n                setAuthResultState({\n                    accessToken: '',\n                    refreshToken: '',\n                    user: undefined,\n                    isLogin: false,\n                });\n            }\n        },\n        []);\n\n    const handleCheckIsLogin = useCallback(({data}: BizLogicResult) => {\n        setAuthResultState((preState) => ({...preState, isLogin: data}));\n    }, []);\n\n    const handleAuthTrigger = useCallback((triggerType) => {\n        setAuthResultState((preState) => ({...preState, triggerType, triggerUUID: uuidV4()}));\n    }, []);\n\n    const handleLogOut = useCallback(({success, message}: BizLogicResult) => {\n        if (success) {\n            setAuthResultState({\n                accessToken: '',\n                refreshToken: '',\n                user: undefined,\n                isLogin: false,\n            });\n        } else {\n\n        }\n\n    }, []);\n\n    const handleBunnyRefreshAuth = useCallback(({success, data, message}: BizLogicResult) => {\n        if (success) {\n            const {accessToken} = data;\n            setAuthResultState((preState) => ({...preState, accessToken}));\n        } else {\n            setAuthResultState((preState) => ({...preState, accessToken: ''}));\n        }\n    }, []);\n\n    useEffect(() => {\n        const bootstrapAsync = async () => {\n            const {accessToken, refreshToken, user} = await authFunctions.getPersistenceAuth();\n            if (accessToken) {\n                setAuthResultState({\n                    accessToken,\n                    refreshToken,\n                    user,\n                    isLogin: true,\n                });\n            } else {\n                setAuthResultState({\n                    accessToken: '',\n                    refreshToken: '',\n                    user: undefined,\n                    isLogin: false,\n                });\n            }\n        };\n        bootstrapAsync()\n            .then(() => {\n                setIsReady(true);\n            });\n    }, []);\n\n\n    useEffect(() => {\n        const loginID = EventRegister.on('login', handleLogin);\n\n        const LogOutID = EventRegister.on('LogOut', handleLogOut);\n\n        const bunnyRefreshAuthID = EventRegister.on('bunnyRefreshAuth', handleBunnyRefreshAuth);\n\n        const authTriggerID = EventRegister.on('authTrigger', handleAuthTrigger);\n\n        const checkAuthID = EventRegister.on('checkIsLogin', handleCheckIsLogin);\n\n        return () => {\n            if (typeof loginID === 'string') {\n                EventRegister.rm(loginID);\n            }\n            if (typeof LogOutID === 'string') {\n                EventRegister.rm(LogOutID);\n            }\n            if (typeof bunnyRefreshAuthID === 'string') {\n                EventRegister.rm(bunnyRefreshAuthID);\n            }\n            if (typeof authTriggerID === 'string') {\n                EventRegister.rm(authTriggerID);\n            }\n            if (typeof checkAuthID === 'string') {\n                EventRegister.rm(checkAuthID);\n            }\n        };\n    }, []);\n\n    return (\n        isReady\n            ? <AuthLaborContext.Provider\n                value={{\n                    authResult: memoizedAuthResultState,\n                    authFunctions\n                }}>\n                {children}\n            </AuthLaborContext.Provider>\n            : <Preparing text={st(`AuthLaborProviderLoading`)}/>\n    );\n};\n"]},"metadata":{},"sourceType":"module"}