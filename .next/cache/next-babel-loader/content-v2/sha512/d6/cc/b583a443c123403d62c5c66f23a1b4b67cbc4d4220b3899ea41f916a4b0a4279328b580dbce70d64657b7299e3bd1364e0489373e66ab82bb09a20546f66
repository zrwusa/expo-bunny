{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{SyntheticPlatformEmitter}from'@unimodules/core';import{PermissionStatus}from'unimodules-permissions-interface';import{RECORDING_OPTIONS_PRESET_HIGH_QUALITY}from\"./Audio/Recording\";function getPermissionsAsync(){var resolveWithStatus;return _regeneratorRuntime.async(function getPermissionsAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:resolveWithStatus=function resolveWithStatus(status){return{status:status,granted:status===PermissionStatus.GRANTED,canAskAgain:true,expires:0};};_context.prev=1;_context.next=4;return _regeneratorRuntime.awrap(navigator.mediaDevices.getUserMedia({audio:true}));case 4:return _context.abrupt(\"return\",resolveWithStatus(PermissionStatus.GRANTED));case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);return _context.abrupt(\"return\",resolveWithStatus(PermissionStatus.DENIED));case 10:case\"end\":return _context.stop();}}},null,null,[[1,7]],Promise);}function getStatusFromMedia(media){if(!media){return{isLoaded:false,error:undefined};}var isPlaying=media.currentTime>0&&!media.paused&&!media.ended&&media.readyState>2;var status={isLoaded:true,uri:media.src,progressUpdateIntervalMillis:100,durationMillis:media.duration*1000,positionMillis:media.currentTime*1000,shouldPlay:media.autoplay,isPlaying:isPlaying,isBuffering:false,rate:media.playbackRate,shouldCorrectPitch:false,volume:media.volume,isMuted:media.muted,isLooping:media.loop,didJustFinish:media.ended};return status;}function setStatusForMedia(media,status){if(status.positionMillis!==undefined){media.currentTime=status.positionMillis/1000;}if(status.shouldPlay!==undefined){if(status.shouldPlay){media.play();}else{media.pause();}}if(status.rate!==undefined){media.playbackRate=status.rate;}if(status.volume!==undefined){media.volume=status.volume;}if(status.isMuted!==undefined){media.muted=status.isMuted;}if(status.isLooping!==undefined){media.loop=status.isLooping;}return getStatusFromMedia(media);}var mediaRecorder=null;var mediaRecorderUptimeOfLastStartResume=0;var mediaRecorderDurationAlreadyRecorded=0;var mediaRecorderIsRecording=false;function getAudioRecorderDurationMillis(){var duration=mediaRecorderDurationAlreadyRecorded;if(mediaRecorderIsRecording&&mediaRecorderUptimeOfLastStartResume>0){duration+=Date.now()-mediaRecorderUptimeOfLastStartResume;}return duration;}export default{get name(){return'ExponentAV';},getStatusForVideo:function getStatusForVideo(element){return _regeneratorRuntime.async(function getStatusForVideo$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",getStatusFromMedia(element));case 1:case\"end\":return _context2.stop();}}},null,null,null,Promise);},loadForVideo:function loadForVideo(element,nativeSource,fullInitialStatus){return _regeneratorRuntime.async(function loadForVideo$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",getStatusFromMedia(element));case 1:case\"end\":return _context3.stop();}}},null,null,null,Promise);},unloadForVideo:function unloadForVideo(element){return _regeneratorRuntime.async(function unloadForVideo$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",getStatusFromMedia(element));case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);},setStatusForVideo:function setStatusForVideo(element,status){return _regeneratorRuntime.async(function setStatusForVideo$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",setStatusForMedia(element,status));case 1:case\"end\":return _context5.stop();}}},null,null,null,Promise);},replayVideo:function replayVideo(element,status){return _regeneratorRuntime.async(function replayVideo$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:return _context6.abrupt(\"return\",setStatusForMedia(element,status));case 1:case\"end\":return _context6.stop();}}},null,null,null,Promise);},setAudioMode:function setAudioMode(){return _regeneratorRuntime.async(function setAudioMode$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:case\"end\":return _context7.stop();}}},null,null,null,Promise);},setAudioIsEnabled:function setAudioIsEnabled(){return _regeneratorRuntime.async(function setAudioIsEnabled$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:case\"end\":return _context8.stop();}}},null,null,null,Promise);},getStatusForSound:function getStatusForSound(element){return _regeneratorRuntime.async(function getStatusForSound$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:return _context9.abrupt(\"return\",getStatusFromMedia(element));case 1:case\"end\":return _context9.stop();}}},null,null,null,Promise);},loadForSound:function loadForSound(nativeSource,fullInitialStatus){var source,media,status;return _regeneratorRuntime.async(function loadForSound$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:source=typeof nativeSource==='string'?nativeSource:nativeSource.uri;media=new Audio(source);media.ontimeupdate=function(){SyntheticPlatformEmitter.emit('didUpdatePlaybackStatus',{key:media,status:getStatusFromMedia(media)});};media.onerror=function(){SyntheticPlatformEmitter.emit('ExponentAV.onError',{key:media,error:media.error.message});};status=setStatusForMedia(media,fullInitialStatus);return _context10.abrupt(\"return\",[media,status]);case 6:case\"end\":return _context10.stop();}}},null,null,null,Promise);},unloadForSound:function unloadForSound(element){return _regeneratorRuntime.async(function unloadForSound$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:element.pause();element.removeAttribute('src');element.load();return _context11.abrupt(\"return\",getStatusFromMedia(element));case 4:case\"end\":return _context11.stop();}}},null,null,null,Promise);},setStatusForSound:function setStatusForSound(element,status){return _regeneratorRuntime.async(function setStatusForSound$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:return _context12.abrupt(\"return\",setStatusForMedia(element,status));case 1:case\"end\":return _context12.stop();}}},null,null,null,Promise);},replaySound:function replaySound(element,status){return _regeneratorRuntime.async(function replaySound$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:return _context13.abrupt(\"return\",setStatusForMedia(element,status));case 1:case\"end\":return _context13.stop();}}},null,null,null,Promise);},getAudioRecordingStatus:function getAudioRecordingStatus(){var _mediaRecorder,_mediaRecorder2,_mediaRecorder3;return _regeneratorRuntime.async(function getAudioRecordingStatus$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:return _context14.abrupt(\"return\",{canRecord:((_mediaRecorder=mediaRecorder)==null?void 0:_mediaRecorder.state)==='recording'||((_mediaRecorder2=mediaRecorder)==null?void 0:_mediaRecorder2.state)==='inactive',isRecording:((_mediaRecorder3=mediaRecorder)==null?void 0:_mediaRecorder3.state)==='recording',durationMillis:getAudioRecorderDurationMillis()});case 1:case\"end\":return _context14.stop();}}},null,null,null,Promise);},prepareAudioRecorder:function prepareAudioRecorder(options){var stream;return _regeneratorRuntime.async(function prepareAudioRecorder$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:if(!(typeof navigator!=='undefined'&&!navigator.mediaDevices)){_context15.next=2;break;}throw new Error('No media devices available');case 2:mediaRecorderUptimeOfLastStartResume=0;mediaRecorderDurationAlreadyRecorded=0;_context15.next=6;return _regeneratorRuntime.awrap(navigator.mediaDevices.getUserMedia({audio:true}));case 6:stream=_context15.sent;mediaRecorder=new window.MediaRecorder(stream,(options==null?void 0:options.web)||RECORDING_OPTIONS_PRESET_HIGH_QUALITY.web);mediaRecorder.addEventListener('pause',function(){mediaRecorderDurationAlreadyRecorded=getAudioRecorderDurationMillis();mediaRecorderIsRecording=false;});mediaRecorder.addEventListener('resume',function(){mediaRecorderUptimeOfLastStartResume=Date.now();mediaRecorderIsRecording=true;});mediaRecorder.addEventListener('start',function(){mediaRecorderUptimeOfLastStartResume=Date.now();mediaRecorderDurationAlreadyRecorded=0;mediaRecorderIsRecording=true;});mediaRecorder.addEventListener('stop',function(){mediaRecorderDurationAlreadyRecorded=getAudioRecorderDurationMillis();mediaRecorderIsRecording=false;stream.getTracks().forEach(function(track){return track.stop();});});_context15.next=14;return _regeneratorRuntime.awrap(this.getAudioRecordingStatus());case 14:_context15.t0=_context15.sent;return _context15.abrupt(\"return\",{uri:null,status:_context15.t0});case 16:case\"end\":return _context15.stop();}}},null,this,null,Promise);},startAudioRecording:function startAudioRecording(){return _regeneratorRuntime.async(function startAudioRecording$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:if(!(mediaRecorder===null)){_context16.next=2;break;}throw new Error('Cannot start an audio recording without initializing a MediaRecorder. Run prepareToRecordAsync() before attempting to start an audio recording.');case 2:if(mediaRecorder.state==='paused'){mediaRecorder.resume();}else{mediaRecorder.start();}return _context16.abrupt(\"return\",this.getAudioRecordingStatus());case 4:case\"end\":return _context16.stop();}}},null,this,null,Promise);},pauseAudioRecording:function pauseAudioRecording(){return _regeneratorRuntime.async(function pauseAudioRecording$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:if(!(mediaRecorder===null)){_context17.next=2;break;}throw new Error('Cannot start an audio recording without initializing a MediaRecorder. Run prepareToRecordAsync() before attempting to start an audio recording.');case 2:mediaRecorder.pause();return _context17.abrupt(\"return\",this.getAudioRecordingStatus());case 4:case\"end\":return _context17.stop();}}},null,this,null,Promise);},stopAudioRecording:function stopAudioRecording(){var dataPromise,data,url;return _regeneratorRuntime.async(function stopAudioRecording$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:if(!(mediaRecorder===null)){_context18.next=2;break;}throw new Error('Cannot start an audio recording without initializing a MediaRecorder. Run prepareToRecordAsync() before attempting to start an audio recording.');case 2:if(!(mediaRecorder.state==='inactive')){_context18.next=7;break;}_context18.next=5;return _regeneratorRuntime.awrap(this.getAudioRecordingStatus());case 5:_context18.t0=_context18.sent;return _context18.abrupt(\"return\",{uri:null,status:_context18.t0});case 7:dataPromise=new Promise(function(resolve){return mediaRecorder.addEventListener('dataavailable',function(e){resolve(e.data);});});mediaRecorder.stop();_context18.next=11;return _regeneratorRuntime.awrap(dataPromise);case 11:data=_context18.sent;url=URL.createObjectURL(data);_context18.t1=url;_context18.next=16;return _regeneratorRuntime.awrap(this.getAudioRecordingStatus());case 16:_context18.t2=_context18.sent;return _context18.abrupt(\"return\",{uri:_context18.t1,status:_context18.t2});case 18:case\"end\":return _context18.stop();}}},null,this,null,Promise);},unloadAudioRecorder:function unloadAudioRecorder(){return _regeneratorRuntime.async(function unloadAudioRecorder$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:mediaRecorder=null;case 1:case\"end\":return _context19.stop();}}},null,null,null,Promise);},getPermissionsAsync:getPermissionsAsync,requestPermissionsAsync:function requestPermissionsAsync(){return _regeneratorRuntime.async(function requestPermissionsAsync$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:return _context20.abrupt(\"return\",getPermissionsAsync());case 1:case\"end\":return _context20.stop();}}},null,null,null,Promise);}};","map":null,"metadata":{},"sourceType":"module"}