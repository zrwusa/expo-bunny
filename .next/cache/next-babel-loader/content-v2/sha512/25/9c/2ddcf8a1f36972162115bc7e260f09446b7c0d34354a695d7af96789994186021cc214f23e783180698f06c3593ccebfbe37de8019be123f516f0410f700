{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{IcoMoon,Text,TextButton,View}from\"../UI\";import{Col,ModalFromRight,Row}from\"../../containers\";import*as React from'react';import{useEffect,useState}from'react';import{useBunnyKit}from\"../../hooks/bunny-kit\";import{getSharedStyles}from\"../../helpers\";import{makeStyles}from\"./styles\";import FlatList from\"react-native-web/dist/exports/FlatList\";import KeyboardAvoidingView from\"react-native-web/dist/exports/KeyboardAvoidingView\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import{InlineSelector}from\"../InlineSelector\";import{Searchbar}from'react-native-paper';import{firebase}from\"../../firebase/firebase\";import{useIsMounted}from\"../../hooks/is-mounted\";import{uuidV4}from\"../../utils\";export var TreeNodePicker=function TreeNodePicker(props){var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,wp=_useBunnyKit.wp;var _getSharedStyles=getSharedStyles(sizeLabor,themeLabor),sharedStyles=_getSharedStyles.sharedStyles;var styles=makeStyles(sizeLabor,themeLabor);var isMounted=useIsMounted();var _props$dataMode=props.dataMode,dataMode=_props$dataMode===void 0?'local':_props$dataMode,_onDone=props.onDone,onCancel=props.onCancel,_props$titles=props.titles,titles=_props$titles===void 0?['title0','title1','title2']:_props$titles,initialTreeNode=props.initialTreeNode,_props$data=props.data,data=_props$data===void 0?dataMode==='local'?[]:undefined:_props$data,_props$level=props.level,level=_props$level===void 0?0:_props$level,_props$childrenKeys=props.childrenKeys,childrenKeys=_props$childrenKeys===void 0?['children','children','children']:_props$childrenKeys,_props$collectionPath=props.collectionPaths,collectionPaths=_props$collectionPath===void 0?['collection0','collection1','collection1']:_props$collectionPath,_props$conditions=props.conditions,conditions=_props$conditions===void 0?dataMode==='firestore'?[['','==',''],['category','==','$code']]:undefined:_props$conditions,_props$condition=props.condition,condition=_props$condition===void 0?dataMode==='local'?undefined:['','==','']:_props$condition,_props$leafLevel=props.leafLevel,leafLevel=_props$leafLevel===void 0?1:_props$leafLevel,_props$keyExtractors=props.keyExtractors,keyExtractors=_props$keyExtractors===void 0?['id','id','id']:_props$keyExtractors,currentNodes=props.currentNodes,_props$displayFields=props.displayFields,displayFields=_props$displayFields===void 0?['name','name','name']:_props$displayFields;var _useState=useState(level!==0?currentNodes:new Array(leafLevel)),_useState2=_slicedToArray(_useState,2),currentNodesState=_useState2[0],setCurrentNodesState=_useState2[1];var _useState3=useState(data),_useState4=_slicedToArray(_useState3,2),orgData=_useState4[0],setOrgData=_useState4[1];var _useState5=useState(orgData),_useState6=_slicedToArray(_useState5,2),filterData=_useState6[0],setFilterData=_useState6[1];var _useState7=useState(undefined),_useState8=_slicedToArray(_useState7,2),children=_useState8[0],setChildren=_useState8[1];var childrenLevel=level+1;var _reset=function _reset(){};var title=titles[level];var childrenKey=childrenKeys[level];var collectionPath=collectionPaths[level];var _keyExtractor=keyExtractors[level];var displayField=displayFields[level];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),childrenCondition=_useState10[0],setChildrenCondition=_useState10[1];useEffect(function(){(function _callee(){var collectionRef,snapshot,_data;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(dataMode==='firestore'&&isMounted)){_context.next=15;break;}collectionRef=firebase.firestore().collection(collectionPath);if(!(JSON.stringify(condition)!==JSON.stringify(['','==','']))){_context.next=8;break;}_context.next=5;return _regeneratorRuntime.awrap(collectionRef.where.apply(collectionRef,_toConsumableArray(condition)).get());case 5:snapshot=_context.sent;_context.next=11;break;case 8:_context.next=10;return _regeneratorRuntime.awrap(collectionRef.get());case 10:snapshot=_context.sent;case 11:_data=[];snapshot.forEach(function(doc){_data.push(doc.data());});setOrgData(_data);setFilterData(_data);case 15:case\"end\":return _context.stop();}}},null,null,null,Promise);})();},[]);var treeNodePress=function treeNodePress(treeNode){var newState,_condition,$key,fieldPath,filterOp;return _regeneratorRuntime.async(function treeNodePress$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:newState=_toConsumableArray(currentNodesState);newState[level]=treeNode;_context2.t0=dataMode;_context2.next=_context2.t0==='local'?5:_context2.t0==='firestore'?7:14;break;case 5:if(treeNode!=null&&treeNode[childrenKey]){setChildren(treeNode[childrenKey]);setIsShowChildrenModal(true);}else{setChildren(undefined);_onDone==null?void 0:_onDone(newState);}return _context2.abrupt(\"break\",14);case 7:_condition=conditions==null?void 0:conditions[childrenLevel];$key=_condition==null?void 0:_condition[2].split('$')[1];fieldPath=_condition==null?void 0:_condition[0];filterOp=_condition==null?void 0:_condition[1];setCurrentNodesState(newState);if(level===leafLevel){_onDone==null?void 0:_onDone(newState);}else{if(fieldPath&&filterOp&&$key){setChildrenCondition([fieldPath,filterOp,treeNode[$key]]);setChildren([]);setIsShowChildrenModal(true);}}return _context2.abrupt(\"break\",14);case 14:case\"end\":return _context2.stop();}}},null,null,null,Promise);};var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isShowChildrenModal=_useState12[0],setIsShowChildrenModal=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),searchQuery=_useState14[0],setSearchQuery=_useState14[1];var onChangeSearch=function onChangeSearch(searchQuery){setSearchQuery(searchQuery);};useEffect(function(){var filterData=searchQuery.trim()?orgData==null?void 0:orgData.filter(function(item){return item.name.toLowerCase().includes(searchQuery.toLowerCase());}):orgData;setFilterData(filterData);},[searchQuery]);return React.createElement(SafeAreaView,{style:[styles.container]},React.createElement(View,{style:styles.header},React.createElement(Row,null,React.createElement(Col,null,React.createElement(TextButton,{onPress:function onPress(){onCancel==null?void 0:onCancel();}},React.createElement(IcoMoon,{name:\"x\"}))),React.createElement(Col,{align:\"center\"},React.createElement(Text,null,title)),React.createElement(Col,{align:\"flex-end\"},React.createElement(TextButton,{onPress:_reset},React.createElement(Text,{style:sharedStyles.text2},\"Reset\"))))),React.createElement(View,{style:styles.content},React.createElement(View,{style:{flex:1,marginBottom:wp(10)}},React.createElement(KeyboardAvoidingView,{style:{flex:1,flexDirection:'column',justifyContent:'center'},behavior:\"padding\",enabled:true,keyboardVerticalOffset:wp(100)},React.createElement(FlatList,{style:{flex:1,marginBottom:wp(10)},data:filterData,keyExtractor:function keyExtractor(item){var _item$keyExtractor;return((_item$keyExtractor=item[_keyExtractor])==null?void 0:_item$keyExtractor.toString())||uuidV4();},initialNumToRender:2,windowSize:3,renderItem:function renderItem(_ref){var item=_ref.item;return React.createElement(InlineSelector,{textAlign:\"flex-start\",columns:[0,9,1],onPress:function _callee2(){return _regeneratorRuntime.async(function _callee2$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(treeNodePress(item));case 2:case\"end\":return _context3.stop();}}},null,null,null,Promise);},renderText:function renderText(){var _item$displayField;return(item==null?void 0:(_item$displayField=item[displayField])==null?void 0:_item$displayField.toString())||'';},isShowChevron:dataMode==='local'?!!item.children:level!==leafLevel});}}),React.createElement(Searchbar,{placeholder:\"Search\",onChangeText:onChangeSearch,value:searchQuery})),dataMode==='local'&&children||dataMode==='firestore'&&children?React.createElement(ModalFromRight,{isVisible:isShowChildrenModal,onVisibleChanged:function onVisibleChanged(isVisible){setIsShowChildrenModal(isVisible);}},React.createElement(TreeNodePicker,{condition:childrenCondition,data:dataMode==='local'?children:undefined,level:childrenLevel,onDone:function onDone(result){setIsShowChildrenModal(false);_onDone==null?void 0:_onDone(result);},onCancel:function onCancel(){setIsShowChildrenModal(false);},currentNodes:currentNodesState,leafLevel:leafLevel,dataMode:dataMode,titles:titles,collectionPaths:collectionPaths,conditions:conditions,keyExtractors:keyExtractors,initialTreeNode:initialTreeNode,displayFields:displayFields})):null)));};","map":null,"metadata":{},"sourceType":"module"}