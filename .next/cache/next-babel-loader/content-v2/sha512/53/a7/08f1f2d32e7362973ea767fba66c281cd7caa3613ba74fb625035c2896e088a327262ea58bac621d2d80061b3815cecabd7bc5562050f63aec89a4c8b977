{"ast":null,"code":"\"use strict\";var _interopRequireDefault2=require(\"@babel/runtime/helpers/interopRequireDefault\");var _defineProperty2=_interopRequireDefault2(require(\"@babel/runtime/helpers/defineProperty\"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}exports.__esModule=true;exports.defaultHead=defaultHead;exports.default=void 0;var _react=_interopRequireWildcard(require(\"react\"));var _sideEffect=_interopRequireDefault(require(\"./side-effect\"));var _ampContext=require(\"./amp-context\");var _headManagerContext=require(\"./head-manager-context\");var _amp=require(\"./amp\");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _getRequireWildcardCache(){if(typeof WeakMap!==\"function\")return null;var cache=new WeakMap();_getRequireWildcardCache=function _getRequireWildcardCache(){return cache;};return cache;}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!==\"object\"&&typeof obj!==\"function\"){return{default:obj};}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function defaultHead(){var inAmpMode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var head=[_react.default.createElement(\"meta\",{charSet:\"utf-8\"})];if(!inAmpMode){head.push(_react.default.createElement(\"meta\",{name:\"viewport\",content:\"width=device-width\"}));}return head;}function onlyReactElement(list,child){if(typeof child==='string'||typeof child==='number'){return list;}if(child.type===_react.default.Fragment){return list.concat(_react.default.Children.toArray(child.props.children).reduce(function(fragmentList,fragmentChild){if(typeof fragmentChild==='string'||typeof fragmentChild==='number'){return fragmentList;}return fragmentList.concat(fragmentChild);},[]));}return list.concat(child);}var METATYPES=['name','httpEquiv','charSet','itemProp'];function unique(){var keys=new Set();var tags=new Set();var metaTypes=new Set();var metaCategories={};return function(h){var isUnique=true;var hasKey=false;if(h.key&&typeof h.key!=='number'&&h.key.indexOf('$')>0){hasKey=true;var key=h.key.slice(h.key.indexOf('$')+1);if(keys.has(key)){isUnique=false;}else{keys.add(key);}}switch(h.type){case'title':case'base':if(tags.has(h.type)){isUnique=false;}else{tags.add(h.type);}break;case'meta':for(var i=0,len=METATYPES.length;i<len;i++){var metatype=METATYPES[i];if(!h.props.hasOwnProperty(metatype))continue;if(metatype==='charSet'){if(metaTypes.has(metatype)){isUnique=false;}else{metaTypes.add(metatype);}}else{var category=h.props[metatype];var categories=metaCategories[metatype]||new Set();if((metatype!=='name'||!hasKey)&&categories.has(category)){isUnique=false;}else{categories.add(category);metaCategories[metatype]=categories;}}}break;}return isUnique;};}function reduceComponents(headElements,props){return headElements.reduce(function(list,headElement){var headElementChildren=_react.default.Children.toArray(headElement.props.children);return list.concat(headElementChildren);},[]).reduce(onlyReactElement,[]).reverse().concat(defaultHead(props.inAmpMode)).filter(unique()).reverse().map(function(c,i){var key=c.key||i;if(false&&process.env.__NEXT_OPTIMIZE_FONTS&&!props.inAmpMode){if(c.type==='link'&&c.props['href']&&['https://fonts.googleapis.com/css','https://use.typekit.net/'].some(function(url){return c.props['href'].startsWith(url);})){var newProps=_objectSpread({},c.props||{});newProps['data-href']=newProps['href'];newProps['href']=undefined;newProps['data-optimized-fonts']=true;return _react.default.cloneElement(c,newProps);}}return _react.default.cloneElement(c,{key:key});});}function Head(_ref){var children=_ref.children;var ampState=(0,_react.useContext)(_ampContext.AmpStateContext);var headManager=(0,_react.useContext)(_headManagerContext.HeadManagerContext);return _react.default.createElement(_sideEffect.default,{reduceComponentsToState:reduceComponents,headManager:headManager,inAmpMode:(0,_amp.isInAmpMode)(ampState)},children);}_c=Head;Head.rewind=function(){};var _default=Head;exports.default=_default;var _c;$RefreshReg$(_c,\"Head\");","map":{"version":3,"sources":["../../../next-server/lib/head.tsx"],"names":["inAmpMode","head","child","React","list","fragmentList","METATYPES","keys","tags","metaTypes","metaCategories","h","isUnique","hasKey","key","i","len","metatype","category","categories","headElements","headElementChildren","headElement","defaultHead","props","unique","c","process","url","newProps","ampState","AmpStateContext","headManager","HeadManagerContext","Head"],"mappings":"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","sourcesContent":["import React, { useContext } from 'react'\nimport Effect from './side-effect'\nimport { AmpStateContext } from './amp-context'\nimport { HeadManagerContext } from './head-manager-context'\nimport { isInAmpMode } from './amp'\n\ntype WithInAmpMode = {\n  inAmpMode?: boolean\n}\n\nexport function defaultHead(inAmpMode = false): JSX.Element[] {\n  const head = [<meta charSet=\"utf-8\" />]\n  if (!inAmpMode) {\n    head.push(<meta name=\"viewport\" content=\"width=device-width\" />)\n  }\n  return head\n}\n\nfunction onlyReactElement(\n  list: Array<React.ReactElement<any>>,\n  child: React.ReactChild\n): Array<React.ReactElement<any>> {\n  // React children can be \"string\" or \"number\" in this case we ignore them for backwards compat\n  if (typeof child === 'string' || typeof child === 'number') {\n    return list\n  }\n  // Adds support for React.Fragment\n  if (child.type === React.Fragment) {\n    return list.concat(\n      React.Children.toArray(child.props.children).reduce(\n        (\n          fragmentList: Array<React.ReactElement<any>>,\n          fragmentChild: React.ReactChild\n        ): Array<React.ReactElement<any>> => {\n          if (\n            typeof fragmentChild === 'string' ||\n            typeof fragmentChild === 'number'\n          ) {\n            return fragmentList\n          }\n          return fragmentList.concat(fragmentChild)\n        },\n        []\n      )\n    )\n  }\n  return list.concat(child)\n}\n\nconst METATYPES = ['name', 'httpEquiv', 'charSet', 'itemProp']\n\n/*\n returns a function for filtering head child elements\n which shouldn't be duplicated, like <title/>\n Also adds support for deduplicated `key` properties\n*/\nfunction unique() {\n  const keys = new Set()\n  const tags = new Set()\n  const metaTypes = new Set()\n  const metaCategories: { [metatype: string]: Set<string> } = {}\n\n  return (h: React.ReactElement<any>) => {\n    let isUnique = true\n    let hasKey = false\n\n    if (h.key && typeof h.key !== 'number' && h.key.indexOf('$') > 0) {\n      hasKey = true\n      const key = h.key.slice(h.key.indexOf('$') + 1)\n      if (keys.has(key)) {\n        isUnique = false\n      } else {\n        keys.add(key)\n      }\n    }\n\n    // eslint-disable-next-line default-case\n    switch (h.type) {\n      case 'title':\n      case 'base':\n        if (tags.has(h.type)) {\n          isUnique = false\n        } else {\n          tags.add(h.type)\n        }\n        break\n      case 'meta':\n        for (let i = 0, len = METATYPES.length; i < len; i++) {\n          const metatype = METATYPES[i]\n          if (!h.props.hasOwnProperty(metatype)) continue\n\n          if (metatype === 'charSet') {\n            if (metaTypes.has(metatype)) {\n              isUnique = false\n            } else {\n              metaTypes.add(metatype)\n            }\n          } else {\n            const category = h.props[metatype]\n            const categories = metaCategories[metatype] || new Set()\n            if ((metatype !== 'name' || !hasKey) && categories.has(category)) {\n              isUnique = false\n            } else {\n              categories.add(category)\n              metaCategories[metatype] = categories\n            }\n          }\n        }\n        break\n    }\n\n    return isUnique\n  }\n}\n\n/**\n *\n * @param headElements List of multiple <Head> instances\n */\nfunction reduceComponents(\n  headElements: Array<React.ReactElement<any>>,\n  props: WithInAmpMode\n) {\n  return headElements\n    .reduce(\n      (list: React.ReactChild[], headElement: React.ReactElement<any>) => {\n        const headElementChildren = React.Children.toArray(\n          headElement.props.children\n        )\n        return list.concat(headElementChildren)\n      },\n      []\n    )\n    .reduce(onlyReactElement, [])\n    .reverse()\n    .concat(defaultHead(props.inAmpMode))\n    .filter(unique())\n    .reverse()\n    .map((c: React.ReactElement<any>, i: number) => {\n      const key = c.key || i\n      if (\n        process.env.NODE_ENV !== 'development' &&\n        process.env.__NEXT_OPTIMIZE_FONTS &&\n        !props.inAmpMode\n      ) {\n        if (\n          c.type === 'link' &&\n          c.props['href'] &&\n          // TODO(prateekbh@): Replace this with const from `constants` when the tree shaking works.\n          [\n            'https://fonts.googleapis.com/css',\n            'https://use.typekit.net/',\n          ].some((url) => c.props['href'].startsWith(url))\n        ) {\n          const newProps = { ...(c.props || {}) }\n          newProps['data-href'] = newProps['href']\n          newProps['href'] = undefined\n\n          // Add this attribute to make it easy to identify optimized tags\n          newProps['data-optimized-fonts'] = true\n\n          return React.cloneElement(c, newProps)\n        }\n      }\n      return React.cloneElement(c, { key })\n    })\n}\n\n/**\n * This component injects elements to `<head>` of your page.\n * To avoid duplicated `tags` in `<head>` you can use the `key` property, which will make sure every tag is only rendered once.\n */\nfunction Head({ children }: { children: React.ReactNode }) {\n  const ampState = useContext(AmpStateContext)\n  const headManager = useContext(HeadManagerContext)\n  return (\n    <Effect\n      reduceComponentsToState={reduceComponents}\n      headManager={headManager}\n      inAmpMode={isInAmpMode(ampState)}\n    >\n      {children}\n    </Effect>\n  )\n}\n\n// TODO: Remove in the next major release\nHead.rewind = () => {}\n\nexport default Head\n"]},"metadata":{},"sourceType":"script"}