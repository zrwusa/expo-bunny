{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import React,{useEffect,useRef,useState}from'react';import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import View from\"react-native-web/dist/exports/View\";import{makeStyles}from\"./styles\";import{IcoMoon,Text}from\"../UI\";import{Audio}from\"../../../packages/expo-av/src\";import{ProgressBar}from'react-native-paper';import{minuted}from\"../../utils\";import{useBunnyKit}from\"../../hooks/bunny-kit\";export function AudioPlayer(props){var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,colors=_useBunnyKit.colors;var styles=makeStyles(sizeLabor,themeLabor);var source=props.source,style=props.style,onLoad=props.onLoad,onLoadStart=props.onLoadStart,onLoadEnd=props.onLoadEnd,onError=props.onError,_props$isDebug=props.isDebug,isDebug=_props$isDebug===void 0?false:_props$isDebug,progressStyle=props.progressStyle,progressColor=props.progressColor,playButtonStyle=props.playButtonStyle,remainTimeStyle=props.remainTimeStyle,playButtonIconStyle=props.playButtonIconStyle;var soundRef=useRef();var _useState=useState({isLoaded:false}),_useState2=_slicedToArray(_useState,2),status=_useState2[0],setStatus=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];useEffect(function(){(function _callee(){var _await$Audio$Sound$cr,sound;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(source){_context.next=3;break;}return _context.abrupt(\"return\");case 3:onLoadStart==null?void 0:onLoadStart();_context.next=6;return _regeneratorRuntime.awrap(Audio.Sound.createAsync(source));case 6:_await$Audio$Sound$cr=_context.sent;sound=_await$Audio$Sound$cr.sound;if(status!=null&&status.isLoaded){onLoad==null?void 0:onLoad();}soundRef.current=sound;soundRef.current.setOnPlaybackStatusUpdate(setStatus);onLoadEnd==null?void 0:onLoadEnd();_context.next=20;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);isDebug&&console.log(_context.t0.toString());setError(_context.t0.toString());onError==null?void 0:onError(_context.t0);onLoadEnd==null?void 0:onLoadEnd();case 20:case\"end\":return _context.stop();}}},null,null,[[0,14]],Promise);})();return function(){(function _callee2(){var curSoundRef;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:curSoundRef=soundRef.current;if(!curSoundRef){_context2.next=5;break;}curSoundRef.setOnPlaybackStatusUpdate(null);_context2.next=5;return _regeneratorRuntime.awrap(curSoundRef.unloadAsync());case 5:case\"end\":return _context2.stop();}}},null,null,null,Promise);})();};},[]);function togglePlayOrPause(){var curSoundRef;return _regeneratorRuntime.async(function togglePlayOrPause$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(soundRef.current){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2:if(!(status&&status.isLoaded)){_context3.next=17;break;}curSoundRef=soundRef.current;if(!curSoundRef){_context3.next=17;break;}if(!status.isPlaying){_context3.next=10;break;}_context3.next=8;return _regeneratorRuntime.awrap(curSoundRef.pauseAsync());case 8:_context3.next=17;break;case 10:if(!(status.positionMillis===status.durationMillis)){_context3.next=15;break;}_context3.next=13;return _regeneratorRuntime.awrap(curSoundRef.replayAsync());case 13:_context3.next=17;break;case 15:_context3.next=17;return _regeneratorRuntime.awrap(curSoundRef.playAsync());case 17:case\"end\":return _context3.stop();}}},null,null,null,Promise);}return React.createElement(View,{style:[styles.container,style]},isDebug?React.createElement(React.Fragment,null,React.createElement(Text,null,\"error:\",error),React.createElement(Text,null,\"status:\",JSON.stringify(status))):null,React.createElement(TouchableOpacity,{onPress:function _callee3(){return _regeneratorRuntime.async(function _callee3$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(togglePlayOrPause());case 2:case\"end\":return _context4.stop();}}},null,null,null,Promise);}},React.createElement(View,{style:styles.control},React.createElement(View,{style:[styles.playButton,playButtonStyle]},status!=null&&status.isLoaded?status.isPlaying?React.createElement(IcoMoon,{style:[styles.playButtonIcon,playButtonIconStyle],name:\"pause\"}):React.createElement(IcoMoon,{style:[styles.playButtonIcon,playButtonIconStyle],name:\"play\"}):React.createElement(ActivityIndicator,null)),React.createElement(View,{style:styles.progress},status!=null&&status.isLoaded?status.durationMillis?React.createElement(React.Fragment,null,React.createElement(ProgressBar,{style:progressStyle,color:progressColor,progress:(status.positionMillis|0)/status.durationMillis}),React.createElement(Text,{style:[styles.remainTime,remainTimeStyle]},minuted(status.durationMillis-status.positionMillis))):React.createElement(React.Fragment,null,React.createElement(ProgressBar,{progress:0,color:progressColor,style:progressStyle}),React.createElement(Text,{style:[styles.remainTime,remainTimeStyle]},\" \")):React.createElement(ActivityIndicator,{color:progressColor})))));}","map":null,"metadata":{},"sourceType":"module"}