{"ast":null,"code":"import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";var _jsxFileName=\"/Users/revone/projects/expo-react-bunny/src/components/ReadMore/ReadMore.tsx\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import React from'react';import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import{makeStyles}from\"./styles\";import{withBunnyKit}from\"../../hooks/bunny-kit\";var ReadMoreInner=function(_React$Component){_inherits(ReadMoreInner,_React$Component);var _super=_createSuper(ReadMoreInner);function ReadMoreInner(){var _this;_classCallCheck(this,ReadMoreInner);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this._isMounted=false;_this._text=null;_this.state={measured:false,shouldShowReadMore:false,showAllText:false};_this._handlePressReadMore=function(){_this.setState({showAllText:true});};_this._handlePressReadLess=function(){_this.setState({showAllText:false});};return _this;}_createClass(ReadMoreInner,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;var fullHeight,limitedHeight;return _regeneratorRuntime.async(function componentDidMount$(_context){while(1){switch(_context.prev=_context.next){case 0:this._isMounted=true;_context.next=3;return _regeneratorRuntime.awrap(nextFrameAsync());case 3:if(this._isMounted){_context.next=5;break;}return _context.abrupt(\"return\");case 5:if(!this._text){_context.next=18;break;}_context.next=8;return _regeneratorRuntime.awrap(measureHeightAsync(this._text));case 8:fullHeight=_context.sent;this.setState({measured:true});_context.next=12;return _regeneratorRuntime.awrap(nextFrameAsync());case 12:if(this._isMounted){_context.next=14;break;}return _context.abrupt(\"return\");case 14:_context.next=16;return _regeneratorRuntime.awrap(measureHeightAsync(this._text));case 16:limitedHeight=_context.sent;if(fullHeight>limitedHeight){this.setState({shouldShowReadMore:true},function(){_this2.props.onReady&&_this2.props.onReady();});}else{this.props.onReady&&this.props.onReady();}case 18:case\"end\":return _context.stop();}}},null,this,null,Promise);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,measured=_this$state.measured,showAllText=_this$state.showAllText;var numberOfLines=this.props.numberOfLines;return React.createElement(View,{__self:this,__source:{fileName:_jsxFileName,lineNumber:66,columnNumber:13}},React.createElement(Text,{numberOfLines:measured&&!showAllText?numberOfLines:0,style:[this.props.textStyle],ref:function ref(text){_this3._text=text;},__self:this,__source:{fileName:_jsxFileName,lineNumber:67,columnNumber:17}},this.props.children),React.createElement(View,{style:{alignItems:'flex-end'},__self:this,__source:{fileName:_jsxFileName,lineNumber:77,columnNumber:17}},this._maybeRenderReadMore()));}},{key:\"_maybeRenderReadMore\",value:function _maybeRenderReadMore(){var bunnyKit=this.props.bunnyKit;var sizeLabor=bunnyKit.sizeLabor,themeLabor=bunnyKit.themeLabor;var styles=makeStyles(sizeLabor,themeLabor);var _this$state2=this.state,shouldShowReadMore=_this$state2.shouldShowReadMore,showAllText=_this$state2.showAllText;if(shouldShowReadMore&&!showAllText){if(this.props.renderTruncatedFooter){return this.props.renderTruncatedFooter(this._handlePressReadMore);}return React.createElement(Text,{style:styles.button,onPress:this._handlePressReadMore,__self:this,__source:{fileName:_jsxFileName,lineNumber:102,columnNumber:17}},\"more\");}else if(shouldShowReadMore&&showAllText){if(this.props.renderRevealedFooter){return this.props.renderRevealedFooter(this._handlePressReadLess);}return React.createElement(Text,{style:styles.button,onPress:this._handlePressReadLess,__self:this,__source:{fileName:_jsxFileName,lineNumber:112,columnNumber:17}},\"hide\");}}}]);return ReadMoreInner;}(React.Component);export var ReadMore=withBunnyKit(ReadMoreInner);function measureHeightAsync(component){return new Promise(function(resolve){component.measure(function(x,y,w,h){resolve(h);});});}function nextFrameAsync(){return new Promise(function(resolve){return requestAnimationFrame(function(){return resolve(true);});});}","map":{"version":3,"sources":["/Users/revone/projects/expo-react-bunny/src/components/ReadMore/ReadMore.tsx"],"names":["ReadMoreInner","React","Component","_isMounted","_text","state","measured","shouldShowReadMore","showAllText","nextFrameAsync","fullHeight","measureHeightAsync","limitedHeight","numberOfLines","alignItems","_handlePressReadMore","_handlePressReadLess","bunnyKit","sizeLabor","themeLabor","styles","makeStyles","ReadMore","withBunnyKit","component","resolve","requestAnimationFrame"],"mappings":"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","sourcesContent":["import React, {ReactNode} from 'react';\nimport {StyleProp, Text, TextStyle, View} from 'react-native';\nimport {makeStyles} from './styles';\nimport {withBunnyKit, WithBunnyKit} from '../../hooks/bunny-kit';\n\ninterface ReadMoreProps extends WithBunnyKit {\n    numberOfLines: number,\n    onReady?: () => void,\n    renderTruncatedFooter?: (param: undefined | (() => void)) => ReactNode,\n    renderRevealedFooter?: (param: undefined | (() => void)) => ReactNode,\n    textStyle?: StyleProp<TextStyle>,\n}\n\nclass ReadMoreInner extends React.Component<React.PropsWithChildren<ReadMoreProps>> {\n    private _isMounted = false;\n    private _text: Text | null = null;\n    state = {\n        measured: false,\n        shouldShowReadMore: false,\n        showAllText: false\n    };\n\n    async componentDidMount() {\n        //todo Warning: Can't perform a React state update on an unmounted component. This is a no-op, but it indicates a memory leak in your application. To fix, cancel all subscriptions and asynchronous tasks in the componentWillUnmount method.\n        this._isMounted = true;\n        await nextFrameAsync();\n\n        if (!this._isMounted) {\n            return;\n        }\n\n        if (this._text) {\n            // Get the height of the text with no restriction on number of lines\n            const fullHeight = await measureHeightAsync(this._text);\n            this.setState({measured: true});\n            await nextFrameAsync();\n\n            if (!this._isMounted) {\n                return;\n            }\n\n            // Get the height of the text now that number of lines has been set\n            const limitedHeight = await measureHeightAsync(this._text);\n\n            if (fullHeight > limitedHeight) {\n                this.setState({shouldShowReadMore: true}, () => {\n                    this.props.onReady && this.props.onReady();\n                });\n            } else {\n                this.props.onReady && this.props.onReady();\n            }\n        }\n\n    }\n\n    componentWillUnmount() {\n        this._isMounted = false;\n    }\n\n    render() {\n        let {measured, showAllText} = this.state;\n\n        let {numberOfLines} = this.props;\n\n        return (\n            <View>\n                <Text\n                    numberOfLines={measured && !showAllText ? numberOfLines : 0}\n                    style={[this.props.textStyle]}\n                    ref={text => {\n                        this._text = text;\n                    }}\n                >\n                    {this.props.children}\n                </Text>\n\n                <View style={{alignItems: 'flex-end'}}>{this._maybeRenderReadMore()}</View>\n            </View>\n        );\n    }\n\n    _handlePressReadMore = () => {\n        this.setState({showAllText: true});\n    };\n\n    _handlePressReadLess = () => {\n        this.setState({showAllText: false});\n    };\n\n    _maybeRenderReadMore() {\n        const {bunnyKit} = this.props;\n        const {sizeLabor, themeLabor} = bunnyKit;\n        const styles = makeStyles(sizeLabor, themeLabor);\n        let {shouldShowReadMore, showAllText} = this.state;\n\n        if (shouldShowReadMore && !showAllText) {\n            if (this.props.renderTruncatedFooter) {\n                return this.props.renderTruncatedFooter(this._handlePressReadMore);\n            }\n\n            return (\n                <Text style={styles.button} onPress={this._handlePressReadMore}>\n                    more\n                </Text>\n            );\n        } else if (shouldShowReadMore && showAllText) {\n            if (this.props.renderRevealedFooter) {\n                return this.props.renderRevealedFooter(this._handlePressReadLess);\n            }\n\n            return (\n                <Text style={styles.button} onPress={this._handlePressReadLess}>\n                    hide\n                </Text>\n            );\n        }\n    }\n}\n\nexport const ReadMore = withBunnyKit(ReadMoreInner);\n\nfunction measureHeightAsync(component: Text) {\n    return new Promise<number>(resolve => {\n        component.measure((x, y, w, h) => {\n            resolve(h);\n        });\n    });\n}\n\nfunction nextFrameAsync() {\n    return new Promise(resolve => requestAnimationFrame(() => resolve(true)));\n}\n"]},"metadata":{},"sourceType":"module"}