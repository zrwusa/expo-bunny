{"ast":null,"code":"var _s=$RefreshSig$();import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";var _jsxFileName=\"/Users/revone/projects/expo-react-bunny/src/screens/DemoChat/ChatRoom/ChatRoom.tsx\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{useCallback,useEffect,useMemo,useState}from'react';import{AudioRecorder,BunnyChat,ImageUploader,Preparing,StickerPicker}from\"../../../components\";import{useDispatch,useSelector}from'react-redux';import{isLoaded,useFirestore,useFirestoreConnect}from'react-redux-firebase';import{firestoreTimestampToDate,uuidV4}from\"../../../utils\";import Keyboard from\"react-native-web/dist/exports/Keyboard\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import{IcoMoon}from\"../../../components/UI\";import{makeStyles}from\"./styles\";import{useBunnyKit}from\"../../../hooks/bunny-kit\";import{collectSysError}from\"../../../store/actions\";export function ChatRoomScreen(_ref){_s();var _this=this;var route=_ref.route,navigation=_ref.navigation;var conversationId=route.params.conversationId;var firestore=useFirestore();var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,authLabor=_useBunnyKit.authLabor,wp=_useBunnyKit.wp;var authResult=authLabor.authResult;var user=authResult.user;var dispatch=useDispatch();var styles=makeStyles(sizeLabor,themeLabor);useFirestoreConnect([{collection:'chatMessages',orderBy:['createdAt','desc'],where:[['conversationId','==',conversationId]]}]);var chatMessages=useSelector(function(state){return state.firestoreState.ordered.chatMessages;});useEffect(function(){return function(){firestore.get({collection:'chatMessages',limit:0}).then();};},[]);var chatMessagesAdapted=chatMessages==null?void 0:chatMessages.map(function(serverItem){return _objectSpread(_objectSpread({},serverItem),{},{createdAt:firestoreTimestampToDate(serverItem.createdAt)});});var memoizedUser=useMemo(function(){if(!user){return{_id:'defaultId',avatar:'',name:'defaultName'};}var firebaseUser=user.firebaseUser,storedUser=user.storedUser;if(firebaseUser){return{_id:firebaseUser.uid||'defaultId',avatar:(storedUser==null?void 0:storedUser.photoURL)||'',name:firebaseUser.displayName||'defaultName'};}},[user]);var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isShowAudioButton=_useState2[0],setIsShowAudioButton=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isShowStickerPicker=_useState4[0],setIsShowStickerPicker=_useState4[1];var chatAssetsPath=\"/chatAssets/\"+(memoizedUser==null?void 0:memoizedUser._id);var generateMessage=function generateMessage(type,payload,needMerge){var text='',image='',audio='',video='',sticker='';switch(type){case'IMAGE':image=payload||'';break;case'AUDIO':audio=payload||'';break;case'STICKER_GIF':sticker=payload||'';break;case'MESSAGE':text=payload||'';break;case'VIDEO':video=payload||'';break;default:break;}return _objectSpread({_id:uuidV4(),createdAt:firestore.FieldValue.serverTimestamp(),conversationId:conversationId,type:type,user:memoizedUser,text:text,image:image,sticker:sticker,audio:audio,video:video,received:false,pending:true,sent:false},needMerge);};var handleSend=useCallback(function _callee(){var messages,msg,_args=arguments;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:messages=_args.length>0&&_args[0]!==undefined?_args[0]:[];msg=generateMessage('MESSAGE',messages[0].text);_context.next=4;return _regeneratorRuntime.awrap(storeMessage(msg));case 4:case\"end\":return _context.stop();}}},null,null,null,Promise);},[]);var storeMessage=function storeMessage(msg){return _regeneratorRuntime.async(function storeMessage$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(firestore.set(\"chatMessages/\"+msg._id,msg));case 2:_context2.next=4;return _regeneratorRuntime.awrap(setSent(msg));case 4:case\"end\":return _context2.stop();}}},null,null,null,Promise);};var setSent=function setSent(msg){return _regeneratorRuntime.async(function setSent$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(firestore.update(\"chatMessages/\"+msg._id,{sent:true,pending:false}));case 2:case\"end\":return _context3.stop();}}},null,null,null,Promise);};var setReceived=function setReceived(msg){return _regeneratorRuntime.async(function setReceived$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!((memoizedUser&&memoizedUser._id)!==(msg==null?void 0:msg.user._id))){_context4.next=3;break;}_context4.next=3;return _regeneratorRuntime.awrap(firestore.update(\"chatMessages/\"+msg._id,{received:true}));case 3:case\"end\":return _context4.stop();}}},null,null,null,Promise);};return React.createElement(SafeAreaView,{style:{flex:1},__self:this,__source:{fileName:_jsxFileName,lineNumber:148,columnNumber:9}},isLoaded(chatMessages)?React.createElement(React.Fragment,null,React.createElement(BunnyChat,{isDebug:false,alwaysShowSend:true,inverted:true,messages:chatMessagesAdapted,onSend:function _callee2(messages){return _regeneratorRuntime.async(function _callee2$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log('onSend',messages);_context5.next=3;return _regeneratorRuntime.awrap(handleSend(messages));case 3:case\"end\":return _context5.stop();}}},null,null,null,Promise);},user:memoizedUser,textInputProps:{onFocus:function onFocus(){setIsShowStickerPicker(false);}},onInputTextChanged:function onInputTextChanged(text){setIsShowAudioButton(!text);},onMessageReadyForDisplay:function _callee3(currentMessage){return _regeneratorRuntime.async(function _callee3$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return _regeneratorRuntime.awrap(setReceived(currentMessage));case 2:case\"end\":return _context6.stop();}}},null,null,null,Promise);},onMessageLoadError:function onMessageLoadError(e,currentMessage){dispatch(collectSysError(e));},renderActions:function renderActions(){return React.createElement(React.Fragment,null,React.createElement(TouchableOpacity,{onPress:function onPress(){Keyboard.dismiss();setIsShowStickerPicker(!isShowStickerPicker);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:203,columnNumber:33}},React.createElement(IcoMoon,{name:\"chat4\",style:styles.stickerPickerIcon,__self:_this,__source:{fileName:_jsxFileName,lineNumber:208,columnNumber:37}})),React.createElement(ImageUploader,{isDeleteFromServerWhenUpload:false,path:chatAssetsPath,renderPreview:function renderPreview(_ref2){var toggleModal=_ref2.toggleModal;return React.createElement(TouchableOpacity,{onPress:function onPress(){toggleModal();},__self:_this,__source:{fileName:_jsxFileName,lineNumber:214,columnNumber:48}},React.createElement(IcoMoon,{name:\"paperclip\",size:wp(16),style:styles.mediaLibraryPickerIcon,__self:_this,__source:{fileName:_jsxFileName,lineNumber:218,columnNumber:45}}));},onUploaded:function _callee4(imageSource,type){var mediaType,msg;return _regeneratorRuntime.async(function _callee4$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:mediaType='';_context7.t0=type;_context7.next=_context7.t0==='image'?4:_context7.t0==='video'?6:8;break;case 4:mediaType='IMAGE';return _context7.abrupt(\"break\",8);case 6:mediaType='VIDEO';return _context7.abrupt(\"break\",8);case 8:msg=generateMessage(mediaType,imageSource.uri);_context7.next=11;return _regeneratorRuntime.awrap(storeMessage(msg));case 11:case\"end\":return _context7.stop();}}},null,null,null,Promise);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:210,columnNumber:33}}));},renderSend:function renderSend(props){var text=props.text,onSend=props.onSend;return React.createElement(React.Fragment,null,isShowAudioButton?React.createElement(AudioRecorder,{isUpload:true,uploadPath:chatAssetsPath,onValueChanged:function _callee5(uri){var messageNeedSent;return _regeneratorRuntime.async(function _callee5$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:messageNeedSent=generateMessage('AUDIO',uri);_context8.next=3;return _regeneratorRuntime.awrap(storeMessage(messageNeedSent));case 3:case\"end\":return _context8.stop();}}},null,null,null,Promise);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:242,columnNumber:43}}):React.createElement(TouchableOpacity,{onPress:function onPress(){if(text&&onSend&&memoizedUser){onSend(generateMessage('MESSAGE',text),true);}},__self:_this,__source:{fileName:_jsxFileName,lineNumber:248,columnNumber:43}},React.createElement(IcoMoon,{name:\"paperplane1\",style:styles.sendIcon,__self:_this,__source:{fileName:_jsxFileName,lineNumber:254,columnNumber:45}})));},__self:this,__source:{fileName:_jsxFileName,lineNumber:151,columnNumber:21}}),React.createElement(StickerPicker,{isShow:isShowStickerPicker,onValueChanged:function _callee6(uri){var msg;return _regeneratorRuntime.async(function _callee6$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:msg=generateMessage('STICKER_GIF',uri);_context9.next=3;return _regeneratorRuntime.awrap(storeMessage(msg));case 3:case\"end\":return _context9.stop();}}},null,null,null,Promise);},__self:this,__source:{fileName:_jsxFileName,lineNumber:262,columnNumber:21}})):React.createElement(Preparing,{__self:this,__source:{fileName:_jsxFileName,lineNumber:270,columnNumber:19}}));}_s(ChatRoomScreen,\"AjW7Wp4H7NNtmIcShhqedHeOQlM=\",false,function(){return[useFirestore,useBunnyKit,useDispatch,useFirestoreConnect,useSelector];});_c=ChatRoomScreen;var _c;$RefreshReg$(_c,\"ChatRoomScreen\");","map":{"version":3,"sources":["/Users/revone/projects/expo-react-bunny/src/screens/DemoChat/ChatRoom/ChatRoom.tsx"],"names":["route","navigation","conversationId","firestore","useFirestore","sizeLabor","themeLabor","authLabor","wp","useBunnyKit","authResult","user","dispatch","useDispatch","styles","makeStyles","useFirestoreConnect","collection","orderBy","where","chatMessages","useSelector","state","useEffect","limit","chatMessagesAdapted","createdAt","firestoreTimestampToDate","serverItem","memoizedUser","useMemo","_id","avatar","name","firebaseUser","storedUser","isShowAudioButton","setIsShowAudioButton","useState","isShowStickerPicker","setIsShowStickerPicker","chatAssetsPath","generateMessage","text","image","audio","video","sticker","payload","uuidV4","type","received","pending","sent","handleSend","useCallback","messages","msg","storeMessage","setSent","setReceived","flex","isLoaded","console","onFocus","collectSysError","Keyboard","toggleModal","mediaType","imageSource","onSend","props","messageNeedSent"],"mappings":"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","sourcesContent":["import React, {useCallback, useEffect, useMemo, useState} from 'react';\nimport {AudioRecorder, BunnyChat, ImageUploader, Preparing, StickerPicker} from '../../../components';\nimport {RouteProp} from '@react-navigation/native';\nimport {DemoChatStackParam, IMMessage, IMMessageType, RootState} from '../../../types';\nimport {StackNavigationProp} from '@react-navigation/stack';\nimport {useDispatch, useSelector} from 'react-redux';\nimport {isLoaded, useFirestore, useFirestoreConnect} from 'react-redux-firebase';\nimport {firestoreTimestampToDate, uuidV4} from '../../../utils';\nimport {Keyboard, SafeAreaView, TouchableOpacity} from 'react-native';\nimport {IcoMoon} from '../../../components/UI';\nimport {makeStyles} from './styles';\nimport {useBunnyKit} from '../../../hooks/bunny-kit';\nimport {collectSysError} from '../../../store/actions';\n\ntype ChatRoomRouteProp = RouteProp<DemoChatStackParam, 'ChatRoom'>;\ntype ChatRoomNavigationProp = StackNavigationProp<DemoChatStackParam, 'ChatRoom'>;\n\nexport interface ChatRoomProps {\n    route: ChatRoomRouteProp,\n    navigation: ChatRoomNavigationProp\n}\n\nexport function ChatRoomScreen({route, navigation}: ChatRoomProps) {\n    const {conversationId} = route.params;\n    const firestore = useFirestore();\n    const {sizeLabor, themeLabor, authLabor, wp} = useBunnyKit();\n    const {authResult} = authLabor;\n    const {user} = authResult;\n    const dispatch = useDispatch();\n\n    const styles = makeStyles(sizeLabor, themeLabor);\n\n    useFirestoreConnect([\n        {\n            collection: 'chatMessages',\n            orderBy: ['createdAt', 'desc'],\n            where: [\n                ['conversationId', '==', conversationId]\n            ],\n        }\n    ]);\n\n    const chatMessages = useSelector((state: RootState) => state.firestoreState.ordered.chatMessages);\n\n    // const [chatMessagesAdapted,setChatMessagesAdapted] = useState<IMMessage[]>([])\n    //\n    // useEffect(() => {\n    //     const xxx = chatMessages?.map((serverItem) => {\n    //         return {...serverItem, createdAt: firestoreTimestampToDate(serverItem.createdAt)}\n    //     })\n    //     setChatMessagesAdapted(xxx)\n    // }, [chatMessages])\n\n    useEffect(() => {\n        return () => {\n            firestore.get({\n                collection: 'chatMessages',\n                limit: 0,\n            }).then();\n            // dispatch({ type: actionTypes.CLEAR_DATA, meta: { collection: 'chatMessages' } })\n        };\n    }, []);\n\n    let chatMessagesAdapted = chatMessages?.map((serverItem) => {\n        return {...serverItem, createdAt: firestoreTimestampToDate(serverItem.createdAt)};\n    });\n\n    const memoizedUser = useMemo(() => {\n        if (!user) {\n            return {_id: 'defaultId', avatar: '', name: 'defaultName'};\n        }\n        const {firebaseUser, storedUser} = user;\n        if (firebaseUser) {\n            return {\n                _id: firebaseUser.uid || 'defaultId',\n                avatar: storedUser?.photoURL || '',\n                name: firebaseUser.displayName || 'defaultName'\n            };\n        }\n    }, [user]);\n\n\n    const [isShowAudioButton, setIsShowAudioButton] = useState(true);\n    const [isShowStickerPicker, setIsShowStickerPicker] = useState(false);\n\n    const chatAssetsPath = `/chatAssets/${memoizedUser?._id}`;\n\n    const generateMessage = (type: IMMessageType, payload?: string, needMerge?: Partial<IMMessage>) => {\n        let text = '', image = '', audio = '', video = '', sticker = '';\n        switch (type) {\n            case 'IMAGE':\n                image = payload || '';\n                break;\n            case 'AUDIO':\n                audio = payload || '';\n                break;\n            case 'STICKER_GIF':\n                sticker = payload || '';\n                break;\n            case 'MESSAGE':\n                text = payload || '';\n                break;\n            case 'VIDEO':\n                video = payload || '';\n                break;\n            default:\n                break;\n        }\n        return {\n            _id: uuidV4(),\n            createdAt: firestore.FieldValue.serverTimestamp(),\n            conversationId,\n            type: type,\n            user: memoizedUser,\n            text,\n            image,\n            sticker,\n            audio,\n            video,\n            received: false,\n            pending: true,\n            sent: false,\n            ...needMerge,\n        } as IMMessage;\n    };\n\n    const handleSend = useCallback(async (messages = []) => {\n        const msg = generateMessage('MESSAGE', messages[0].text);\n        await storeMessage(msg);\n    }, []);\n\n    const storeMessage = async (msg: IMMessage) => {\n        await firestore.set(`chatMessages/${msg._id}`, msg);\n        await setSent(msg);\n    };\n\n    const setSent = async (msg: IMMessage) => {\n        await firestore.update(`chatMessages/${msg._id}`, {sent: true, pending: false});\n    };\n\n    const setReceived = async (msg: IMMessage) => {\n        if ((memoizedUser && memoizedUser._id) !== msg?.user._id) {\n            await firestore.update(`chatMessages/${msg._id}`, {received: true});\n        }\n    };\n\n    return (\n        <SafeAreaView style={{flex: 1}}>\n            {isLoaded(chatMessages)\n                ? <>\n                    <BunnyChat<IMMessage>\n                        // actionsConfig={{\n                        //     'PickImage': function () {\n                        //         console.log(arguments)\n                        //     },\n                        //     'Cancel': function () {\n                        //         console.log(arguments)\n                        //     }\n                        // }}\n                        // minComposerHeight={100}\n                        // keyboardShouldPersistTaps\n                        isDebug={false}\n                        alwaysShowSend\n                        // TODO Suspected to be a react-native-gifted-chat bug,default value is true.\n                        inverted={true}\n                        // showUserAvatar\n                        // showAvatarForEveryMessage\n                        messages={chatMessagesAdapted}\n                        onSend={async (messages) => {\n                            console.log('onSend', messages);\n                            await handleSend(messages);\n                        }}\n\n                        user={memoizedUser}\n\n                        textInputProps={{\n                            onFocus: () => {\n                                setIsShowStickerPicker(false);\n                            }\n                        }}\n\n                        onInputTextChanged={(text) => {\n                            setIsShowAudioButton(!text);\n                        }}\n\n                        onMessageReadyForDisplay={async (currentMessage: IMMessage) => {\n                            await setReceived(currentMessage);\n                        }}\n\n                        onMessageLoadError={(e, currentMessage) => {\n                            dispatch(collectSysError(e));\n                        }}\n                        // actionSheet={() => {\n                        //     return {\n                        //         showActionSheetWithOptions: (options, callback) => {\n                        //             console.log(options, callback)\n                        //             callback(0)\n                        //         }\n                        //     }\n                        // }}\n                        renderActions={() => {\n                            return <>\n                                <TouchableOpacity onPress={() => {\n                                    Keyboard.dismiss();\n                                    // TODO issue when this triggered firebase writes channel and rerenders all\n                                    setIsShowStickerPicker(!isShowStickerPicker);\n                                }}>\n                                    <IcoMoon name=\"chat4\" style={styles.stickerPickerIcon}/>\n                                </TouchableOpacity>\n                                <ImageUploader\n                                    isDeleteFromServerWhenUpload={false}\n                                    path={chatAssetsPath}\n                                    renderPreview={({toggleModal}) => {\n                                        return <TouchableOpacity\n                                            onPress={() => {\n                                                toggleModal();\n                                            }}>\n                                            <IcoMoon name=\"paperclip\" size={wp(16)}\n                                                     style={styles.mediaLibraryPickerIcon}/>\n                                        </TouchableOpacity>;\n                                    }}\n                                    onUploaded={async (imageSource, type) => {\n                                        let mediaType: IMMessageType = '';\n                                        switch (type) {\n                                            case 'image':\n                                                mediaType = 'IMAGE';\n                                                break;\n                                            case 'video':\n                                                mediaType = 'VIDEO';\n                                                break;\n                                        }\n                                        const msg = generateMessage(mediaType, imageSource.uri);\n                                        await storeMessage(msg);\n                                    }}\n                                />\n                            </>;\n                        }}\n                        renderSend={(props) => {\n                            const {text, onSend} = props;\n                            return (<>\n                                    {isShowAudioButton\n                                        ? <AudioRecorder isUpload\n                                                         uploadPath={chatAssetsPath}\n                                                         onValueChanged={async (uri) => {\n                                                             const messageNeedSent = generateMessage('AUDIO', uri);\n                                                             await storeMessage(messageNeedSent);\n                                                         }}/>\n                                        : <TouchableOpacity onPress={() => {\n                                            if (text && onSend && memoizedUser) {\n                                                onSend(generateMessage('MESSAGE',\n                                                    text), true);\n                                            }\n                                        }}>\n                                            <IcoMoon name=\"paperplane1\" style={styles.sendIcon}/>\n                                        </TouchableOpacity>\n                                    }\n\n                                </>\n                            );\n                        }}\n                    />\n                    <StickerPicker\n                        isShow={isShowStickerPicker}\n                        onValueChanged={async (uri) => {\n                            const msg = generateMessage('STICKER_GIF', uri);\n                            await storeMessage(msg);\n                            // setIsShowStickerPicker(false);\n                        }}/>\n                </>\n                : <Preparing/>\n            }\n\n        </SafeAreaView>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}