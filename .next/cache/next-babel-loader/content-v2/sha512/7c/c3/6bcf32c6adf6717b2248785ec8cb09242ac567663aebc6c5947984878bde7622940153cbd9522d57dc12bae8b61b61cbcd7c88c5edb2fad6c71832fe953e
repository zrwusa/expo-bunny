{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{EventEmitter,Platform}from'@unimodules/core';import{PermissionStatus}from'unimodules-permissions-interface';import{_DEFAULT_PROGRESS_UPDATE_INTERVAL_MILLIS}from\"../AV\";import ExponentAV from\"../ExponentAV\";import{isAudioEnabled,throwIfAudioIsDisabled}from\"./AudioAvailability\";import{Sound}from\"./Sound\";export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_DEFAULT=0;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_THREE_GPP=1;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_MPEG_4=2;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_AMR_NB=3;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_AMR_WB=4;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_AAC_ADIF=5;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_AAC_ADTS=6;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_RTP_AVP=7;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_MPEG2TS=8;export var RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_WEBM=9;export var RECORDING_OPTION_ANDROID_AUDIO_ENCODER_DEFAULT=0;export var RECORDING_OPTION_ANDROID_AUDIO_ENCODER_AMR_NB=1;export var RECORDING_OPTION_ANDROID_AUDIO_ENCODER_AMR_WB=2;export var RECORDING_OPTION_ANDROID_AUDIO_ENCODER_AAC=3;export var RECORDING_OPTION_ANDROID_AUDIO_ENCODER_HE_AAC=4;export var RECORDING_OPTION_ANDROID_AUDIO_ENCODER_AAC_ELD=5;export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_LINEARPCM='lpcm';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_AC3='ac-3';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_60958AC3='cac3';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_APPLEIMA4='ima4';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4AAC='aac ';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4CELP='celp';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4HVXC='hvxc';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4TWINVQ='twvq';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MACE3='MAC3';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MACE6='MAC6';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_ULAW='ulaw';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_ALAW='alaw';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_QDESIGN='QDMC';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_QDESIGN2='QDM2';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_QUALCOMM='Qclp';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEGLAYER1='.mp1';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEGLAYER2='.mp2';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEGLAYER3='.mp3';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_APPLELOSSLESS='alac';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4AAC_HE='aach';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4AAC_LD='aacl';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4AAC_ELD='aace';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4AAC_ELD_SBR='aacf';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4AAC_ELD_V2='aacg';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4AAC_HE_V2='aacp';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MPEG4AAC_SPATIAL='aacs';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_AMR='samr';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_AMR_WB='sawb';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_AUDIBLE='AUDB';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_ILBC='ilbc';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_DVIINTELIMA=0x6d730011;export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_MICROSOFTGSM=0x6d730031;export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_AES3='aes3';export var RECORDING_OPTION_IOS_OUTPUT_FORMAT_ENHANCEDAC3='ec-3';export var RECORDING_OPTION_IOS_AUDIO_QUALITY_MIN=0;export var RECORDING_OPTION_IOS_AUDIO_QUALITY_LOW=0x20;export var RECORDING_OPTION_IOS_AUDIO_QUALITY_MEDIUM=0x40;export var RECORDING_OPTION_IOS_AUDIO_QUALITY_HIGH=0x60;export var RECORDING_OPTION_IOS_AUDIO_QUALITY_MAX=0x7f;export var RECORDING_OPTION_IOS_BIT_RATE_STRATEGY_CONSTANT=0;export var RECORDING_OPTION_IOS_BIT_RATE_STRATEGY_LONG_TERM_AVERAGE=1;export var RECORDING_OPTION_IOS_BIT_RATE_STRATEGY_VARIABLE_CONSTRAINED=2;export var RECORDING_OPTION_IOS_BIT_RATE_STRATEGY_VARIABLE=3;var getWebMediaRecorderSupportedMime=function getWebMediaRecorderSupportedMime(isHighQuality){if(Platform.OS!=='web'){return;}if(!window.MediaRecorder){return;}var mimes=[{highQuality:{mimeType:'audio/mp4;codecs=\"mp4a.40.5\"',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.m4a'},lowQuality:{mimeType:'audio/mp4;codecs=\"mp4a.40.5\"',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.m4a'}},{highQuality:{mimeType:'audio/mp4;codecs=\"mp4a.40.2\"',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.m4a'},lowQuality:{mimeType:'audio/mp4;codecs=\"mp4a.40.2\"',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.m4a'}},{highQuality:{mimeType:'audio/mpeg',audioBitsPerSecond:128000,bitsPerSecond:128000,extension:'.mp3'},lowQuality:{mimeType:'audio/mpeg',audioBitsPerSecond:128000,bitsPerSecond:128000,extension:'.mp3'}},{highQuality:{mimeType:'audio/webm;codecs=\"opus\"',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.webm'},lowQuality:{mimeType:'audio/webm;codecs=\"opus\"',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.webm'}},{highQuality:{mimeType:'audio/webm;codecs=\"vp8\"',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.webm'},lowQuality:{mimeType:'audio/webm;codecs=\"vp8\"',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.webm'}},{highQuality:{mimeType:'audio/webm',audioBitsPerSecond:1000,bitsPerSecond:1000,extension:'.webm'},lowQuality:{mimeType:'audio/webm',audioBitsPerSecond:64000,bitsPerSecond:64000,extension:'.webm'}}];for(var index=0;index<mimes.length;index++){var mime=mimes[index];var quality=isHighQuality?'highQuality':'lowQuality';var curMime=mime[quality];if(curMime){if(window.MediaRecorder.isTypeSupported(curMime.mimeType)){return curMime;}}}};export var RECORDING_OPTIONS_PRESET_HIGH_QUALITY={isMeteringEnabled:true,android:{extension:'.m4a',outputFormat:RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_MPEG_4,audioEncoder:RECORDING_OPTION_ANDROID_AUDIO_ENCODER_AAC,sampleRate:44100,numberOfChannels:2,bitRate:128000},ios:{extension:'.wav',audioQuality:RECORDING_OPTION_IOS_AUDIO_QUALITY_MAX,sampleRate:44100,numberOfChannels:2,bitRate:128000,linearPCMBitDepth:16,linearPCMIsBigEndian:false,linearPCMIsFloat:false},web:getWebMediaRecorderSupportedMime(true)};export var RECORDING_OPTIONS_PRESET_LOW_QUALITY={isMeteringEnabled:true,android:{extension:'.3gp',outputFormat:RECORDING_OPTION_ANDROID_OUTPUT_FORMAT_THREE_GPP,audioEncoder:RECORDING_OPTION_ANDROID_AUDIO_ENCODER_AMR_NB,sampleRate:44100,numberOfChannels:2,bitRate:128000},ios:{extension:'.wav',audioQuality:RECORDING_OPTION_IOS_AUDIO_QUALITY_MIN,sampleRate:44100,numberOfChannels:2,bitRate:128000,linearPCMBitDepth:16,linearPCMIsBigEndian:false,linearPCMIsFloat:false},web:getWebMediaRecorderSupportedMime(false)};export{PermissionStatus};var _recorderExists=false;var eventEmitter=Platform.OS==='android'?new EventEmitter(ExponentAV):null;export function getPermissionsAsync(){return _regeneratorRuntime.async(function getPermissionsAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",ExponentAV.getPermissionsAsync());case 1:case\"end\":return _context.stop();}}},null,null,null,Promise);}export function requestPermissionsAsync(){return _regeneratorRuntime.async(function requestPermissionsAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",ExponentAV.requestPermissionsAsync());case 1:case\"end\":return _context2.stop();}}},null,null,null,Promise);}export var Recording=function(){function Recording(){var _this=this;_classCallCheck(this,Recording);this._subscription=null;this._canRecord=false;this._isDoneRecording=false;this._finalDurationMillis=0;this._uri=null;this._onRecordingStatusUpdate=null;this._progressUpdateTimeoutVariable=null;this._progressUpdateIntervalMillis=_DEFAULT_PROGRESS_UPDATE_INTERVAL_MILLIS;this._options=null;this._cleanupForUnloadedRecorder=function _callee(finalStatus){var _finalStatus$duration;return _regeneratorRuntime.async(function _callee$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_this._canRecord=false;_this._isDoneRecording=true;_this._finalDurationMillis=(_finalStatus$duration=finalStatus==null?void 0:finalStatus.durationMillis)!=null?_finalStatus$duration:0;_recorderExists=false;if(_this._subscription){_this._subscription.remove();_this._subscription=null;}_this._disablePolling();_context3.next=8;return _regeneratorRuntime.awrap(_this.getStatusAsync());case 8:return _context3.abrupt(\"return\",_context3.sent);case 9:case\"end\":return _context3.stop();}}},null,null,null,Promise);};this._pollingLoop=function _callee2(){return _regeneratorRuntime.async(function _callee2$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(isAudioEnabled()&&_this._canRecord&&_this._onRecordingStatusUpdate!=null)){_context4.next=10;break;}_this._progressUpdateTimeoutVariable=setTimeout(_this._pollingLoop,_this._progressUpdateIntervalMillis);_context4.prev=2;_context4.next=5;return _regeneratorRuntime.awrap(_this.getStatusAsync());case 5:_context4.next=10;break;case 7:_context4.prev=7;_context4.t0=_context4[\"catch\"](2);_this._disablePolling();case 10:case\"end\":return _context4.stop();}}},null,null,[[2,7]],Promise);};this.getStatusAsync=function _callee3(){var status;return _regeneratorRuntime.async(function _callee3$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!_this._canRecord){_context5.next=2;break;}return _context5.abrupt(\"return\",_this._performOperationAndHandleStatusAsync(function(){return ExponentAV.getAudioRecordingStatus();}));case 2:status={canRecord:false,isRecording:false,isDoneRecording:_this._isDoneRecording,durationMillis:_this._finalDurationMillis};_this._callOnRecordingStatusUpdateForNewStatus(status);return _context5.abrupt(\"return\",status);case 5:case\"end\":return _context5.stop();}}},null,null,null,Promise);};}_createClass(Recording,[{key:\"_disablePolling\",value:function _disablePolling(){if(this._progressUpdateTimeoutVariable!=null){clearTimeout(this._progressUpdateTimeoutVariable);this._progressUpdateTimeoutVariable=null;}}},{key:\"_enablePollingIfNecessaryAndPossible\",value:function _enablePollingIfNecessaryAndPossible(){if(isAudioEnabled()&&this._canRecord&&this._onRecordingStatusUpdate!=null){this._disablePolling();this._pollingLoop();}}},{key:\"_callOnRecordingStatusUpdateForNewStatus\",value:function _callOnRecordingStatusUpdateForNewStatus(status){if(this._onRecordingStatusUpdate!=null){this._onRecordingStatusUpdate(status);}}},{key:\"_performOperationAndHandleStatusAsync\",value:function _performOperationAndHandleStatusAsync(operation){var _status;return _regeneratorRuntime.async(function _performOperationAndHandleStatusAsync$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:throwIfAudioIsDisabled();if(!this._canRecord){_context6.next=9;break;}_context6.next=4;return _regeneratorRuntime.awrap(operation());case 4:_status=_context6.sent;this._callOnRecordingStatusUpdateForNewStatus(_status);return _context6.abrupt(\"return\",_status);case 9:throw new Error('Cannot complete operation because this recorder is not ready to record.');case 10:case\"end\":return _context6.stop();}}},null,this,null,Promise);}},{key:\"setOnRecordingStatusUpdate\",value:function setOnRecordingStatusUpdate(onRecordingStatusUpdate){this._onRecordingStatusUpdate=onRecordingStatusUpdate;if(onRecordingStatusUpdate==null){this._disablePolling();}else{this._enablePollingIfNecessaryAndPossible();}this.getStatusAsync();}},{key:\"setProgressUpdateInterval\",value:function setProgressUpdateInterval(progressUpdateIntervalMillis){this._progressUpdateIntervalMillis=progressUpdateIntervalMillis;this.getStatusAsync();}},{key:\"prepareToRecordAsync\",value:function prepareToRecordAsync(){var options,extensionRegex,_await$ExponentAV$pre,uri,_status2,currentStatus,_args7=arguments;return _regeneratorRuntime.async(function prepareToRecordAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:options=_args7.length>0&&_args7[0]!==undefined?_args7[0]:RECORDING_OPTIONS_PRESET_LOW_QUALITY;throwIfAudioIsDisabled();if(!_recorderExists){_context7.next=4;break;}throw new Error('Only one Recording object can be prepared at a given time.');case 4:if(!this._isDoneRecording){_context7.next=6;break;}throw new Error('This Recording object is done recording; you must make a new one.');case 6:if(!(!options||!options.android||!options.ios)){_context7.next=8;break;}throw new Error('You must provide recording options for android and ios in order to prepare to record.');case 8:extensionRegex=/^\\.\\w+$/;if(!(!options.android.extension||!options.ios.extension||!extensionRegex.test(options.android.extension)||!extensionRegex.test(options.ios.extension))){_context7.next=11;break;}throw new Error(\"Your file extensions must match \"+extensionRegex.toString()+\".\");case 11:if(this._canRecord){_context7.next=28;break;}if(eventEmitter){this._subscription=eventEmitter.addListener('Expo.Recording.recorderUnloaded',this._cleanupForUnloadedRecorder);}_context7.next=15;return _regeneratorRuntime.awrap(ExponentAV.prepareAudioRecorder(options));case 15:_await$ExponentAV$pre=_context7.sent;uri=_await$ExponentAV$pre.uri;_status2=_await$ExponentAV$pre.status;_recorderExists=true;this._uri=uri;this._options=options;this._canRecord=true;currentStatus=_objectSpread(_objectSpread({},_status2),{},{canRecord:true});this._callOnRecordingStatusUpdateForNewStatus(currentStatus);this._enablePollingIfNecessaryAndPossible();return _context7.abrupt(\"return\",currentStatus);case 28:throw new Error('This Recording object is already prepared to record.');case 29:case\"end\":return _context7.stop();}}},null,this,null,Promise);}},{key:\"startAsync\",value:function startAsync(){return _regeneratorRuntime.async(function startAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:return _context8.abrupt(\"return\",this._performOperationAndHandleStatusAsync(function(){return ExponentAV.startAudioRecording();}));case 1:case\"end\":return _context8.stop();}}},null,this,null,Promise);}},{key:\"pauseAsync\",value:function pauseAsync(){return _regeneratorRuntime.async(function pauseAsync$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:return _context9.abrupt(\"return\",this._performOperationAndHandleStatusAsync(function(){return ExponentAV.pauseAudioRecording();}));case 1:case\"end\":return _context9.stop();}}},null,this,null,Promise);}},{key:\"stopAndUnloadAsync\",value:function stopAndUnloadAsync(){var stopResult,stopError,_ref,uri,_status3,status;return _regeneratorRuntime.async(function stopAndUnloadAsync$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:if(this._canRecord){_context10.next=6;break;}if(!this._isDoneRecording){_context10.next=5;break;}throw new Error('Cannot unload a Recording that has already been unloaded.');case 5:throw new Error('Cannot unload a Recording that has not been prepared.');case 6:_context10.prev=6;_context10.next=9;return _regeneratorRuntime.awrap(ExponentAV.stopAudioRecording());case 9:stopResult=_context10.sent;_context10.next=15;break;case 12:_context10.prev=12;_context10.t0=_context10[\"catch\"](6);stopError=_context10.t0;case 15:if(Platform.OS==='web'){_ref=stopResult,uri=_ref.uri,_status3=_ref.status;this._uri=uri;stopResult=_status3;}_context10.next=18;return _regeneratorRuntime.awrap(ExponentAV.unloadAudioRecorder());case 18:_context10.next=20;return _regeneratorRuntime.awrap(this._cleanupForUnloadedRecorder(stopResult));case 20:status=_context10.sent;return _context10.abrupt(\"return\",stopError?Promise.reject(stopError):status);case 22:case\"end\":return _context10.stop();}}},null,this,[[6,12]],Promise);}},{key:\"getURI\",value:function getURI(){return this._uri;}},{key:\"createNewLoadedSound\",value:function createNewLoadedSound(){var initialStatus,onPlaybackStatusUpdate,_args11=arguments;return _regeneratorRuntime.async(function createNewLoadedSound$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:initialStatus=_args11.length>0&&_args11[0]!==undefined?_args11[0]:{};onPlaybackStatusUpdate=_args11.length>1&&_args11[1]!==undefined?_args11[1]:null;console.warn(\"createNewLoadedSound is deprecated in favor of createNewLoadedSoundAsync, which has the same API aside from the method name\");return _context11.abrupt(\"return\",this.createNewLoadedSoundAsync(initialStatus,onPlaybackStatusUpdate));case 4:case\"end\":return _context11.stop();}}},null,this,null,Promise);}},{key:\"createNewLoadedSoundAsync\",value:function createNewLoadedSoundAsync(){var initialStatus,onPlaybackStatusUpdate,_args12=arguments;return _regeneratorRuntime.async(function createNewLoadedSoundAsync$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:initialStatus=_args12.length>0&&_args12[0]!==undefined?_args12[0]:{};onPlaybackStatusUpdate=_args12.length>1&&_args12[1]!==undefined?_args12[1]:null;if(!(this._uri==null||!this._isDoneRecording)){_context12.next=4;break;}throw new Error('Cannot create sound when the Recording has not finished!');case 4:return _context12.abrupt(\"return\",Sound.createAsync({uri:this._uri},initialStatus,onPlaybackStatusUpdate,false));case 5:case\"end\":return _context12.stop();}}},null,this,null,Promise);}}]);return Recording;}();Recording.createAsync=function _callee4(){var options,onRecordingStatusUpdate,progressUpdateIntervalMillis,recording,_status4,_args13=arguments;return _regeneratorRuntime.async(function _callee4$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:options=_args13.length>0&&_args13[0]!==undefined?_args13[0]:RECORDING_OPTIONS_PRESET_LOW_QUALITY;onRecordingStatusUpdate=_args13.length>1&&_args13[1]!==undefined?_args13[1]:null;progressUpdateIntervalMillis=_args13.length>2&&_args13[2]!==undefined?_args13[2]:null;recording=new Recording();if(progressUpdateIntervalMillis){recording._progressUpdateIntervalMillis=progressUpdateIntervalMillis;}recording.setOnRecordingStatusUpdate(onRecordingStatusUpdate);_context13.next=8;return _regeneratorRuntime.awrap(recording.prepareToRecordAsync(_objectSpread(_objectSpread({},options),{},{keepAudioActiveHint:true})));case 8:_context13.prev=8;_context13.next=11;return _regeneratorRuntime.awrap(recording.startAsync());case 11:_status4=_context13.sent;return _context13.abrupt(\"return\",{recording:recording,status:_status4});case 15:_context13.prev=15;_context13.t0=_context13[\"catch\"](8);recording.stopAndUnloadAsync();throw _context13.t0;case 19:case\"end\":return _context13.stop();}}},null,null,[[8,15]],Promise);};","map":null,"metadata":{},"sourceType":"module"}