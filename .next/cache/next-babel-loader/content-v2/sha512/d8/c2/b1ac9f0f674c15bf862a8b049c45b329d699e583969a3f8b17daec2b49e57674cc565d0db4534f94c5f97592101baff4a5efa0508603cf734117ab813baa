{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";var _jsxFileName=\"/Users/revone/projects/expo-react-bunny/src/components/AudioPlayer/AudioPlayer.tsx\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import React,{useEffect,useRef,useState}from'react';import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import View from\"react-native-web/dist/exports/View\";import{makeStyles}from\"./styles\";import{IcoMoon,Text}from\"../UI\";import{Audio}from\"../../../packages/expo-av/src\";import{ProgressBar}from'react-native-paper';import{minuted}from\"../../utils\";import{useBunnyKit}from\"../../hooks/bunny-kit\";export function AudioPlayer(props){var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,colors=_useBunnyKit.colors;var styles=makeStyles(sizeLabor,themeLabor);var source=props.source,style=props.style,onLoad=props.onLoad,onLoadStart=props.onLoadStart,onLoadEnd=props.onLoadEnd,onError=props.onError,_props$isDebug=props.isDebug,isDebug=_props$isDebug===void 0?false:_props$isDebug,progressStyle=props.progressStyle,progressColor=props.progressColor,playButtonStyle=props.playButtonStyle,remainTimeStyle=props.remainTimeStyle,playButtonIconStyle=props.playButtonIconStyle;var soundRef=useRef();var _useState=useState({isLoaded:false}),_useState2=_slicedToArray(_useState,2),status=_useState2[0],setStatus=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];useEffect(function(){(function _callee(){var _await$Audio$Sound$cr,sound;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(source){_context.next=3;break;}return _context.abrupt(\"return\");case 3:onLoadStart==null?void 0:onLoadStart();_context.next=6;return _regeneratorRuntime.awrap(Audio.Sound.createAsync(source));case 6:_await$Audio$Sound$cr=_context.sent;sound=_await$Audio$Sound$cr.sound;if(status!=null&&status.isLoaded){onLoad==null?void 0:onLoad();}soundRef.current=sound;soundRef.current.setOnPlaybackStatusUpdate(setStatus);onLoadEnd==null?void 0:onLoadEnd();_context.next=20;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);isDebug&&console.log(_context.t0.toString());setError(_context.t0.toString());onError==null?void 0:onError(_context.t0);onLoadEnd==null?void 0:onLoadEnd();case 20:case\"end\":return _context.stop();}}},null,null,[[0,14]],Promise);})();return function(){(function _callee2(){var curSoundRef;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:curSoundRef=soundRef.current;if(!curSoundRef){_context2.next=5;break;}curSoundRef.setOnPlaybackStatusUpdate(null);_context2.next=5;return _regeneratorRuntime.awrap(curSoundRef.unloadAsync());case 5:case\"end\":return _context2.stop();}}},null,null,null,Promise);})();};},[]);function togglePlayOrPause(){var curSoundRef;return _regeneratorRuntime.async(function togglePlayOrPause$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(soundRef.current){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2:if(!(status&&status.isLoaded)){_context3.next=17;break;}curSoundRef=soundRef.current;if(!curSoundRef){_context3.next=17;break;}if(!status.isPlaying){_context3.next=10;break;}_context3.next=8;return _regeneratorRuntime.awrap(curSoundRef.pauseAsync());case 8:_context3.next=17;break;case 10:if(!(status.positionMillis===status.durationMillis)){_context3.next=15;break;}_context3.next=13;return _regeneratorRuntime.awrap(curSoundRef.replayAsync());case 13:_context3.next=17;break;case 15:_context3.next=17;return _regeneratorRuntime.awrap(curSoundRef.playAsync());case 17:case\"end\":return _context3.stop();}}},null,null,null,Promise);}return React.createElement(View,{style:[styles.container,style],__self:this,__source:{fileName:_jsxFileName,lineNumber:102,columnNumber:12}},isDebug?React.createElement(React.Fragment,null,React.createElement(Text,{__self:this,__source:{fileName:_jsxFileName,lineNumber:105,columnNumber:17}},\"error:\",error),React.createElement(Text,{__self:this,__source:{fileName:_jsxFileName,lineNumber:106,columnNumber:17}},\"status:\",JSON.stringify(status))):null,React.createElement(TouchableOpacity,{onPress:function _callee3(){return _regeneratorRuntime.async(function _callee3$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(togglePlayOrPause());case 2:case\"end\":return _context4.stop();}}},null,null,null,Promise);},__self:this,__source:{fileName:_jsxFileName,lineNumber:111,columnNumber:13}},React.createElement(View,{style:styles.control,__self:this,__source:{fileName:_jsxFileName,lineNumber:114,columnNumber:17}},React.createElement(View,{style:[styles.playButton,playButtonStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:115,columnNumber:21}},status!=null&&status.isLoaded?status.isPlaying?React.createElement(IcoMoon,{style:[styles.playButtonIcon,playButtonIconStyle],name:\"pause\",__self:this,__source:{fileName:_jsxFileName,lineNumber:120,columnNumber:39}}):React.createElement(IcoMoon,{style:[styles.playButtonIcon,playButtonIconStyle],name:\"play\",__self:this,__source:{fileName:_jsxFileName,lineNumber:122,columnNumber:39}}):React.createElement(ActivityIndicator,{__self:this,__source:{fileName:_jsxFileName,lineNumber:124,columnNumber:35}})),React.createElement(View,{style:styles.progress,__self:this,__source:{fileName:_jsxFileName,lineNumber:127,columnNumber:21}},status!=null&&status.isLoaded?status.durationMillis?React.createElement(React.Fragment,null,React.createElement(ProgressBar,{style:progressStyle,color:progressColor,progress:(status.positionMillis|0)/status.durationMillis,__self:this,__source:{fileName:_jsxFileName,lineNumber:133,columnNumber:41}}),React.createElement(Text,{style:[styles.remainTime,remainTimeStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:135,columnNumber:41}},minuted(status.durationMillis-status.positionMillis))):React.createElement(React.Fragment,null,React.createElement(ProgressBar,{progress:0,color:progressColor,style:progressStyle,__self:this,__source:{fileName:_jsxFileName,lineNumber:139,columnNumber:41}}),React.createElement(Text,{style:[styles.remainTime,remainTimeStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:140,columnNumber:41}},\" \")):React.createElement(ActivityIndicator,{color:progressColor,__self:this,__source:{fileName:_jsxFileName,lineNumber:142,columnNumber:35}})))));}","map":{"version":3,"sources":["/Users/revone/projects/expo-react-bunny/src/components/AudioPlayer/AudioPlayer.tsx"],"names":["sizeLabor","themeLabor","colors","useBunnyKit","styles","makeStyles","source","style","onLoad","onLoadStart","onLoadEnd","onError","isDebug","progressStyle","progressColor","playButtonStyle","remainTimeStyle","playButtonIconStyle","props","soundRef","useRef","status","setStatus","useState","isLoaded","error","setError","useEffect","sound","Audio","console","curSoundRef","JSON","togglePlayOrPause","minuted"],"mappings":"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","sourcesContent":["import React, {useEffect, useRef, useState} from 'react';\nimport {ActivityIndicator, StyleProp, TextStyle, TouchableOpacity, View, ViewStyle} from 'react-native';\nimport {makeStyles} from './styles';\nimport {IcoMoon, Text} from '../UI';\nimport {AVPlaybackSource, AVPlaybackStatus} from '../../../packages/expo-av/src/AV';\nimport {Audio} from '../../../packages/expo-av/src';\nimport {ProgressBar} from 'react-native-paper';\nimport {minuted} from '../../utils';\nimport {useBunnyKit} from '../../hooks/bunny-kit';\n\nexport interface AudioPlayerProps {\n    source: AVPlaybackSource,\n    style?: StyleProp<ViewStyle>,\n    playButtonStyle?: StyleProp<ViewStyle>,\n    playButtonIconStyle?: StyleProp<TextStyle>,\n    progressStyle?: StyleProp<ViewStyle>,\n    remainTimeStyle?: StyleProp<TextStyle>,\n    progressColor?: string,\n    onLoad?: () => void,\n    onLoadStart?: () => void,\n    onLoadEnd?: () => void,\n    onError?: (e: Error) => void,\n    isDebug?: boolean\n}\n\nexport function AudioPlayer(props: AudioPlayerProps) {\n    const {sizeLabor, themeLabor, colors} = useBunnyKit();\n    const styles = makeStyles(sizeLabor, themeLabor);\n    const {\n        source,\n        style,\n        onLoad,\n        onLoadStart,\n        onLoadEnd,\n        onError,\n        isDebug = false,\n        progressStyle,\n        progressColor,\n        playButtonStyle,\n        remainTimeStyle,\n        playButtonIconStyle\n    } = props;\n    const soundRef = useRef<Audio.Sound>();\n    const [status, setStatus] = useState<AVPlaybackStatus>({isLoaded: false});\n    const [error, setError] = useState('');\n    useEffect(() => {\n        (async () => {\n            try {\n                if (!source) {\n                    return;\n                }\n                onLoadStart?.();\n                const {sound} = await Audio.Sound.createAsync(source);\n                if (status?.isLoaded) {\n                    onLoad?.();\n                }\n                // todo on web platform status.durationMillis is NaN\n                soundRef.current = sound;\n                soundRef.current.setOnPlaybackStatusUpdate(setStatus);\n                onLoadEnd?.();\n            } catch (e: any) {\n                isDebug && console.log(e.toString());\n                setError(e.toString());\n                onError?.(e);\n                onLoadEnd?.();\n            }\n\n        })();\n\n        return () => {\n            (async () => {\n                const curSoundRef = soundRef.current;\n                if (curSoundRef) {\n                    curSoundRef.setOnPlaybackStatusUpdate(null);\n                    // await curSoundRef.stopAsync();\n                    await curSoundRef.unloadAsync();\n                }\n            })();\n        };\n    }, []);\n\n    async function togglePlayOrPause() {\n        if (!soundRef.current) {\n            return;\n        }\n        if (status && status.isLoaded) {\n            const curSoundRef = soundRef.current;\n            if (curSoundRef) {\n                if (status.isPlaying) {\n                    await curSoundRef.pauseAsync();\n                } else {\n                    if (status.positionMillis === status.durationMillis) {\n                        await curSoundRef.replayAsync();\n                    } else {\n                        await curSoundRef.playAsync();\n                    }\n                }\n            }\n        }\n    }\n\n    return <View style={[styles.container, style]}>\n        {isDebug\n            ? <>\n                <Text>error:{error}</Text>\n                <Text>status:{JSON.stringify(status)}</Text>\n            </>\n            : null\n        }\n        {\n            <TouchableOpacity onPress={async () => {\n                await togglePlayOrPause();\n            }}>\n                <View style={styles.control}>\n                    <View style={[styles.playButton, playButtonStyle]}>\n                        {\n                            status?.isLoaded\n                                ?\n                                status.isPlaying\n                                    ? <IcoMoon style={[styles.playButtonIcon, playButtonIconStyle]}\n                                               name=\"pause\"/>\n                                    : <IcoMoon style={[styles.playButtonIcon, playButtonIconStyle]}\n                                               name=\"play\"/>\n                                : <ActivityIndicator/>\n                        }\n                    </View>\n                    <View style={styles.progress}>\n                        {\n                            status?.isLoaded\n                                ?\n                                status.durationMillis\n                                    ? <>\n                                        <ProgressBar style={progressStyle} color={progressColor}\n                                                     progress={(status.positionMillis | 0) / status.durationMillis}/>\n                                        <Text style={[styles.remainTime, remainTimeStyle]}>\n                                            {minuted(status.durationMillis - status.positionMillis)}</Text>\n                                    </>\n                                    : <>\n                                        <ProgressBar progress={0} color={progressColor} style={progressStyle}/>\n                                        <Text style={[styles.remainTime, remainTimeStyle]}> </Text>\n                                    </>\n                                : <ActivityIndicator color={progressColor}/>\n                        }\n\n                    </View>\n                </View>\n            </TouchableOpacity>\n        }\n    </View>;\n}\n"]},"metadata":{},"sourceType":"module"}