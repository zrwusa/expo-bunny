{"ast":null,"code":"\"use strict\";var _interopRequireDefault2=require(\"@babel/runtime/helpers/interopRequireDefault\");var _extends2=_interopRequireDefault2(require(\"@babel/runtime/helpers/extends\"));var _toArray2=_interopRequireDefault2(require(\"@babel/runtime/helpers/toArray\"));exports.__esModule=true;exports.default=resolveRewrites;var _pathMatch=_interopRequireDefault(require(\"./path-match\"));var _prepareDestination=_interopRequireWildcard(require(\"./prepare-destination\"));var _normalizeTrailingSlash=require(\"../../../../client/normalize-trailing-slash\");var _normalizeLocalePath=require(\"../../i18n/normalize-locale-path\");var _parseRelativeUrl=require(\"./parse-relative-url\");var _router=require(\"../router\");function _getRequireWildcardCache(){if(typeof WeakMap!==\"function\")return null;var cache=new WeakMap();_getRequireWildcardCache=function _getRequireWildcardCache(){return cache;};return cache;}function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}if(obj===null||typeof obj!==\"object\"&&typeof obj!==\"function\"){return{default:obj};}var cache=_getRequireWildcardCache();if(cache&&cache.has(obj)){return cache.get(obj);}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc);}else{newObj[key]=obj[key];}}}newObj.default=obj;if(cache){cache.set(obj,newObj);}return newObj;}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var customRouteMatcher=(0,_pathMatch.default)(true);function resolveRewrites(asPath,pages,rewrites,query,resolveHref,locales){var matchedPage=false;var parsedAs=(0,_parseRelativeUrl.parseRelativeUrl)(asPath);var fsPathname=(0,_normalizeTrailingSlash.removePathTrailingSlash)((0,_normalizeLocalePath.normalizeLocalePath)((0,_router.delBasePath)(parsedAs.pathname),locales).pathname);var resolvedHref;var handleRewrite=function handleRewrite(rewrite){var matcher=customRouteMatcher(rewrite.source);var params=matcher(parsedAs.pathname);if(rewrite.has&&params){var hasParams=(0,_prepareDestination.matchHas)({headers:{host:document.location.hostname},cookies:document.cookie.split('; ').reduce(function(acc,item){var _item$split=item.split('='),_item$split2=(0,_toArray2.default)(_item$split),key=_item$split2[0],value=_item$split2.slice(1);acc[key]=value.join('=');return acc;},{})},rewrite.has,parsedAs.query);if(hasParams){(0,_extends2.default)(params,hasParams);}else{params=false;}}if(params){if(!rewrite.destination){return true;}var destRes=(0,_prepareDestination.default)(rewrite.destination,params,query,true);parsedAs=destRes.parsedDestination;asPath=destRes.newUrl;(0,_extends2.default)(query,destRes.parsedDestination.query);fsPathname=(0,_normalizeTrailingSlash.removePathTrailingSlash)((0,_normalizeLocalePath.normalizeLocalePath)((0,_router.delBasePath)(asPath),locales).pathname);if(pages.includes(fsPathname)){matchedPage=true;resolvedHref=fsPathname;return true;}resolvedHref=resolveHref(fsPathname);if(resolvedHref!==asPath&&pages.includes(resolvedHref)){matchedPage=true;return true;}}};var finished=false;for(var i=0;i<rewrites.beforeFiles.length;i++){handleRewrite(rewrites.beforeFiles[i]);}matchedPage=pages.includes(fsPathname);if(!matchedPage){if(!finished){for(var _i=0;_i<rewrites.afterFiles.length;_i++){if(handleRewrite(rewrites.afterFiles[_i])){finished=true;break;}}}if(!finished){resolvedHref=resolveHref(fsPathname);matchedPage=pages.includes(resolvedHref);finished=matchedPage;}if(!finished){for(var _i2=0;_i2<rewrites.fallback.length;_i2++){if(handleRewrite(rewrites.fallback[_i2])){finished=true;break;}}}}return{asPath:asPath,parsedAs:parsedAs,matchedPage:matchedPage,resolvedHref:resolvedHref};}","map":null,"metadata":{},"sourceType":"script"}