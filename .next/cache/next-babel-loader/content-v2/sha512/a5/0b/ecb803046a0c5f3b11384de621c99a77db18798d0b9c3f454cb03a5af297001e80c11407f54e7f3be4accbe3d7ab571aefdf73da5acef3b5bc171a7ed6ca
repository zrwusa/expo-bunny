{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import*as React from'react';import{useCallback,useEffect,useMemo,useState}from'react';import{AuthLaborContext,authLaborContext}from\"./AuthLaborContext\";import{Preparing}from\"../../components/Preparing\";import{useTranslation}from'react-i18next';import{shortenTFunctionKey}from\"../i18n-labor\";import{EventRegister}from'react-native-event-listeners';import{uuidV4}from\"../../utils\";export var AuthLaborProvider=function AuthLaborProvider(props){var children=props.children;var _useTranslation=useTranslation(),t=_useTranslation.t;var st=shortenTFunctionKey(t,'sys');var authFunctions=authLaborContext.authFunctions,authResult=authLaborContext.authResult;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isReady=_useState2[0],setIsReady=_useState2[1];var _useState3=useState(authResult),_useState4=_slicedToArray(_useState3,2),authResultState=_useState4[0],setAuthResultState=_useState4[1];var memoizedAuthResultState=useMemo(function(){return authResultState;},[JSON.stringify(authResultState)]);var handleLogin=useCallback(function(bizLogicResult){var success=bizLogicResult.success,data=bizLogicResult.data;if(success){var accessToken=data.accessToken,refreshToken=data.refreshToken,user=data.user;setAuthResultState({accessToken:accessToken,refreshToken:refreshToken,user:user,isLogin:true});}else{setAuthResultState({accessToken:'',refreshToken:'',user:undefined,isLogin:false});}},[]);var handleCheckIsLogin=useCallback(function(_ref){var data=_ref.data;setAuthResultState(function(preState){return _objectSpread(_objectSpread({},preState),{},{isLogin:data});});},[]);var handleAuthTrigger=useCallback(function(triggerType){setAuthResultState(function(preState){return _objectSpread(_objectSpread({},preState),{},{triggerType:triggerType,triggerUUID:uuidV4()});});},[]);var handleLogOut=useCallback(function(_ref2){var success=_ref2.success,message=_ref2.message;if(success){setAuthResultState({accessToken:'',refreshToken:'',user:undefined,isLogin:false});}else{}},[]);var handleBunnyRefreshAuth=useCallback(function(_ref3){var success=_ref3.success,data=_ref3.data,message=_ref3.message;if(success){var accessToken=data.accessToken;setAuthResultState(function(preState){return _objectSpread(_objectSpread({},preState),{},{accessToken:accessToken});});}else{setAuthResultState(function(preState){return _objectSpread(_objectSpread({},preState),{},{accessToken:''});});}},[]);useEffect(function(){var bootstrapAsync=function bootstrapAsync(){var _await$authFunctions$,accessToken,refreshToken,user;return _regeneratorRuntime.async(function bootstrapAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(authFunctions.getPersistenceAuth());case 2:_await$authFunctions$=_context.sent;accessToken=_await$authFunctions$.accessToken;refreshToken=_await$authFunctions$.refreshToken;user=_await$authFunctions$.user;if(accessToken){setAuthResultState({accessToken:accessToken,refreshToken:refreshToken,user:user,isLogin:true});}else{setAuthResultState({accessToken:'',refreshToken:'',user:undefined,isLogin:false});}case 7:case\"end\":return _context.stop();}}},null,null,null,Promise);};bootstrapAsync().then(function(){setIsReady(true);});},[]);useEffect(function(){var loginID=EventRegister.on('login',handleLogin);var LogOutID=EventRegister.on('LogOut',handleLogOut);var bunnyRefreshAuthID=EventRegister.on('bunnyRefreshAuth',handleBunnyRefreshAuth);var authTriggerID=EventRegister.on('authTrigger',handleAuthTrigger);var checkAuthID=EventRegister.on('checkIsLogin',handleCheckIsLogin);return function(){if(typeof loginID==='string'){EventRegister.rm(loginID);}if(typeof LogOutID==='string'){EventRegister.rm(LogOutID);}if(typeof bunnyRefreshAuthID==='string'){EventRegister.rm(bunnyRefreshAuthID);}if(typeof authTriggerID==='string'){EventRegister.rm(authTriggerID);}if(typeof checkAuthID==='string'){EventRegister.rm(checkAuthID);}};},[]);return isReady?React.createElement(AuthLaborContext.Provider,{value:{authResult:memoizedAuthResultState,authFunctions:authFunctions}},children):React.createElement(Preparing,{text:st(\"AuthLaborProviderLoading\")});};","map":null,"metadata":{},"sourceType":"module"}