{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import*as React from'react';import{useEffect,useState}from'react';import{useBunnyKit}from\"../../hooks/bunny-kit\";import{IcoMoon}from\"../UI\";import Platform from\"react-native-web/dist/exports/Platform\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import Vibration from\"react-native-web/dist/exports/Vibration\";import{Audio}from\"../../../packages/expo-av/src\";import{uploadFileToFirebase}from\"../../helpers\";import{RECORDING_OPTIONS_PRESET_HIGH_QUALITY}from\"../../../packages/expo-av/src/Audio/Recording\";import{makeStyles}from\"./styles\";export var AudioRecorder=function AudioRecorder(_ref){var onValueChanged=_ref.onValueChanged,_ref$isUpload=_ref.isUpload,isUpload=_ref$isUpload===void 0?false:_ref$isUpload,onStatusChanged=_ref.onStatusChanged,_ref$uploadPath=_ref.uploadPath,uploadPath=_ref$uploadPath===void 0?'/':_ref$uploadPath,_ref$isDebug=_ref.isDebug,isDebug=_ref$isDebug===void 0?false:_ref$isDebug;var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,colors=_useBunnyKit.colors;var _useState=useState(),_useState2=_slicedToArray(_useState,2),recording=_useState2[0],setRecording=_useState2[1];var _useState3=useState('STOPPED'),_useState4=_slicedToArray(_useState3,2),status=_useState4[0],setStatus=_useState4[1];var styles=makeStyles(sizeLabor,themeLabor);useEffect(function(){onStatusChanged&&onStatusChanged(status);},[status]);function startRecording(){var _recording;return _regeneratorRuntime.async(function startRecording$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;isDebug&&console.log('Requesting permissions..');setStatus('GETTING_PERMISSION');_context.next=5;return _regeneratorRuntime.awrap(Audio.requestPermissionsAsync());case 5:_context.next=7;return _regeneratorRuntime.awrap(Audio.setAudioModeAsync({allowsRecordingIOS:true,playsInSilentModeIOS:true}));case 7:setStatus('STARTING');isDebug&&console.log('Starting recording..');_recording=new Audio.Recording();_context.next=12;return _regeneratorRuntime.awrap(_recording.prepareToRecordAsync(RECORDING_OPTIONS_PRESET_HIGH_QUALITY));case 12:_context.next=14;return _regeneratorRuntime.awrap(_recording.startAsync());case 14:setRecording(_recording);setStatus('STARTED');isDebug&&console.log('Recording started');_context.next=23;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](0);setStatus('ERROR');isDebug&&console.error('Failed to start recording',_context.t0);case 23:case\"end\":return _context.stop();}}},null,null,[[0,19]],Promise);}function stopRecording(){var localURI,remoteURL;return _regeneratorRuntime.async(function stopRecording$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setStatus('STOPPING');isDebug&&console.log('Stopping recording..');if(recording){_context2.next=5;break;}setStatus('STOPPED');return _context2.abrupt(\"return\");case 5:_context2.next=7;return _regeneratorRuntime.awrap(recording.stopAndUnloadAsync());case 7:localURI=recording.getURI();isDebug&&console.log('---recording,uri',recording,localURI);if(localURI){_context2.next=12;break;}setStatus('STOPPED');return _context2.abrupt(\"return\");case 12:if(!isUpload){_context2.next=21;break;}_context2.next=15;return _regeneratorRuntime.awrap(uploadFileToFirebase(localURI,uploadPath));case 15:remoteURL=_context2.sent;isDebug&&console.log('Recording stopped and stored (remotely) at',remoteURL);setStatus('STOPPED');onValueChanged&&onValueChanged(remoteURL);_context2.next=24;break;case 21:setStatus('STOPPED');isDebug&&console.log('Recording stopped and stored (locally) at',localURI);onValueChanged&&onValueChanged(localURI);case 24:setRecording(undefined);case 25:case\"end\":return _context2.stop();}}},null,null,null,Promise);}var _longPress=function _longPress(){return _regeneratorRuntime.async(function _longPress$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.t0=status;_context3.next=_context3.t0==='STOPPED'?3:7;break;case 3:Platform.OS!=='web'&&Vibration.vibrate([10,10]);_context3.next=6;return _regeneratorRuntime.awrap(startRecording());case 6:return _context3.abrupt(\"break\",8);case 7:return _context3.abrupt(\"break\",8);case 8:case\"end\":return _context3.stop();}}},null,null,null,Promise);};var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),pressIn=_useState6[0],setPressIn=_useState6[1];var _pressIn=function _pressIn(){return _regeneratorRuntime.async(function _pressIn$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setPressIn(true);case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);};var _pressOut=function _pressOut(){return _regeneratorRuntime.async(function _pressOut$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setPressIn(false);_context5.next=3;return _regeneratorRuntime.awrap(stopRecording());case 3:case\"end\":return _context5.stop();}}},null,null,null,Promise);};return React.createElement(TouchableHighlight,{onPressIn:_pressIn,onLongPress:_longPress,onPressOut:_pressOut,underlayColor:colors.transparent},React.createElement(IcoMoon,{name:\"mic1\",style:[styles.micIcon,pressIn&&styles.active]}));};","map":null,"metadata":{},"sourceType":"module"}