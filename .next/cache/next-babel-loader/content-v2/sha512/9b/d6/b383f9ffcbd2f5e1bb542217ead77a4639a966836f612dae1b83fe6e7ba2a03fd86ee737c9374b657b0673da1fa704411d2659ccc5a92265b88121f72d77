{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import React,{useEffect}from'react';import{Text}from\"../../../components/UI\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import FlatList from\"react-native-web/dist/exports/FlatList\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import View from\"react-native-web/dist/exports/View\";import{useSelector}from'react-redux';import{Col,Row}from\"../../../containers\";import{makeStyles}from\"./styles\";import{useBunnyKit}from\"../../../hooks/bunny-kit\";import{isLoaded,useFirebaseConnect,useFirestore,useFirestoreConnect}from'react-redux-firebase';import{Avatar,Divider,InlineJump,Preparing}from\"../../../components\";import dayJS from'dayjs';import isToday from'dayjs/plugin/isToday';import{useSafeAreaInsets}from'react-native-safe-area-context';import{firestoreTimestampToDate}from\"../../../utils\";dayJS.extend(isToday);export function ChatHomeScreen(_ref){var route=_ref.route,navigation=_ref.navigation;var _useBunnyKit=useBunnyKit(),sizeLabor=_useBunnyKit.sizeLabor,themeLabor=_useBunnyKit.themeLabor,user=_useBunnyKit.user,wp=_useBunnyKit.wp;var styles=makeStyles(sizeLabor,themeLabor);var firebaseUser=user==null?void 0:user.firebaseUser;var userId='';if(firebaseUser){userId=firebaseUser.uid;}useFirebaseConnect([{path:'chatRooms',queryParams:[]}]);useFirestoreConnect([{collection:'conversations',where:[['users','array-contains',userId]]}]);useFirestoreConnect([{collection:'users'}]);var conversations=useSelector(function(state){return state.firestoreState.ordered.conversations;});var firestore=useFirestore();useEffect(function(){getCurrentUserConversationsMessages().then();},[conversations]);var getCurrentUserConversationsMessages=function getCurrentUserConversationsMessages(){var whereConversationIds;return _regeneratorRuntime.async(function getCurrentUserConversationsMessages$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(conversations&&conversations.length>0)){_context.next=4;break;}whereConversationIds=conversations.map(function(item){return item.id;});_context.next=4;return _regeneratorRuntime.awrap(firestore.get({collection:'chatMessages',orderBy:['createdAt','desc'],storeAs:'currentUserConversationsMessages'}));case 4:case\"end\":return _context.stop();}}},null,null,null,Promise);};var insets=useSafeAreaInsets();var users=useSelector(function(state){return state.firestoreState.ordered.users;});var currentUserConversationsMessages=useSelector(function(state){return state.firestoreState.ordered.currentUserConversationsMessages;});var handleRoomPress=function handleRoomPress(key){};var renderAvatar=function renderAvatar(conversation){switch(conversation.type){case'GROUP':return React.createElement(Avatar,{size:\"l\",isBorder:false,source:{uri:conversation.avatar}});case'COUPLE':var otherUsersInConversation=users==null?void 0:users.filter(function(user){return conversation.users.includes(user.uid)&&user.uid!==userId;});return otherUsersInConversation&&otherUsersInConversation[0]&&otherUsersInConversation[0].photoURL?React.createElement(Avatar,{size:\"l\",isBorder:false,source:{uri:otherUsersInConversation[0].photoURL}}):null;}};var renderLatestMessage=function renderLatestMessage(conversation){var latestMessages=currentUserConversationsMessages==null?void 0:currentUserConversationsMessages.filter(function(item){return item.conversationId===conversation.id;});var latestMessage=latestMessages==null?void 0:latestMessages[0];var tipText='';var tipTime='';if(latestMessage){var createdAtTimestamp=firestoreTimestampToDate(latestMessage.createdAt);var date=dayJS(createdAtTimestamp);var now=new Date();var _isToday=date.isToday();var isSameWeek=date.isSame(now,'week');tipTime=_isToday?date.format('LT'):isSameWeek?date.format('ddd').toString():date.format('MM/DD/YY');switch(latestMessage.type){case'MESSAGE':tipText=latestMessage.text;break;case'IMAGE':tipText='Image Message';break;case'STICKER_GIF':tipText='Sticker Message';break;case'AUDIO':tipText='Voice Message';break;case'VIDEO':tipText='Video Message';break;default:break;}}return React.createElement(React.Fragment,null,React.createElement(Row,{style:styles.timePanel},React.createElement(Text,null,conversation.name),React.createElement(Text,{style:styles.time},tipTime)),React.createElement(Row,{style:styles.tipPanel},React.createElement(Text,{style:styles.tip},tipText)));};var _renderItem=function renderItem(conversation){return React.createElement(View,{style:styles.conversation},React.createElement(InlineJump,{type:\"LINK\",to:\"/demo-chat/chat-rooms/\"+conversation.id},React.createElement(Row,{paddingVertical:\"m\"},React.createElement(Col,{size:1},renderAvatar(conversation)),React.createElement(Col,{size:5,style:styles.latestMessage},renderLatestMessage(conversation)))),React.createElement(Divider,null));};var webFlatListHeight=Dimensions.get('window').height-insets.top-insets.bottom-wp(46);return React.createElement(SafeAreaView,{style:{flex:1}},isLoaded(conversations)?React.createElement(FlatList,{style:{height:webFlatListHeight},data:conversations,renderItem:function renderItem(_ref2){var item=_ref2.item;return _renderItem(item);},keyExtractor:function keyExtractor(item){return item.id;}}):React.createElement(Preparing,null));}","map":null,"metadata":{},"sourceType":"module"}