{"ast":null,"code":"import _extends from\"@babel/runtime/helpers/extends\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import React from'react';import FlatList from\"react-native-web/dist/exports/FlatList\";import Platform from\"react-native-web/dist/exports/Platform\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import View from\"react-native-web/dist/exports/View\";import LoadEarlier from\"./LoadEarlier\";import Message from\"./Message\";import{warning}from\"./utils\";import TypingIndicator from\"./TypingIndicator\";import{withBunnyKit}from\"../../hooks/bunny-kit\";var makeStyles=function makeStyles(sizeLabor,themeLabor){var ms=sizeLabor.ms;var wp=sizeLabor.designsBasedOn.iphoneX.wp;var colors=themeLabor.theme.colors;return StyleSheet.create({container:{flex:1},containerAlignTop:{flexDirection:'row',alignItems:'flex-start'},contentContainerStyle:{flexGrow:1,justifyContent:'flex-start'},emptyChatContainer:{flex:1,transform:[{scaleY:-1}]},headerWrapper:{flex:1},listStyle:{flex:1},scrollToBottomStyle:{opacity:0.8,position:'absolute',right:wp(10),bottom:wp(30),zIndex:999,height:wp(40),width:wp(40),borderRadius:wp(20),backgroundColor:colors.backdrop,alignItems:'center',justifyContent:'center',shadowColor:colors.shadow,shadowOpacity:0.5,shadowOffset:{width:0,height:0},shadowRadius:wp(1)},scrollToBottomButton:{fontSize:ms.fs.m,color:colors.text3}});};var MessageContainer=function(_React$PureComponent){_inherits(MessageContainer,_React$PureComponent);var _super=_createSuper(MessageContainer);function MessageContainer(props){var _this;_classCallCheck(this,MessageContainer);_this=_super.call(this,props);_this.state={showScrollBottom:false,hasScrolled:false};_this.renderTypingIndicator=function(){if(Platform.OS==='web'){return null;}return React.createElement(TypingIndicator,{isTyping:_this.props.isTyping||false});};_this.renderFooter=function(){if(_this.props.renderFooter){return _this.props.renderFooter(_this.props);}return _this.renderTypingIndicator();};_this.renderLoadEarlier=function(){if(_this.props.loadEarlier===true){var _this$props=_this.props,_onLoadEarlier=_this$props.onLoadEarlier,isLoadingEarlier=_this$props.isLoadingEarlier,loadEarlierLabel=_this$props.loadEarlierLabel,loadEarlierContainerStyle=_this$props.loadEarlierContainerStyle,loadEarlierWrapperStyle=_this$props.loadEarlierWrapperStyle,loadEarlierTextStyle=_this$props.loadEarlierTextStyle,activityIndicatorStyle=_this$props.activityIndicatorStyle,activityIndicatorColor=_this$props.activityIndicatorColor,activityIndicatorSize=_this$props.activityIndicatorSize,isDebug=_this$props.isDebug;var loadEarlierProps={onLoadEarlier:_onLoadEarlier,isLoadingEarlier:isLoadingEarlier,loadEarlierLabel:loadEarlierLabel,loadEarlierContainerStyle:loadEarlierContainerStyle,loadEarlierWrapperStyle:loadEarlierWrapperStyle,loadEarlierTextStyle:loadEarlierTextStyle,activityIndicatorStyle:activityIndicatorStyle,activityIndicatorColor:activityIndicatorColor,activityIndicatorSize:activityIndicatorSize};isDebug&&console.log('%c[ chat ]','background: #555; color: #bada55','[level2]MessageContainer loadEarlierProps',loadEarlierProps);if(_this.props.renderLoadEarlier){return _this.props.renderLoadEarlier(loadEarlierProps);}return React.createElement(LoadEarlier,loadEarlierProps);}return null;};_this.scrollToBottom=function(){var animated=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var inverted=_this.props.inverted;if(inverted){_this.scrollTo({offset:0,animated:animated});}else if(_this.props.forwardRef&&_this.props.forwardRef.current){_this.props.forwardRef.current.scrollToEnd({animated:animated});}};_this.handleOnScroll=function(event){var _event$nativeEvent=event.nativeEvent,contentOffsetY=_event$nativeEvent.contentOffset.y,contentSizeHeight=_event$nativeEvent.contentSize.height,layoutMeasurementHeight=_event$nativeEvent.layoutMeasurement.height;var scrollToBottomOffset=_this.props.scrollToBottomOffset;if(_this.props.inverted){if(contentOffsetY>scrollToBottomOffset){_this.setState({showScrollBottom:true,hasScrolled:true});}else{_this.setState({showScrollBottom:false,hasScrolled:true});}}else{if(contentOffsetY<scrollToBottomOffset&&contentSizeHeight-layoutMeasurementHeight>scrollToBottomOffset){_this.setState({showScrollBottom:true,hasScrolled:true});}else{_this.setState({showScrollBottom:false,hasScrolled:true});}}};_this.renderRow=function(_ref){var item=_ref.item,index=_ref.index;if(!item._id&&item._id!==0){warning('BunnyChat: `_id` is missing for message',JSON.stringify(item));}if(!item.user){if(!item.system){warning('BunnyChat: `user` is missing for message',JSON.stringify(item));}item.user={_id:0};}var _this$props2=_this.props,messages=_this$props2.messages,user=_this$props2.user,inverted=_this$props2.inverted;if(messages&&user){var previousMessage=(inverted?messages[index+1]:messages[index-1])||{};var nextMessage=(inverted?messages[index-1]:messages[index+1])||{};var _this$props3=_this.props,audioContainerStyle=_this$props3.audioContainerStyle,audioStyle=_this$props3.audioStyle,audioProps=_this$props3.audioProps,avatarContainerStyle=_this$props3.avatarContainerStyle,avatarImageStyle=_this$props3.avatarImageStyle,avatarTextStyle=_this$props3.avatarTextStyle,bubbleWrapperStyle=_this$props3.bubbleWrapperStyle,bubbleContainerStyle=_this$props3.bubbleContainerStyle,bottomContainerStyle=_this$props3.bottomContainerStyle,customTextStyle=_this$props3.customTextStyle,containerToPreviousStyle=_this$props3.containerToPreviousStyle,containerToNextStyle=_this$props3.containerToNextStyle,quickRepliesColor=_this$props3.quickRepliesColor,dateFormat=_this$props3.dateFormat,dayContainerStyle=_this$props3.dayContainerStyle,dayTextProps=_this$props3.dayTextProps,dayTextStyle=_this$props3.dayTextStyle,dayWrapperStyle=_this$props3.dayWrapperStyle,isCustomViewBottom=_this$props3.isCustomViewBottom,imageStyle=_this$props3.imageStyle,imageProps=_this$props3.imageProps,imageContainerStyle=_this$props3.imageContainerStyle,isDebug=_this$props3.isDebug,keepReplies=_this$props3.keepReplies,lightBoxProps=_this$props3.lightBoxProps,linkStyle=_this$props3.linkStyle,messageContainerStyle=_this$props3.messageContainerStyle,phoneNumberOptionTitles=_this$props3.phoneNumberOptionTitles,onLongPress=_this$props3.onLongPress,onMessageLoad=_this$props3.onMessageLoad,onMessageLoadEnd=_this$props3.onMessageLoadEnd,onMessageLoadError=_this$props3.onMessageLoadError,onMessageLoadStart=_this$props3.onMessageLoadStart,onMessageReadyForDisplay=_this$props3.onMessageReadyForDisplay,onPress=_this$props3.onPress,_onQuickReply=_this$props3.onQuickReply,onLongPressAvatar=_this$props3.onLongPressAvatar,onMessageLayout=_this$props3.onMessageLayout,onPressAvatar=_this$props3.onPressAvatar,parsePatterns=_this$props3.parsePatterns,quickReplyStyle=_this$props3.quickReplyStyle,renderCustomView=_this$props3.renderCustomView,renderMessageAudio=_this$props3.renderMessageAudio,renderMessageImage=_this$props3.renderMessageImage,renderMessageSticker=_this$props3.renderMessageSticker,renderMessageText=_this$props3.renderMessageText,renderMessageVideo=_this$props3.renderMessageVideo,renderQuickReplies=_this$props3.renderQuickReplies,renderQuickReplySend=_this$props3.renderQuickReplySend,renderTicks=_this$props3.renderTicks,renderTime=_this$props3.renderTime,renderUsernameOnMessage=_this$props3.renderUsernameOnMessage,renderAvatar=_this$props3.renderAvatar,renderAvatarOnTop=_this$props3.renderAvatarOnTop,renderBubble=_this$props3.renderBubble,renderDay=_this$props3.renderDay,renderSystemMessage=_this$props3.renderSystemMessage,stickerProps=_this$props3.stickerProps,stickerContainerStyle=_this$props3.stickerContainerStyle,sendText=_this$props3.sendText,stickerStyle=_this$props3.stickerStyle,shouldUpdateMessage=_this$props3.shouldUpdateMessage,showAvatarForEveryMessage=_this$props3.showAvatarForEveryMessage,showUserAvatar=_this$props3.showUserAvatar,systemMessageContainerStyle=_this$props3.systemMessageContainerStyle,systemMessageWrapperStyle=_this$props3.systemMessageWrapperStyle,systemTextStyle=_this$props3.systemTextStyle,touchableProps=_this$props3.touchableProps,timeTextStyle=_this$props3.timeTextStyle,timeFormat=_this$props3.timeFormat,timeContainerStyle=_this$props3.timeContainerStyle,tickStyle=_this$props3.tickStyle,textStyle=_this$props3.textStyle,textProps=_this$props3.textProps,textContainerStyle=_this$props3.textContainerStyle,usernameStyle=_this$props3.usernameStyle,videoContainerStyle=_this$props3.videoContainerStyle,videoStyle=_this$props3.videoStyle,videoProps=_this$props3.videoProps,audioProgressStyle=_this$props3.audioProgressStyle,audioPlayButtonStyle=_this$props3.audioPlayButtonStyle,audioProgressColor=_this$props3.audioProgressColor,audioRemainTimeStyle=_this$props3.audioRemainTimeStyle,audioPlayButtonIconStyle=_this$props3.audioPlayButtonIconStyle;var messageProps={audioContainerStyle:audioContainerStyle,audioStyle:audioStyle,audioProps:audioProps,avatarContainerStyle:avatarContainerStyle,avatarImageStyle:avatarImageStyle,avatarTextStyle:avatarTextStyle,bubbleWrapperStyle:bubbleWrapperStyle,bubbleContainerStyle:bubbleContainerStyle,bottomContainerStyle:bottomContainerStyle,customTextStyle:customTextStyle,containerToPreviousStyle:containerToPreviousStyle,containerToNextStyle:containerToNextStyle,quickRepliesColor:quickRepliesColor,dateFormat:dateFormat,dayContainerStyle:dayContainerStyle,dayTextProps:dayTextProps,dayTextStyle:dayTextStyle,dayWrapperStyle:dayWrapperStyle,isCustomViewBottom:isCustomViewBottom,imageStyle:imageStyle,imageProps:imageProps,imageContainerStyle:imageContainerStyle,isDebug:isDebug,keepReplies:keepReplies,lightBoxProps:lightBoxProps,linkStyle:linkStyle,messageContainerStyle:messageContainerStyle,nextMessage:nextMessage,phoneNumberOptionTitles:phoneNumberOptionTitles,onLongPress:onLongPress,onMessageLoad:onMessageLoad,onMessageLoadEnd:onMessageLoadEnd,onMessageLoadError:onMessageLoadError,onMessageLoadStart:onMessageLoadStart,onMessageReadyForDisplay:onMessageReadyForDisplay,onPress:onPress,onQuickReply:_onQuickReply,onLongPressAvatar:onLongPressAvatar,onMessageLayout:onMessageLayout,onPressAvatar:onPressAvatar,parsePatterns:parsePatterns,previousMessage:previousMessage,quickReplyStyle:quickReplyStyle,renderCustomView:renderCustomView,renderMessageAudio:renderMessageAudio,renderMessageImage:renderMessageImage,renderMessageSticker:renderMessageSticker,renderMessageText:renderMessageText,renderMessageVideo:renderMessageVideo,renderQuickReplies:renderQuickReplies,renderQuickReplySend:renderQuickReplySend,renderTicks:renderTicks,renderTime:renderTime,renderUsernameOnMessage:renderUsernameOnMessage,renderAvatar:renderAvatar,renderAvatarOnTop:renderAvatarOnTop,renderBubble:renderBubble,renderDay:renderDay,renderSystemMessage:renderSystemMessage,stickerProps:stickerProps,stickerContainerStyle:stickerContainerStyle,sendText:sendText,stickerStyle:stickerStyle,shouldUpdateMessage:shouldUpdateMessage,showAvatarForEveryMessage:showAvatarForEveryMessage,showUserAvatar:showUserAvatar,systemMessageContainerStyle:systemMessageContainerStyle,systemMessageWrapperStyle:systemMessageWrapperStyle,systemTextStyle:systemTextStyle,touchableProps:touchableProps,timeTextStyle:timeTextStyle,timeFormat:timeFormat,timeContainerStyle:timeContainerStyle,tickStyle:tickStyle,textStyle:textStyle,textProps:textProps,textContainerStyle:textContainerStyle,usernameStyle:usernameStyle,user:user,videoContainerStyle:videoContainerStyle,videoStyle:videoStyle,videoProps:videoProps,audioProgressStyle:audioProgressStyle,audioPlayButtonStyle:audioPlayButtonStyle,audioProgressColor:audioProgressColor,audioRemainTimeStyle:audioRemainTimeStyle,audioPlayButtonIconStyle:audioPlayButtonIconStyle,inverted:inverted,key:item._id,currentMessage:item,position:item.user._id===user._id?'right':'left'};isDebug&&console.log('%c[ chat ]','background: #555; color: #bada55','[level2]MessageContainer messageProps',messageProps);if(_this.props.renderMessage){return _this.props.renderMessage(messageProps);}return React.createElement(Message,messageProps);}return null;};_this.renderChatEmpty=function(){var _this$props$bunnyKit=_this.props.bunnyKit,sizeLabor=_this$props$bunnyKit.sizeLabor,themeLabor=_this$props$bunnyKit.themeLabor;var styles=makeStyles(sizeLabor,themeLabor);if(_this.props.renderChatEmpty){return _this.props.inverted?_this.props.renderChatEmpty():React.createElement(View,{style:styles.emptyChatContainer},_this.props.renderChatEmpty());}return React.createElement(View,{style:styles.container});};_this.renderHeaderWrapper=function(){var _this$props$bunnyKit2=_this.props.bunnyKit,sizeLabor=_this$props$bunnyKit2.sizeLabor,themeLabor=_this$props$bunnyKit2.themeLabor;var styles=makeStyles(sizeLabor,themeLabor);return React.createElement(View,{style:styles.headerWrapper},_this.renderLoadEarlier());};_this.onLayoutList=function(){if(!_this.props.inverted&&!!_this.props.messages&&_this.props.messages.length){setTimeout(function(){return _this.scrollToBottom&&_this.scrollToBottom(false);},15*_this.props.messages.length);}};_this.onEndReached=function(_ref2){var distanceFromEnd=_ref2.distanceFromEnd;var _this$props4=_this.props,loadEarlier=_this$props4.loadEarlier,onLoadEarlier=_this$props4.onLoadEarlier,infiniteScroll=_this$props4.infiniteScroll,isLoadingEarlier=_this$props4.isLoadingEarlier;if(infiniteScroll&&(_this.state.hasScrolled||distanceFromEnd>0)&&distanceFromEnd<=100&&loadEarlier&&onLoadEarlier&&!isLoadingEarlier&&Platform.OS!=='web'){onLoadEarlier();}};_this.keyExtractor=function(item){return\"\"+item._id;};return _this;}_createClass(MessageContainer,[{key:\"scrollTo\",value:function scrollTo(options){if(this.props.forwardRef&&this.props.forwardRef.current&&options){this.props.forwardRef.current.scrollToOffset(options);}}},{key:\"renderScrollBottomComponent\",value:function renderScrollBottomComponent(){var _this$props5=this.props,renderScrollToBottom=_this$props5.renderScrollToBottom,_this$props5$bunnyKit=_this$props5.bunnyKit,sizeLabor=_this$props5$bunnyKit.sizeLabor,themeLabor=_this$props5$bunnyKit.themeLabor;var styles=makeStyles(sizeLabor,themeLabor);if(renderScrollToBottom){return renderScrollToBottom();}return React.createElement(Text,{style:styles.scrollToBottomButton},\"v\");}},{key:\"renderScrollToBottomWrapper\",value:function renderScrollToBottomWrapper(){var _this2=this;var propsStyle=this.props.scrollToBottomStyle||{};var _this$props$bunnyKit3=this.props.bunnyKit,sizeLabor=_this$props$bunnyKit3.sizeLabor,themeLabor=_this$props$bunnyKit3.themeLabor;var styles=makeStyles(sizeLabor,themeLabor);return React.createElement(View,{style:[styles.scrollToBottomStyle,propsStyle]},React.createElement(TouchableOpacity,{onPress:function onPress(){return _this2.scrollToBottom();},hitSlop:{top:5,left:5,right:5,bottom:5}},this.renderScrollBottomComponent()));}},{key:\"render\",value:function render(){var _this$props6=this.props,inverted=_this$props6.inverted,_this$props6$bunnyKit=_this$props6.bunnyKit,sizeLabor=_this$props6$bunnyKit.sizeLabor,themeLabor=_this$props6$bunnyKit.themeLabor;var styles=makeStyles(sizeLabor,themeLabor);return React.createElement(View,{style:this.props.alignTop?styles.containerAlignTop:styles.container},this.state.showScrollBottom&&this.props.scrollToBottom?this.renderScrollToBottomWrapper():null,React.createElement(FlatList,_extends({ref:this.props.forwardRef,extraData:[this.props.extraData,this.props.isTyping],keyExtractor:this.keyExtractor,enableEmptySections:true,automaticallyAdjustContentInsets:false,inverted:inverted,data:this.props.messages,style:styles.listStyle,contentContainerStyle:styles.contentContainerStyle,renderItem:this.renderRow},this.props.invertibleScrollViewProps,{ListEmptyComponent:this.renderChatEmpty,ListFooterComponent:inverted?this.renderHeaderWrapper:this.renderFooter,ListHeaderComponent:inverted?this.renderFooter:this.renderHeaderWrapper,onScroll:this.handleOnScroll,scrollEventThrottle:100,onLayout:this.onLayoutList,onEndReached:this.onEndReached,onEndReachedThreshold:0.1},this.props.listViewProps)));}}]);return MessageContainer;}(React.PureComponent);MessageContainer.defaultProps={messages:[],user:undefined,isTyping:false,renderChatEmpty:undefined,renderFooter:undefined,renderMessage:undefined,onLoadEarlier:function onLoadEarlier(){},onQuickReply:function onQuickReply(){},inverted:true,loadEarlier:false,listViewProps:{},invertibleScrollViewProps:{},extraData:null,scrollToBottom:false,scrollToBottomOffset:200,alignTop:false,scrollToBottomStyle:{},infiniteScroll:false,isLoadingEarlier:false};export default withBunnyKit(MessageContainer);","map":null,"metadata":{},"sourceType":"module"}